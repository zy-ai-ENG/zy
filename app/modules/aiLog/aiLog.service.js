'use strict';const _0x1f71b9=_0x4d46;(function(_0x2c39cb,_0x56c3cb){const _0x3742f6=_0x4d46,_0x27ef8c=_0x2c39cb();while(!![]){try{const _0x2c4f44=parseInt(_0x3742f6(0xc6))/0x1*(-parseInt(_0x3742f6(0xc4))/0x2)+parseInt(_0x3742f6(0x92))/0x3+parseInt(_0x3742f6(0xba))/0x4+-parseInt(_0x3742f6(0xc1))/0x5*(parseInt(_0x3742f6(0xc0))/0x6)+-parseInt(_0x3742f6(0xbb))/0x7+-parseInt(_0x3742f6(0xae))/0x8*(-parseInt(_0x3742f6(0xb2))/0x9)+parseInt(_0x3742f6(0xc5))/0xa*(parseInt(_0x3742f6(0xbd))/0xb);if(_0x2c4f44===_0x56c3cb)break;else _0x27ef8c['push'](_0x27ef8c['shift']());}catch(_0x4493f5){_0x27ef8c['push'](_0x27ef8c['shift']());}}}(_0x39e5,0x25f42));function _0x4d46(_0x301bb0,_0x385448){const _0x39e5eb=_0x39e5();return _0x4d46=function(_0x4d46de,_0x4f8673){_0x4d46de=_0x4d46de-0x8d;let _0x31d0ea=_0x39e5eb[_0x4d46de];return _0x31d0ea;},_0x4d46(_0x301bb0,_0x385448);}var __decorate=this&&this[_0x1f71b9(0xa3)]||function(_0x193b98,_0x5c4d19,_0x40dda5,_0x3d5f45){const _0x521a7a=_0x1f71b9;var _0x331382=arguments[_0x521a7a(0x8e)],_0x3bde4e=_0x331382<0x3?_0x5c4d19:_0x3d5f45===null?_0x3d5f45=Object[_0x521a7a(0xb5)](_0x5c4d19,_0x40dda5):_0x3d5f45,_0x2e9477;if(typeof Reflect===_0x521a7a(0x9b)&&typeof Reflect[_0x521a7a(0xbc)]===_0x521a7a(0x9a))_0x3bde4e=Reflect[_0x521a7a(0xbc)](_0x193b98,_0x5c4d19,_0x40dda5,_0x3d5f45);else{for(var _0x159d48=_0x193b98[_0x521a7a(0x8e)]-0x1;_0x159d48>=0x0;_0x159d48--)if(_0x2e9477=_0x193b98[_0x159d48])_0x3bde4e=(_0x331382<0x3?_0x2e9477(_0x3bde4e):_0x331382>0x3?_0x2e9477(_0x5c4d19,_0x40dda5,_0x3bde4e):_0x2e9477(_0x5c4d19,_0x40dda5))||_0x3bde4e;}return _0x331382>0x3&&_0x3bde4e&&Object[_0x521a7a(0xbe)](_0x5c4d19,_0x40dda5,_0x3bde4e),_0x3bde4e;},__metadata=this&&this['__metadata']||function(_0x1fa8e9,_0x3ab894){const _0x4e9c67=_0x1f71b9;if(typeof Reflect===_0x4e9c67(0x9b)&&typeof Reflect[_0x4e9c67(0xc7)]==='function')return Reflect[_0x4e9c67(0xc7)](_0x1fa8e9,_0x3ab894);},__param=this&&this[_0x1f71b9(0x8f)]||function(_0x29cb8b,_0x1da966){return function(_0x1f384b,_0x3f4cbf){_0x1da966(_0x1f384b,_0x3f4cbf,_0x29cb8b);};};Object['defineProperty'](exports,_0x1f71b9(0xa5),{'value':!![]}),exports[_0x1f71b9(0x90)]=void 0x0;const typeorm_1=require(_0x1f71b9(0xaf)),common_1=require(_0x1f71b9(0x9d)),typeorm_2=require(_0x1f71b9(0xb9)),relate_contant_1=require('../../common/constants/relate.contant'),aiLogExt_entity_1=require(_0x1f71b9(0x93)),aiAgreeLog_entity_1=require(_0x1f71b9(0xc3));let AiLogService=class AiLogService{constructor(_0x22a147,_0x2be0e4,_0x27212c){const _0x524d44=_0x1f71b9;this['aiLogExtEntity']=_0x22a147,this[_0x524d44(0xa8)]=_0x2be0e4,this['connection']=_0x27212c;}async[_0x1f71b9(0xb8)](_0x1cfec9,_0xda6bbc){const _0x2344e3=_0x1f71b9,_0x365ad5=await this[_0x2344e3(0xa8)]['findOne']({'where':{'relateId':_0xda6bbc,'relateType':_0x1cfec9}});return _0x365ad5;}async[_0x1f71b9(0xb1)](_0x17bceb,_0x1cdd1a){const _0xf52592=_0x1f71b9;try{const _0x279ae5=_0x17bceb[_0xf52592(0xc2)]['id'],_0x4cb464=await this[_0xf52592(0xa8)][_0xf52592(0xb0)]({'where':{'userId':_0x279ae5,'relateId':_0x1cdd1a[_0xf52592(0xad)],'relateType':_0x1cdd1a[_0xf52592(0xbf)]}});return await this[_0xf52592(0x98)]['transaction'](async()=>{const _0x288fe8=_0xf52592;if(_0x4cb464&&_0x4cb464['action']===_0x1cdd1a['action'])await this[_0x288fe8(0xa8)][_0x288fe8(0xb6)]({'id':_0x4cb464['id']});else{const _0x5cdbc4={..._0x1cdd1a,'userId':_0x279ae5,'relateId':_0x1cdd1a[_0x288fe8(0xad)],'relateType':_0x1cdd1a['relateType'],'id':_0x4cb464?_0x4cb464['id']:null};await this[_0x288fe8(0xa8)][_0x288fe8(0xac)](_0x5cdbc4);}let _0x3fa9c6=await this[_0x288fe8(0x91)]['findOne']({'where':{'relateId':_0x1cdd1a['relateId']}});!_0x3fa9c6&&(_0x3fa9c6=new aiLogExt_entity_1[(_0x288fe8(0xab))](),_0x3fa9c6[_0x288fe8(0xad)]=_0x1cdd1a[_0x288fe8(0xad)],_0x3fa9c6[_0x288fe8(0xbf)]=_0x1cdd1a[_0x288fe8(0xbf)],_0x3fa9c6[_0x288fe8(0xb7)]=0x0),_0x4cb464&&_0x4cb464[_0x288fe8(0x9e)]===_0x1cdd1a[_0x288fe8(0x9e)]?_0x1cdd1a[_0x288fe8(0x9e)]===_0x288fe8(0xb1)?_0x3fa9c6[_0x288fe8(0xb7)]=_0x3fa9c6['agreeNum']-0x1:_0x3fa9c6[_0x288fe8(0xb7)]=_0x3fa9c6[_0x288fe8(0xb7)]+0x1:_0x1cdd1a[_0x288fe8(0x9e)]==='agree'?_0x3fa9c6['agreeNum']=_0x3fa9c6[_0x288fe8(0xb7)]+Math[_0x288fe8(0xa6)](Math['random']()*0x14):_0x3fa9c6[_0x288fe8(0xb7)]=_0x3fa9c6[_0x288fe8(0xb7)]-0x1,_0x3fa9c6[_0x288fe8(0xb7)]=_0x3fa9c6['agreeNum']<0x0?0x0:_0x3fa9c6['agreeNum'],await this[_0x288fe8(0x91)][_0x288fe8(0xac)](_0x3fa9c6);}),!![];}catch(_0x399bdb){throw new common_1['HttpException'](_0x399bdb[_0xf52592(0x95)],common_1[_0xf52592(0xaa)][_0xf52592(0x9f)]);}}async[_0x1f71b9(0xa2)](_0x1e3f66,_0x3fa0f8){const _0x6eb7a1=_0x1f71b9,_0x68182a=await this[_0x6eb7a1(0x91)][_0x6eb7a1(0xb0)]({'where':{'relateId':_0x3fa0f8,'relateType':_0x1e3f66}});return _0x68182a;}async[_0x1f71b9(0xb4)](_0xc2fc6f){const _0x3cc888=_0x1f71b9;let _0x5484a5=await this[_0x3cc888(0x91)][_0x3cc888(0xb0)]({'where':{'relateId':_0xc2fc6f,'relateType':relate_contant_1[_0x3cc888(0x96)][_0x3cc888(0xb3)]}});!_0x5484a5&&(_0x5484a5=new aiLogExt_entity_1['AiLogExtEntity'](),_0x5484a5[_0x3cc888(0xad)]=_0xc2fc6f,_0x5484a5['relateType']=relate_contant_1['ELogRelateType']['suno']),_0x5484a5[_0x3cc888(0x9c)]=_0x5484a5[_0x3cc888(0x9c)]+Math[_0x3cc888(0xa6)](Math[_0x3cc888(0x8d)]()*0x14),await this[_0x3cc888(0x91)]['save'](_0x5484a5);}async[_0x1f71b9(0xa1)](_0x262142,_0x1b59e5){const _0x32c5f9=_0x1f71b9;let _0x283770=await this[_0x32c5f9(0x91)][_0x32c5f9(0xb0)]({'where':{'relateId':_0x1b59e5,'relateType':_0x262142}});!_0x283770&&(_0x283770=new aiLogExt_entity_1[(_0x32c5f9(0xab))](),_0x283770[_0x32c5f9(0xad)]=_0x1b59e5,_0x283770[_0x32c5f9(0xbf)]=_0x262142),_0x283770[_0x32c5f9(0x94)]=_0x283770[_0x32c5f9(0x94)]+Math[_0x32c5f9(0xa6)](Math[_0x32c5f9(0x8d)]()*0x14),await this[_0x32c5f9(0x91)][_0x32c5f9(0xac)](_0x283770);}};function _0x39e5(){const _0x463373=['@nestjs/typeorm','1016548QQPVuA','1997310lfXeLp','decorate','14223WEsias','defineProperty','relateType','160842ZOrhQv','35pDsRjm','user','./aiAgreeLog.entity','38DoCNai','1620CsVLLw','12113bwQrgM','metadata','random','length','__param','AiLogService','aiLogExtEntity','509307cmzCwu','./aiLogExt.entity','visitNum','message','ELogRelateType','Connection','connection','Injectable','function','object','playNum','@nestjs/common','action','BAD_REQUEST','InjectRepository','increaseVisit','getByRelateId','__decorate','design:paramtypes','__esModule','round','AiAgreeLogEntity','aiAgreeLogEntity','Repository','HttpStatus','AiLogExtEntity','save','relateId','900848ochSML','typeorm','findOne','agree','18ckGsSQ','suno','musicPlay','getOwnPropertyDescriptor','delete','agreeNum','getAgreeByRelateId'];_0x39e5=function(){return _0x463373;};return _0x39e5();}AiLogService=__decorate([(0x0,common_1[_0x1f71b9(0x99)])(),__param(0x0,(0x0,typeorm_2[_0x1f71b9(0xa0)])(aiLogExt_entity_1[_0x1f71b9(0xab)])),__param(0x1,(0x0,typeorm_2['InjectRepository'])(aiAgreeLog_entity_1[_0x1f71b9(0xa7)])),__metadata(_0x1f71b9(0xa4),[typeorm_1[_0x1f71b9(0xa9)],typeorm_1[_0x1f71b9(0xa9)],typeorm_1[_0x1f71b9(0x97)]])],AiLogService),exports['AiLogService']=AiLogService;