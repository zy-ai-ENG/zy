'use strict';const _0x51d8e7=_0x8487;(function(_0x33bd07,_0x46de7d){const _0x668ddb=_0x8487,_0x5195b3=_0x33bd07();while(!![]){try{const _0x334af0=-parseInt(_0x668ddb(0x1b4))/0x1*(-parseInt(_0x668ddb(0x1bc))/0x2)+parseInt(_0x668ddb(0x1b5))/0x3+-parseInt(_0x668ddb(0x19c))/0x4*(parseInt(_0x668ddb(0x1c0))/0x5)+parseInt(_0x668ddb(0x19d))/0x6+-parseInt(_0x668ddb(0x1a3))/0x7+-parseInt(_0x668ddb(0x1bf))/0x8+parseInt(_0x668ddb(0x1c1))/0x9;if(_0x334af0===_0x46de7d)break;else _0x5195b3['push'](_0x5195b3['shift']());}catch(_0x2ac6e0){_0x5195b3['push'](_0x5195b3['shift']());}}}(_0x36f2,0x8c283));var __decorate=this&&this[_0x51d8e7(0x19e)]||function(_0x2003e4,_0x52c801,_0x2b12d5,_0x3479eb){const _0x275526=_0x51d8e7;var _0xb2fa68=arguments[_0x275526(0x1a8)],_0x7771cb=_0xb2fa68<0x3?_0x52c801:_0x3479eb===null?_0x3479eb=Object[_0x275526(0x19b)](_0x52c801,_0x2b12d5):_0x3479eb,_0x5bb566;if(typeof Reflect==='object'&&typeof Reflect[_0x275526(0x1a5)]===_0x275526(0x1b9))_0x7771cb=Reflect[_0x275526(0x1a5)](_0x2003e4,_0x52c801,_0x2b12d5,_0x3479eb);else{for(var _0x3ebed0=_0x2003e4[_0x275526(0x1a8)]-0x1;_0x3ebed0>=0x0;_0x3ebed0--)if(_0x5bb566=_0x2003e4[_0x3ebed0])_0x7771cb=(_0xb2fa68<0x3?_0x5bb566(_0x7771cb):_0xb2fa68>0x3?_0x5bb566(_0x52c801,_0x2b12d5,_0x7771cb):_0x5bb566(_0x52c801,_0x2b12d5))||_0x7771cb;}return _0xb2fa68>0x3&&_0x7771cb&&Object['defineProperty'](_0x52c801,_0x2b12d5,_0x7771cb),_0x7771cb;},__metadata=this&&this['__metadata']||function(_0x125df4,_0x3446bf){const _0x826973=_0x51d8e7;if(typeof Reflect==='object'&&typeof Reflect[_0x826973(0x1a6)]===_0x826973(0x1b9))return Reflect[_0x826973(0x1a6)](_0x125df4,_0x3446bf);},__param=this&&this[_0x51d8e7(0x1bd)]||function(_0x4d53b4,_0x2bcf39){return function(_0x3522df,_0x30101c){_0x2bcf39(_0x3522df,_0x30101c,_0x4d53b4);};};function _0x8487(_0x7b6e9b,_0x1d37d7){const _0x36f228=_0x36f2();return _0x8487=function(_0x84873b,_0x120b96){_0x84873b=_0x84873b-0x19a;let _0x409390=_0x36f228[_0x84873b];return _0x409390;},_0x8487(_0x7b6e9b,_0x1d37d7);}Object[_0x51d8e7(0x1ab)](exports,_0x51d8e7(0x1a9),{'value':!![]}),exports[_0x51d8e7(0x1b8)]=void 0x0;const common_1=require(_0x51d8e7(0x1ad));let RedisCacheService=class RedisCacheService{constructor(_0x285446){const _0x199b8b=_0x51d8e7;this[_0x199b8b(0x1be)]=_0x285446;}async[_0x51d8e7(0x1b7)](){}async[_0x51d8e7(0x1b0)](_0xec2065){const _0x4d6fb4=_0x51d8e7,{key:_0x2b6fc2}=_0xec2065;return await this[_0x4d6fb4(0x1be)][_0x4d6fb4(0x1b0)](_0x2b6fc2);}async[_0x51d8e7(0x1b2)](_0x522aa5,_0x435068){const _0x531354=_0x51d8e7;try{const {key:_0x336fc0,val:_0x5a640d}=_0x522aa5;await this[_0x531354(0x1be)]['set'](_0x336fc0,_0x5a640d),_0x435068&&await this[_0x531354(0x1be)][_0x531354(0x1a1)](_0x336fc0,_0x435068);return;}catch(_0x1912a2){throw new common_1['HttpException'](_0x1912a2,common_1[_0x531354(0x1b6)][_0x531354(0x1b3)]);}}async['ttl'](_0x13c060){return await this['redisClient']['ttl'](_0x13c060);}async[_0x51d8e7(0x1bb)](_0x42402d){const {key:_0x3fa5a8}=_0x42402d;return await this['redisClient']['del'](_0x3fa5a8);}async[_0x51d8e7(0x1af)](_0x18c668,_0x30b34b){const _0x1b43a5=_0x51d8e7,_0x171cea=await this[_0x1b43a5(0x1be)][_0x1b43a5(0x1b1)](_0x1b43a5(0x1ba)+_0x18c668,0x0,-0x1);await this[_0x1b43a5(0x1a4)](_0x18c668,_0x171cea),await this['redisClient']['set'](_0x1b43a5(0x1a0)+_0x18c668,_0x30b34b);}async['invalidateTokens'](_0x4706bf,_0x4f0d7f){_0x4f0d7f['forEach'](_0x442e3d=>{const _0x54efb5=_0x8487;this[_0x54efb5(0x1be)]['del'](_0x54efb5(0x1a0)+_0x4706bf+':'+_0x442e3d);});}async[_0x51d8e7(0x1a7)](_0x48fdec,_0x3fad74){const _0x162854=_0x51d8e7,{id:_0x5b0f87,role:_0x2ffb06}=_0x3fad74['user'];if(_0x2ffb06===_0x162854(0x19a))return!![];const _0x2772cb=await this[_0x162854(0x1be)]['get']('token:'+_0x5b0f87);if(_0x2772cb===null)return await this[_0x162854(0x1be)]['set']('token:'+_0x5b0f87,_0x48fdec),!![];if(_0x2772cb!==_0x48fdec){if([_0x162854(0x1ae),'admin','manager'][_0x162854(0x1a2)](_0x2ffb06))return!![];throw new common_1[(_0x162854(0x1aa))]('您已在其他设备覆盖登录、请您重新登录！',common_1[_0x162854(0x1b6)]['UNAUTHORIZED']);}}};function _0x36f2(){const _0x5052e6=['6368873mvGajM','invalidateTokens','decorate','metadata','checkTokenAuth','length','__esModule','HttpException','defineProperty','Inject','@nestjs/common','super','saveToken','get','zRange','set','BAD_REQUEST','1eQTjLw','1717095BGOEdP','HttpStatus','onModuleInit','RedisCacheService','function','tokens:','del','865162gvJFQC','__param','redisClient','8700920zsDbTS','5dcMMQi','23582349OwHpFF','visitor','getOwnPropertyDescriptor','4422056LFJnFU','311064exKUuO','__decorate','Injectable','token:','expire','includes'];_0x36f2=function(){return _0x5052e6;};return _0x36f2();}RedisCacheService=__decorate([(0x0,common_1[_0x51d8e7(0x19f)])(),__param(0x0,(0x0,common_1[_0x51d8e7(0x1ac)])('REDIS_CLIENT')),__metadata('design:paramtypes',[Object])],RedisCacheService),exports['RedisCacheService']=RedisCacheService;