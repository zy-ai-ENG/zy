'use strict';const _0x292b46=_0x574f;(function(_0x3394cd,_0x412cd9){const _0x1d1e59=_0x574f,_0x4ca312=_0x3394cd();while(!![]){try{const _0x5ed42f=parseInt(_0x1d1e59(0x119))/0x1*(-parseInt(_0x1d1e59(0x11e))/0x2)+-parseInt(_0x1d1e59(0x147))/0x3*(parseInt(_0x1d1e59(0x11c))/0x4)+-parseInt(_0x1d1e59(0x160))/0x5+-parseInt(_0x1d1e59(0x14b))/0x6*(parseInt(_0x1d1e59(0x12b))/0x7)+parseInt(_0x1d1e59(0x116))/0x8*(parseInt(_0x1d1e59(0x15b))/0x9)+-parseInt(_0x1d1e59(0x103))/0xa+parseInt(_0x1d1e59(0x137))/0xb;if(_0x5ed42f===_0x412cd9)break;else _0x4ca312['push'](_0x4ca312['shift']());}catch(_0x4694e8){_0x4ca312['push'](_0x4ca312['shift']());}}}(_0x31e6,0xf2a51));function _0x574f(_0x489db3,_0x56d161){const _0x31e665=_0x31e6();return _0x574f=function(_0x574f37,_0x45a59c){_0x574f37=_0x574f37-0xfc;let _0x2811fc=_0x31e665[_0x574f37];return _0x2811fc;},_0x574f(_0x489db3,_0x56d161);}var __decorate=this&&this[_0x292b46(0x10f)]||function(_0x569686,_0x2271e3,_0x4b7234,_0x346c21){const _0x217692=_0x292b46;var _0x31519b=arguments[_0x217692(0x15f)],_0x32d067=_0x31519b<0x3?_0x2271e3:_0x346c21===null?_0x346c21=Object[_0x217692(0x10c)](_0x2271e3,_0x4b7234):_0x346c21,_0x4ed8e5;if(typeof Reflect===_0x217692(0x15d)&&typeof Reflect['decorate']===_0x217692(0x120))_0x32d067=Reflect['decorate'](_0x569686,_0x2271e3,_0x4b7234,_0x346c21);else{for(var _0x5d2a77=_0x569686[_0x217692(0x15f)]-0x1;_0x5d2a77>=0x0;_0x5d2a77--)if(_0x4ed8e5=_0x569686[_0x5d2a77])_0x32d067=(_0x31519b<0x3?_0x4ed8e5(_0x32d067):_0x31519b>0x3?_0x4ed8e5(_0x2271e3,_0x4b7234,_0x32d067):_0x4ed8e5(_0x2271e3,_0x4b7234))||_0x32d067;}return _0x31519b>0x3&&_0x32d067&&Object[_0x217692(0x165)](_0x2271e3,_0x4b7234,_0x32d067),_0x32d067;},__metadata=this&&this['__metadata']||function(_0x245839,_0x3533fc){const _0x42ce27=_0x292b46;if(typeof Reflect===_0x42ce27(0x15d)&&typeof Reflect[_0x42ce27(0x118)]===_0x42ce27(0x120))return Reflect[_0x42ce27(0x118)](_0x245839,_0x3533fc);},__param=this&&this[_0x292b46(0x159)]||function(_0x57c0ab,_0x1ce8be){return function(_0x44869b,_0x41691e){_0x1ce8be(_0x44869b,_0x41691e,_0x57c0ab);};};function _0x31e6(){const _0x46b373=['delBadWords','UserEntity','extractContent','default','queryBadWords','NineAi检测','find','百度文本检测出现错误、请查看配置信息:\x20','42003093KjObLR','./../globalConfig/globalConfig.service','violationLogEntity','__esModule','敏感词检测\x20|\x20','findOne','delete','update','code','userId','keyword','status','敏感词不存在,请检查您的提交信息','map','../../common/utils','globalConfigService','282153YrCqOT','badWordsEntity','checkBadWords','log','889842LxiqYE','affected','hideString','更新敏感词成功','design:paramtypes','GlobalConfigService','stringify','data','./badwords.entity','super','更新敏感词失败','where','自定义检测','百度云检测','__param','***','13828734iEabsE','application/json','object','save','length','2012515JifJEW','nineaiCheckBadWords','updateBadWords','敏感词已经存在了、请勿重复添加','InjectRepository','defineProperty','recordUserBadWords','ViolationLogEntity','word_list','user','nineai','customSensitiveWords','BAD_REQUEST','badWords','match','post','category','@nestjs/common','12806100EmvFjM','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','findAndCount','execute','userInfo','BadWordsEntity','typeOriginCn','createQueryBuilder','DESC','getOwnPropertyDescriptor','的信息、我们已对您账号进行标记、请合规使用！','BadwordsService','__decorate','addBadWord','includes','baiduCheckBadWords','HttpException','typeorm','join','8dBXsfv','violationCount','metadata','2kXBBxi','avatar','loadBadWords','28uhlHwp','userEntity','239962pXtDOT','删除敏感词失败','function','的内容、我们已对您的账户进行标记、请合规使用！','../user/user.entity','baidu','forEach','检测失败','email','HttpStatus','onModuleInit','checkBadWordsByConfig','push','84Gzbzqe','username','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','Repository'];_0x31e6=function(){return _0x46b373;};return _0x31e6();}Object[_0x292b46(0x165)](exports,_0x292b46(0x13a),{'value':!![]}),exports['BadwordsService']=void 0x0;const globalConfig_service_1=require(_0x292b46(0x138)),common_1=require(_0x292b46(0x102)),badwords_entity_1=require(_0x292b46(0x153)),typeorm_1=require(_0x292b46(0x114)),typeorm_2=require('@nestjs/typeorm'),axios_1=require('axios'),violationLog_entity_1=require('./violationLog.entity'),user_entity_1=require(_0x292b46(0x122)),utils_1=require(_0x292b46(0x145));let BadwordsService=class BadwordsService{constructor(_0x27c9df,_0x5771c8,_0x4a6fa9,_0x257c55){const _0x152a0d=_0x292b46;this[_0x152a0d(0x148)]=_0x27c9df,this['violationLogEntity']=_0x5771c8,this[_0x152a0d(0x11d)]=_0x4a6fa9,this[_0x152a0d(0x146)]=_0x257c55,this[_0x152a0d(0xfe)]=[];}async[_0x292b46(0x128)](){this['loadBadWords']();}async[_0x292b46(0xfc)](_0x1da987,_0x58a0b5){const _0x23c831=_0x292b46,_0x2d4c0c=[];for(let _0x2e48f8=0x0;_0x2e48f8<this[_0x23c831(0xfe)]['length'];_0x2e48f8++){const _0x44bb96=this[_0x23c831(0xfe)][_0x2e48f8];_0x1da987[_0x23c831(0x111)](_0x44bb96)&&_0x2d4c0c[_0x23c831(0x12a)](_0x44bb96);}if(_0x2d4c0c[_0x23c831(0x15f)]){await this[_0x23c831(0x166)](_0x58a0b5,_0x1da987,_0x2d4c0c,['自定义'],_0x23c831(0x157));const _0x42239a=_0x23c831(0x104);throw new common_1[(_0x23c831(0x113))](_0x42239a,common_1[_0x23c831(0x127)]['BAD_REQUEST']);}return!![];}async[_0x292b46(0x149)](_0x1d8676,_0x2b962f){const _0x5c190f=_0x292b46,_0x2ffeb2=await this[_0x5c190f(0x146)]['getSensitiveConfig']();_0x2ffeb2&&await this[_0x5c190f(0x129)](_0x1d8676,_0x2ffeb2,_0x2b962f),await this[_0x5c190f(0xfc)](_0x1d8676,_0x2b962f);}async[_0x292b46(0x129)](_0x2dabad,_0x1bd731,_0x1ca584){const _0xf60bd7=_0x292b46,{useType:_0x1f0017}=_0x1bd731;_0x1f0017===_0xf60bd7(0x123)&&await this['baiduCheckBadWords'](_0x2dabad,_0x1bd731['baiduTextAccessToken'],_0x1ca584),_0x1f0017===_0xf60bd7(0x16a)&&await this[_0xf60bd7(0x161)](_0x2dabad,_0x1bd731,_0x1ca584);}['extractContent'](_0xcac529){const _0xb48c66=_0x292b46,_0xdd5182=/存在(.*?)不合规/,_0x48c219=_0xcac529[_0xb48c66(0xff)](_0xdd5182);return _0x48c219?_0x48c219[0x1]:'';}async[_0x292b46(0x112)](_0x20b754,_0x19fdd1,_0x4fcae7){const _0x311902=_0x292b46;if(!_0x19fdd1)return;const _0x7b9cee=_0x311902(0x12d)+_0x19fdd1+'}',_0x17a55f={'Content-Type':'application/x-www-form-urlencoded','Accept':_0x311902(0x15c)},_0x5c6f9b=await axios_1[_0x311902(0x132)][_0x311902(0x100)](_0x7b9cee,{'text':_0x20b754},{'headers':_0x17a55f}),{conclusion:_0x352f8e,error_code:_0x2e0b7a,error_msg:_0x251a78,conclusionType:_0x37762d,data:_0x49c0a2}=_0x5c6f9b['data'];_0x2e0b7a&&console[_0x311902(0x14a)](_0x311902(0x136),_0x251a78);if(_0x37762d!==0x1){const _0x2ab03c=[...new Set(_0x49c0a2[_0x311902(0x144)](_0x4b3d26=>this[_0x311902(0x131)](_0x4b3d26['msg'])))];await this[_0x311902(0x166)](_0x4fcae7,_0x20b754,[_0x311902(0x15a)],_0x2ab03c,_0x311902(0x158));const _0x3bdf5b='您提交的信息中包含'+_0x2ab03c[_0x311902(0x115)](',')+_0x311902(0x121);throw new common_1[(_0x311902(0x113))](_0x3bdf5b,common_1[_0x311902(0x127)]['BAD_REQUEST']);}}async[_0x292b46(0x161)](_0x20f61a,_0x82c287,_0x4653b0){const _0x4931b9=_0x292b46,{nineaiBuiltInSensitiveApiBase:_0x3d2e51,nineaiBuiltInSensitiveAuthKey:_0x29b363}=_0x82c287;if(!_0x3d2e51||!_0x29b363)return;const _0x3d88b6=await axios_1[_0x4931b9(0x132)][_0x4931b9(0x100)](_0x3d2e51,{'content':_0x20f61a},{'headers':{'Content-Type':'application/json','Authorization':_0x29b363}});if(!_0x3d88b6['data'])return;if(_0x3d88b6['data'][_0x4931b9(0x13f)]!=='0'){const {msg:msg=_0x4931b9(0x125)}=_0x3d88b6[_0x4931b9(0x152)];throw new common_1['HttpException'](_0x4931b9(0x13b)+msg,common_1[_0x4931b9(0x127)][_0x4931b9(0xfd)]);}if(_0x3d88b6[_0x4931b9(0x152)][_0x4931b9(0x168)]&&_0x3d88b6['data'][_0x4931b9(0x168)]?.[_0x4931b9(0x15f)]){const _0x599141=[...new Set(_0x3d88b6[_0x4931b9(0x152)][_0x4931b9(0x168)][_0x4931b9(0x144)](_0x20575e=>_0x20575e[_0x4931b9(0x141)]))],_0x271a9a=[...new Set(_0x3d88b6['data'][_0x4931b9(0x168)][_0x4931b9(0x144)](_0x510d12=>_0x510d12[_0x4931b9(0x101)]))];await this[_0x4931b9(0x166)](_0x4653b0,_0x20f61a,_0x599141,_0x271a9a,_0x4931b9(0x134));const _0x2f9b14=this['formarTips'](_0x3d88b6[_0x4931b9(0x152)]['word_list']);throw new common_1[(_0x4931b9(0x113))](_0x2f9b14,common_1['HttpStatus'][_0x4931b9(0xfd)]);}}['formarTips'](_0x4eb68e){const _0x38b72e=_0x292b46,_0x2ba4f8=_0x4eb68e[_0x38b72e(0x144)](_0xc8a3d5=>_0xc8a3d5[_0x38b72e(0x101)]),_0x35e0db=[...new Set(_0x2ba4f8)];return'您提交的内容中包含'+_0x35e0db[_0x38b72e(0x115)](',')+_0x38b72e(0x10d);}async[_0x292b46(0x11b)](){const _0x5b889d=_0x292b46,_0x47d168=await this['badWordsEntity'][_0x5b889d(0x135)]({'where':{'status':0x1},'select':['word']});this[_0x5b889d(0xfe)]=_0x47d168[_0x5b889d(0x144)](_0x566b3e=>_0x566b3e['word']);}async[_0x292b46(0x133)](_0xc105f6){const _0xb18fd4=_0x292b46,{page:page=0x1,size:size=0x1f4,word:_0x53a702,status:_0x399e83}=_0xc105f6,_0x51328e={};[0x0,0x1,'0','1'][_0xb18fd4(0x111)](_0x399e83)&&(_0x51328e[_0xb18fd4(0x142)]=_0x399e83),_0x53a702&&(_0x51328e['word']=(0x0,typeorm_1['Like'])('%'+_0x53a702+'%'));const [_0x925ff4,_0x37f235]=await this[_0xb18fd4(0x148)]['findAndCount']({'where':_0x51328e,'skip':(page-0x1)*size,'take':size,'order':{'id':'ASC'}});return{'rows':_0x925ff4,'count':_0x37f235};}async[_0x292b46(0x12f)](_0x4cb6e5){const _0x2d8bc2=_0x292b46,_0x1892d8=await this[_0x2d8bc2(0x148)][_0x2d8bc2(0x13c)]({'where':{'id':_0x4cb6e5['id']}});if(!_0x1892d8)throw new common_1[(_0x2d8bc2(0x113))](_0x2d8bc2(0x143),common_1[_0x2d8bc2(0x127)][_0x2d8bc2(0xfd)]);const _0x48ec32=await this[_0x2d8bc2(0x148)][_0x2d8bc2(0x13d)]({'id':_0x4cb6e5['id']});if(_0x48ec32[_0x2d8bc2(0x14c)]>0x0)return await this[_0x2d8bc2(0x11b)](),'删除敏感词成功';else throw new common_1[(_0x2d8bc2(0x113))](_0x2d8bc2(0x11f),common_1['HttpStatus'][_0x2d8bc2(0xfd)]);}async[_0x292b46(0x162)](_0xfa355e){const _0x47803b=_0x292b46,{id:_0x1677c1,word:_0x16f455,status:_0x4c00a6}=_0xfa355e,_0x168b85=await this[_0x47803b(0x148)][_0x47803b(0x13c)]({'where':{'word':_0x16f455}});if(_0x168b85)throw new common_1[(_0x47803b(0x113))](_0x47803b(0x163),common_1['HttpStatus'][_0x47803b(0xfd)]);const _0x54c949=await this[_0x47803b(0x148)]['update']({'id':_0x1677c1},{'word':_0x16f455,'status':_0x4c00a6});if(_0x54c949[_0x47803b(0x14c)]>0x0)return await this[_0x47803b(0x11b)](),_0x47803b(0x14e);else throw new common_1[(_0x47803b(0x113))](_0x47803b(0x155),common_1['HttpStatus'][_0x47803b(0xfd)]);}async[_0x292b46(0x110)](_0x4cb9cf){const _0x39971c=_0x292b46,{word:_0x108fd0}=_0x4cb9cf,_0xe0d2ba=await this[_0x39971c(0x148)]['findOne']({'where':{'word':_0x108fd0}});if(_0xe0d2ba)throw new common_1[(_0x39971c(0x113))]('敏感词已存在,请检查您的提交信息',common_1[_0x39971c(0x127)][_0x39971c(0xfd)]);return await this[_0x39971c(0x148)][_0x39971c(0x15e)]({'word':_0x108fd0}),await this['loadBadWords'](),'添加敏感词成功';}async[_0x292b46(0x166)](_0x108ce9,_0x5b93ce,_0x454267,_0x2de8f4,_0x10bd06){const _0x583f45=_0x292b46,_0x136c55={'userId':_0x108ce9,'content':_0x5b93ce,'words':JSON[_0x583f45(0x151)](_0x454267),'typeCn':JSON[_0x583f45(0x151)](_0x2de8f4),'typeOriginCn':_0x10bd06};try{await this[_0x583f45(0x11d)][_0x583f45(0x10a)]()[_0x583f45(0x13e)](user_entity_1['UserEntity'])['set']({'violationCount':()=>'violationCount\x20+\x201'})[_0x583f45(0x156)]('id\x20=\x20:userId',{'userId':_0x108ce9})[_0x583f45(0x106)](),await this['violationLogEntity'][_0x583f45(0x15e)](_0x136c55);}catch(_0x50624f){console[_0x583f45(0x14a)]('error:\x20',_0x50624f);}}async['violation'](_0x539596,_0x5a9ec3){const _0x4de4f1=_0x292b46,{role:_0x57ca8a}=_0x539596[_0x4de4f1(0x169)],{page:page=0x1,size:size=0xa,userId:_0x3210bd,typeOriginCn:_0x57078b}=_0x5a9ec3,_0x587a70={};_0x3210bd&&(_0x587a70[_0x4de4f1(0x140)]=_0x3210bd),_0x57078b&&(_0x587a70[_0x4de4f1(0x109)]=_0x57078b);const [_0x1b59d8,_0x258d95]=await this[_0x4de4f1(0x139)][_0x4de4f1(0x105)]({'where':_0x587a70,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x4de4f1(0x10b)}}),_0x262160=[...new Set(_0x1b59d8[_0x4de4f1(0x144)](_0xd8ca0b=>_0xd8ca0b[_0x4de4f1(0x140)]))],_0x25dc80=await this['userEntity'][_0x4de4f1(0x135)]({'where':{'id':(0x0,typeorm_1['In'])(_0x262160)},'select':['id',_0x4de4f1(0x11a),_0x4de4f1(0x12c),'email',_0x4de4f1(0x117),_0x4de4f1(0x142)]});return _0x1b59d8[_0x4de4f1(0x124)](_0x54b476=>{const _0xfc8454=_0x4de4f1,_0x3ff4f9=_0x25dc80[_0xfc8454(0x135)](_0x67d919=>_0x67d919['id']===_0x54b476[_0xfc8454(0x140)]);_0x57ca8a!==_0xfc8454(0x154)&&(_0x3ff4f9[_0xfc8454(0x126)]=(0x0,utils_1[_0xfc8454(0x14d)])(_0x3ff4f9[_0xfc8454(0x126)])),_0x54b476[_0xfc8454(0x107)]=_0x3ff4f9;}),{'rows':_0x1b59d8,'count':_0x258d95};}};BadwordsService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_2[_0x292b46(0x164)])(badwords_entity_1[_0x292b46(0x108)])),__param(0x1,(0x0,typeorm_2['InjectRepository'])(violationLog_entity_1[_0x292b46(0x167)])),__param(0x2,(0x0,typeorm_2[_0x292b46(0x164)])(user_entity_1[_0x292b46(0x130)])),__metadata(_0x292b46(0x14f),[typeorm_1['Repository'],typeorm_1[_0x292b46(0x12e)],typeorm_1[_0x292b46(0x12e)],globalConfig_service_1[_0x292b46(0x150)]])],BadwordsService),exports[_0x292b46(0x10e)]=BadwordsService;