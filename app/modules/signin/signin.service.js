'use strict';const _0x1e84ae=_0x4bd0;(function(_0x57e5d3,_0x2bbc58){const _0x40f4b2=_0x4bd0,_0x1218b7=_0x57e5d3();while(!![]){try{const _0x55f384=parseInt(_0x40f4b2(0x144))/0x1*(parseInt(_0x40f4b2(0x149))/0x2)+-parseInt(_0x40f4b2(0x16c))/0x3+parseInt(_0x40f4b2(0x14d))/0x4+parseInt(_0x40f4b2(0x14b))/0x5+parseInt(_0x40f4b2(0x15b))/0x6*(-parseInt(_0x40f4b2(0x184))/0x7)+parseInt(_0x40f4b2(0x156))/0x8+parseInt(_0x40f4b2(0x15a))/0x9*(-parseInt(_0x40f4b2(0x152))/0xa);if(_0x55f384===_0x2bbc58)break;else _0x1218b7['push'](_0x1218b7['shift']());}catch(_0x2decf6){_0x1218b7['push'](_0x1218b7['shift']());}}}(_0x56a8,0x9d2cd));var __decorate=this&&this[_0x1e84ae(0x147)]||function(_0x4f8006,_0x448f41,_0x14bca9,_0x1197df){const _0x3ed38d=_0x1e84ae;var _0x86096e=arguments[_0x3ed38d(0x169)],_0x3c1b0d=_0x86096e<0x3?_0x448f41:_0x1197df===null?_0x1197df=Object[_0x3ed38d(0x16b)](_0x448f41,_0x14bca9):_0x1197df,_0x13eea5;if(typeof Reflect===_0x3ed38d(0x165)&&typeof Reflect[_0x3ed38d(0x178)]===_0x3ed38d(0x17e))_0x3c1b0d=Reflect['decorate'](_0x4f8006,_0x448f41,_0x14bca9,_0x1197df);else{for(var _0x297ef0=_0x4f8006[_0x3ed38d(0x169)]-0x1;_0x297ef0>=0x0;_0x297ef0--)if(_0x13eea5=_0x4f8006[_0x297ef0])_0x3c1b0d=(_0x86096e<0x3?_0x13eea5(_0x3c1b0d):_0x86096e>0x3?_0x13eea5(_0x448f41,_0x14bca9,_0x3c1b0d):_0x13eea5(_0x448f41,_0x14bca9))||_0x3c1b0d;}return _0x86096e>0x3&&_0x3c1b0d&&Object[_0x3ed38d(0x170)](_0x448f41,_0x14bca9,_0x3c1b0d),_0x3c1b0d;},__metadata=this&&this[_0x1e84ae(0x143)]||function(_0x4b3d26,_0x46aa6f){const _0x3169c6=_0x1e84ae;if(typeof Reflect===_0x3169c6(0x165)&&typeof Reflect[_0x3169c6(0x18e)]===_0x3169c6(0x17e))return Reflect[_0x3169c6(0x18e)](_0x4b3d26,_0x46aa6f);},__param=this&&this[_0x1e84ae(0x16d)]||function(_0xcdf770,_0x158cd7){return function(_0x4984be,_0x50391c){_0x158cd7(_0x4984be,_0x50391c,_0xcdf770);};};function _0x56a8(){const _0xaa17c2=['HttpException','startOf','signin','今日已签到、改天再来吧!.','GlobalConfigService','debug','getSignatureGiftConfig','globalConfigService','获取签到数据失败！','metadata','setDate','../../common/utils/date','design:paramtypes','save','__metadata','4rsBvDx','@nestjs/typeorm','__esModule','__decorate','signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned','469562bvhVTy','Sign\x20in\x20successful.','2420035kgxvyv','SigninEntity','4493180qgRcAj','signinEntity','error:\x20','update','select','7648630BdfWpn','month','Logger','昨天没签到、今天重置天数！','6762832LSHcrX','saveRecordRechargeLog','getRawMany','findOne','27sIIAAs','156FFdegP','UserEntity','log','addBalanceToUser','SigninService','Repository','昨天签到了、今天是连续签到！','signInDate','userBalanceService','InjectRepository','object','Injectable','day','YYYY-MM-DD','length','用户不存在','getOwnPropertyDescriptor','320622HbXttY','__param','format','getSigninLog','defineProperty','default','RechargeType','../user/user.entity','./signIn.entity','../../common/constants/balance.constant','YYYY-MM-DD\x20HH:mm:ss','user','decorate','sign','HttpStatus','signin.signInTime\x20<=\x20:lastDay','userEntity','./../globalConfig/globalConfig.service','function','signin.signInTime\x20>=\x20:firstDay','createQueryBuilder','push','BAD_REQUEST','andWhere','93296VHdOrY'];_0x56a8=function(){return _0xaa17c2;};return _0x56a8();}Object[_0x1e84ae(0x170)](exports,_0x1e84ae(0x146),{'value':!![]}),exports[_0x1e84ae(0x15f)]=void 0x0;const globalConfig_service_1=require(_0x1e84ae(0x17d)),userBalance_service_1=require('./../userBalance/userBalance.service'),common_1=require('@nestjs/common'),signIn_entity_1=require(_0x1e84ae(0x174)),typeorm_1=require(_0x1e84ae(0x145)),typeorm_2=require('typeorm'),date_1=require(_0x1e84ae(0x140)),user_entity_1=require(_0x1e84ae(0x173)),balance_constant_1=require(_0x1e84ae(0x175));function _0x4bd0(_0x44e2a5,_0x5d2ac2){const _0x56a89f=_0x56a8();return _0x4bd0=function(_0x4bd0f1,_0x72e6d3){_0x4bd0f1=_0x4bd0f1-0x13f;let _0x49d521=_0x56a89f[_0x4bd0f1];return _0x49d521;},_0x4bd0(_0x44e2a5,_0x5d2ac2);}let SigninService=class SigninService{constructor(_0x34255e,_0x333937,_0x188f7c,_0x41c92c){const _0x1f6407=_0x1e84ae;this['signinEntity']=_0x34255e,this['userEntity']=_0x333937,this[_0x1f6407(0x163)]=_0x188f7c,this[_0x1f6407(0x18c)]=_0x41c92c;}async[_0x1e84ae(0x179)](_0x3d3ed7){const _0x4b5cca=_0x1e84ae,{id:_0x1fdcd5}=_0x3d3ed7[_0x4b5cca(0x177)],_0x28fad4=(0x0,date_1['default'])(new Date())[_0x4b5cca(0x16e)](_0x4b5cca(0x168)),_0x3e6a61=await this[_0x4b5cca(0x14e)][_0x4b5cca(0x159)]({'where':{'userId':_0x1fdcd5,'signInDate':_0x28fad4}});if(_0x3e6a61)throw new common_1[(_0x4b5cca(0x185))](_0x4b5cca(0x188),common_1[_0x4b5cca(0x17a)][_0x4b5cca(0x182)]);const {model3Count:_0x2b3560,model4Count:_0x2f37e3,drawMjCount:_0x1e056d}=await this[_0x4b5cca(0x18c)][_0x4b5cca(0x18b)]();await this[_0x4b5cca(0x14e)][_0x4b5cca(0x142)]({'userId':_0x1fdcd5,'signInTime':new Date(),'signInDate':_0x28fad4,'isSigned':!![]}),await this[_0x4b5cca(0x163)][_0x4b5cca(0x15e)](_0x1fdcd5,{'model3Count':_0x2b3560,'model4Count':_0x2f37e3,'drawMjCount':_0x1e056d}),await this[_0x4b5cca(0x163)][_0x4b5cca(0x157)]({'userId':_0x1fdcd5,'rechargeType':balance_constant_1[_0x4b5cca(0x172)]['SIGN_IN'],'model3Count':_0x2b3560,'model4Count':_0x2f37e3,'drawMjCount':_0x1e056d});const _0x5bcb83=(0x0,date_1[_0x4b5cca(0x171)])(new Date())['subtract'](0x1,_0x4b5cca(0x167))[_0x4b5cca(0x16e)](_0x4b5cca(0x168)),_0x1b322b=await this[_0x4b5cca(0x14e)][_0x4b5cca(0x159)]({'where':{'userId':_0x1fdcd5,'signInDate':_0x5bcb83}});if(_0x1b322b){common_1[_0x4b5cca(0x154)][_0x4b5cca(0x18a)]('用户'+_0x1fdcd5+_0x4b5cca(0x161),_0x4b5cca(0x15f));const _0x701776=await this['userEntity'][_0x4b5cca(0x159)]({'where':{'id':_0x1fdcd5}});if(!_0x701776)throw new common_1['HttpException'](_0x4b5cca(0x16a),common_1[_0x4b5cca(0x17a)][_0x4b5cca(0x182)]);const {consecutiveDays:consecutiveDays=0x0}=_0x701776;await this['userEntity'][_0x4b5cca(0x150)]({'id':_0x1fdcd5},{'consecutiveDays':consecutiveDays+0x1});}else common_1[_0x4b5cca(0x154)][_0x4b5cca(0x18a)]('用户'+_0x1fdcd5+_0x4b5cca(0x155),_0x4b5cca(0x15f)),await this[_0x4b5cca(0x17c)][_0x4b5cca(0x150)]({'id':_0x1fdcd5},{'consecutiveDays':0x1});return _0x4b5cca(0x14a);}async[_0x1e84ae(0x16f)](_0x32657f){const _0x24d58c=_0x1e84ae;try{const {id:_0x6d84e5}=_0x32657f[_0x24d58c(0x177)],_0x3291c7=(0x0,date_1['default'])()[_0x24d58c(0x186)](_0x24d58c(0x153))['format'](_0x24d58c(0x176)),_0x5dc87a=(0x0,date_1[_0x24d58c(0x171)])()['endOf'](_0x24d58c(0x153))['format'](_0x24d58c(0x176)),_0x221adf=this[_0x24d58c(0x14e)][_0x24d58c(0x180)](_0x24d58c(0x187)),_0x3bc8c8=await _0x221adf[_0x24d58c(0x151)](_0x24d58c(0x148))['andWhere']('signin.userId\x20=\x20:userId',{'userId':_0x32657f[_0x24d58c(0x177)]['id']})[_0x24d58c(0x183)](_0x24d58c(0x17f),{'firstDay':_0x3291c7})['andWhere'](_0x24d58c(0x17b),{'lastDay':_0x5dc87a})[_0x24d58c(0x158)](),_0x55057b=new Date(_0x3291c7),_0x4275ee=new Date(_0x5dc87a),_0x59ec0c=[],_0x314579=new Date(_0x55057b);while(_0x314579<=_0x4275ee){_0x59ec0c[_0x24d58c(0x181)]((0x0,date_1['default'])(new Date(_0x314579))[_0x24d58c(0x16e)](_0x24d58c(0x168))),_0x314579[_0x24d58c(0x13f)](_0x314579['getDate']()+0x1);}const _0x9f67c2=[];for(const _0x173422 of _0x59ec0c){const _0x43467a=_0x3bc8c8['find'](_0x38ab9=>_0x38ab9[_0x24d58c(0x162)]===_0x173422);!_0x43467a?_0x9f67c2[_0x24d58c(0x181)]({'signInDate':_0x173422,'isSigned':![]}):(_0x43467a['isSigned']=!![],_0x9f67c2[_0x24d58c(0x181)](_0x43467a));}return _0x9f67c2;}catch(_0x518910){console[_0x24d58c(0x15d)](_0x24d58c(0x14f),_0x518910);throw new common_1['HttpException'](_0x24d58c(0x18d),common_1[_0x24d58c(0x17a)][_0x24d58c(0x182)]);}}};SigninService=__decorate([(0x0,common_1[_0x1e84ae(0x166)])(),__param(0x0,(0x0,typeorm_1[_0x1e84ae(0x164)])(signIn_entity_1[_0x1e84ae(0x14c)])),__param(0x1,(0x0,typeorm_1[_0x1e84ae(0x164)])(user_entity_1[_0x1e84ae(0x15c)])),__metadata(_0x1e84ae(0x141),[typeorm_2[_0x1e84ae(0x160)],typeorm_2['Repository'],userBalance_service_1['UserBalanceService'],globalConfig_service_1[_0x1e84ae(0x189)]])],SigninService),exports['SigninService']=SigninService;