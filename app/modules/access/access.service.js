'use strict';function _0x58e7(_0x18069e,_0x4ffbcb){const _0x284bff=_0x284b();return _0x58e7=function(_0x58e7ae,_0x559282){_0x58e7ae=_0x58e7ae-0x13e;let _0x1c2df6=_0x284bff[_0x58e7ae];return _0x1c2df6;},_0x58e7(_0x18069e,_0x4ffbcb);}const _0x5b0912=_0x58e7;(function(_0x574c1f,_0xb7994b){const _0x30c65a=_0x58e7,_0x5e15a4=_0x574c1f();while(!![]){try{const _0x8aa5c6=-parseInt(_0x30c65a(0x147))/0x1+parseInt(_0x30c65a(0x158))/0x2+parseInt(_0x30c65a(0x15b))/0x3+-parseInt(_0x30c65a(0x15f))/0x4+-parseInt(_0x30c65a(0x18b))/0x5*(parseInt(_0x30c65a(0x175))/0x6)+-parseInt(_0x30c65a(0x167))/0x7*(-parseInt(_0x30c65a(0x159))/0x8)+parseInt(_0x30c65a(0x178))/0x9;if(_0x8aa5c6===_0xb7994b)break;else _0x5e15a4['push'](_0x5e15a4['shift']());}catch(_0x3af017){_0x5e15a4['push'](_0x5e15a4['shift']());}}}(_0x284b,0x1d6a6));var __decorate=this&&this[_0x5b0912(0x155)]||function(_0x183ac7,_0x24be8a,_0x4708a8,_0x1ab75b){const _0xe3b40c=_0x5b0912;var _0x729151=arguments[_0xe3b40c(0x18d)],_0xa300dc=_0x729151<0x3?_0x24be8a:_0x1ab75b===null?_0x1ab75b=Object['getOwnPropertyDescriptor'](_0x24be8a,_0x4708a8):_0x1ab75b,_0x5bd636;if(typeof Reflect===_0xe3b40c(0x162)&&typeof Reflect[_0xe3b40c(0x152)]===_0xe3b40c(0x15e))_0xa300dc=Reflect[_0xe3b40c(0x152)](_0x183ac7,_0x24be8a,_0x4708a8,_0x1ab75b);else{for(var _0x2e4173=_0x183ac7[_0xe3b40c(0x18d)]-0x1;_0x2e4173>=0x0;_0x2e4173--)if(_0x5bd636=_0x183ac7[_0x2e4173])_0xa300dc=(_0x729151<0x3?_0x5bd636(_0xa300dc):_0x729151>0x3?_0x5bd636(_0x24be8a,_0x4708a8,_0xa300dc):_0x5bd636(_0x24be8a,_0x4708a8))||_0xa300dc;}return _0x729151>0x3&&_0xa300dc&&Object[_0xe3b40c(0x14b)](_0x24be8a,_0x4708a8,_0xa300dc),_0xa300dc;},__metadata=this&&this[_0x5b0912(0x16a)]||function(_0x52c525,_0x17b526){const _0x5883f9=_0x5b0912;if(typeof Reflect===_0x5883f9(0x162)&&typeof Reflect[_0x5883f9(0x13e)]===_0x5883f9(0x15e))return Reflect[_0x5883f9(0x13e)](_0x52c525,_0x17b526);},__param=this&&this[_0x5b0912(0x142)]||function(_0x3a7456,_0x13f554){return function(_0x2a4c7c,_0x44e0fa){_0x13f554(_0x2a4c7c,_0x44e0fa,_0x3a7456);};};Object[_0x5b0912(0x14b)](exports,'__esModule',{'value':!![]}),exports[_0x5b0912(0x177)]=void 0x0;const common_1=require(_0x5b0912(0x15a)),typeorm_1=require(_0x5b0912(0x163)),access_entity_1=require(_0x5b0912(0x165)),typeorm_2=require(_0x5b0912(0x183)),user_service_1=require(_0x5b0912(0x188)),utils_1=require('../../common/utils');let AccessService=class AccessService{constructor(_0x475b3a,_0x513c57){const _0x2cf37b=_0x5b0912;this['accessEntity']=_0x475b3a,this[_0x2cf37b(0x176)]=_0x513c57,this[_0x2cf37b(0x17b)]=new Map(),this[_0x2cf37b(0x17b)][_0x2cf37b(0x173)]();}async[_0x5b0912(0x157)](_0x3e8bf5){const _0x4a1eca=_0x5b0912;return await this[_0x4a1eca(0x187)]['findOne']({'where':{'userId':_0x3e8bf5}});}async[_0x5b0912(0x140)](_0x58a375){const _0x5f5c61=_0x5b0912,{id:_0x226aa7}=_0x58a375;if(!_0x226aa7)throw new common_1[(_0x5f5c61(0x141))](_0x5f5c61(0x166),common_1[_0x5f5c61(0x14d)][_0x5f5c61(0x150)]);const _0x1859ab=await this[_0x5f5c61(0x176)]['getUserById'](_0x226aa7);if(!_0x1859ab)throw new common_1[(_0x5f5c61(0x141))](_0x5f5c61(0x153),common_1[_0x5f5c61(0x14d)][_0x5f5c61(0x150)]);const _0x15f2e9=await this[_0x5f5c61(0x187)][_0x5f5c61(0x184)]({'where':{'userId':_0x1859ab['id']}});if(!_0x15f2e9)throw new common_1[(_0x5f5c61(0x141))]('管理员不存在',common_1[_0x5f5c61(0x14d)][_0x5f5c61(0x150)]);const {role:_0x2f39b2,username:_0x3c1f5b}=_0x1859ab;return{..._0x15f2e9,'role':_0x2f39b2,'password':_0x1859ab[_0x5f5c61(0x182)],'username':_0x3c1f5b,'id':_0x1859ab['id']};}async['queryManagerAccess'](_0x13fbc6,_0x49900e){const _0x13168d=_0x5b0912,{page:page=0x1,size:size=0xa,username:_0x54c939,status:_0x129745,phone:_0x42ff62}=_0x13fbc6;if(!page||!size)throw new common_1[(_0x13168d(0x141))](_0x13168d(0x17e),0x190);const _0x1143c9={'userType':0x1};if(_0x54c939){const {rows:_0x32226c}=await this[_0x13168d(0x176)][_0x13168d(0x169)]({'page':page,'size':size,'username':_0x54c939,'email':'','status':0x0,'keyword':'','phone':_0x42ff62}),_0x14d183=_0x32226c[_0x13168d(0x16d)](_0x339f9a=>_0x339f9a['id']),_0x4ee3b8=await this[_0x13168d(0x187)]['findBy']({'userId':(0x0,typeorm_2['In'])(_0x14d183)}),_0x555a7b=new Map();_0x32226c['forEach'](_0x2784cd=>{const _0x3c1d1b=_0x13168d;_0x555a7b[_0x3c1d1b(0x190)](_0x2784cd['id'],_0x2784cd);});const _0x1fc45b=_0x4ee3b8[_0x13168d(0x16d)](_0xbb86f0=>Object[_0x13168d(0x16c)]({},_0xbb86f0,_0x555a7b[_0x13168d(0x172)](_0xbb86f0[_0x13168d(0x16b)])));let _0x2f0184=_0x129745>0x0?_0x1fc45b[_0x13168d(0x14c)](_0x5ed237=>_0x5ed237[_0x13168d(0x186)]===_0x129745):_0x1fc45b;return{'rows':_0x2f0184||[],'count':_0x2f0184[_0x13168d(0x18d)]||0x0};}[0x1,0x2,'1','2']['includes'](_0x129745)&&(_0x1143c9[_0x13168d(0x186)]=_0x129745);const [_0x3f4c20,_0x40ad56]=await this['accessEntity']['findAndCount']({'skip':(page-0x1)*size,'where':_0x1143c9,'take':size,'order':{'createdAt':_0x13168d(0x151)},'cache':!![],'select':[_0x13168d(0x186),_0x13168d(0x16b),_0x13168d(0x189),'id']}),_0x1b2128=_0x3f4c20[_0x13168d(0x16d)](_0x3a0fd9=>_0x3a0fd9[_0x13168d(0x16b)]),_0x2bb64e=await this[_0x13168d(0x176)][_0x13168d(0x181)](_0x1b2128);_0x2bb64e[_0x13168d(0x156)](_0x20046a=>this[_0x13168d(0x17b)]['set'](_0x20046a['id'],_0x20046a));const _0x1d53c3=_0x3f4c20[_0x13168d(0x16d)](_0x67de11=>{const _0x41a8de=_0x13168d,_0x4a8b4b=this['userMap']['get'](_0x67de11[_0x41a8de(0x16b)]);return Object['assign']({},_0x4a8b4b,_0x67de11);});return{'rows':_0x1d53c3||[],'count':_0x40ad56||0x0};}async[_0x5b0912(0x144)](_0x30ac4a){const _0x114896=_0x5b0912;return await this[_0x114896(0x187)][_0x114896(0x161)]({'where':{'userId':(0x0,typeorm_2['In'])(_0x30ac4a)},'select':['id',_0x114896(0x189),_0x114896(0x160),_0x114896(0x16b)]});}async[_0x5b0912(0x170)](){const _0x3e54fc=_0x5b0912;return await this[_0x3e54fc(0x187)][_0x3e54fc(0x18e)]();}async[_0x5b0912(0x179)](_0x1fa482){const _0x100985=_0x5b0912,{id:_0x3a18e2}=_0x1fa482,_0x82a5be=await this[_0x100985(0x187)][_0x100985(0x184)]({'where':{'id':_0x3a18e2}}),_0x3f0214=await this['userService'][_0x100985(0x14f)]({'id':_0x82a5be[_0x100985(0x16b)],'moreId':0x0});if(_0x3f0214)return this[_0x100985(0x187)][_0x100985(0x146)]({'id':_0x3a18e2});return![];}async['handleManagerAdd'](_0x4a7837){const _0x154b57=_0x5b0912,{username:_0x46d4d2,access:_0x1f6d82,role:_0x36b35c,password:_0x4b51d9}=_0x4a7837,_0x2ef3a4=await this[_0x154b57(0x176)][_0x154b57(0x18f)](_0x46d4d2);if(_0x2ef3a4&&(0x0,utils_1[_0x154b57(0x15d)])(_0x46d4d2,_0x2ef3a4[_0x154b57(0x182)]))throw new common_1[(_0x154b57(0x141))]('管理员已存在',common_1['HttpStatus']['BAD_REQUEST']);const _0x3c1172=(0x0,utils_1['createPsd'])(_0x4b51d9),_0x55b8fc=(0x0,utils_1[_0x154b57(0x185)])()+_0x154b57(0x17c),_0x30ae20=await this[_0x154b57(0x176)]['createUser']({'email':_0x55b8fc,'username':_0x46d4d2,'status':0x1,'password':_0x3c1172,'sex':0x1,'role':_0x36b35c});if(!_0x30ae20)throw new common_1[(_0x154b57(0x141))](_0x154b57(0x180),common_1[_0x154b57(0x14d)]['BAD_REQUEST']);try{const _0x25ad07=_0x1f6d82[_0x154b57(0x18d)]&&JSON[_0x154b57(0x148)](_0x1f6d82)[_0x154b57(0x16d)](_0x3a2cdc=>_0x3a2cdc[_0x154b57(0x15c)])['flat'](),_0x18c725=await this[_0x154b57(0x17f)]({'userType':0x1,'access':_0x1f6d82,'userId':_0x30ae20['id'],'accessLabel':_0x25ad07['length']?_0x25ad07:''});return!!_0x18c725;}catch(_0x147e1e){console['log']('error:\x20',_0x147e1e);throw new common_1['HttpException'](_0x147e1e,common_1['HttpStatus'][_0x154b57(0x150)]);}}async[_0x5b0912(0x17f)](_0x30cf15){const _0x3c8af1=_0x5b0912,{userType:_0x3e93b8,access:_0x4c24c3,userId:_0x23da51,accessLabel:_0x2d0e91}=_0x30cf15;return await this[_0x3c8af1(0x187)][_0x3c8af1(0x18c)]({'userType':_0x3e93b8,'access':_0x4c24c3,'userId':_0x23da51,'accessLabel':_0x2d0e91&&JSON[_0x3c8af1(0x164)](_0x2d0e91)||''});}async[_0x5b0912(0x174)](_0x5548ea){const _0x200211=_0x5b0912,{id:_0x41bbbc,userId:_0x4f3dba,access:_0x1a4013}=_0x5548ea,_0x1da1d5=await this[_0x200211(0x176)][_0x200211(0x18a)]({'id':_0x4f3dba});if(!_0x1da1d5)throw new common_1['HttpException']('管理员不存在，请核对',common_1[_0x200211(0x14d)][_0x200211(0x16e)]);try{const _0x13f825=_0x1a4013[_0x200211(0x18d)]&&JSON[_0x200211(0x148)](_0x1a4013)[_0x200211(0x16d)](_0x14b520=>_0x14b520['checked'])[_0x200211(0x145)](),_0x451e3e=await this[_0x200211(0x187)][_0x200211(0x17a)]({'userId':_0x1da1d5['id']},{'userId':_0x4f3dba,'access':_0x1a4013,'accessLabel':_0x13f825&&JSON[_0x200211(0x164)](_0x13f825)||''})[_0x200211(0x17d)](_0x5ac6d2=>{throw _0x5ac6d2;});return!!_0x451e3e;}catch(_0x1bdc62){return console[_0x200211(0x171)](_0x1bdc62),![];}}async[_0x5b0912(0x14e)](_0x117930){const _0x54ed3b=_0x5b0912,{id:_0x39e862,status:_0x422e3c}=_0x117930,_0x1fc271=await this[_0x54ed3b(0x187)][_0x54ed3b(0x17a)](_0x39e862,{'managerStatus':_0x422e3c});return _0x1fc271[_0x54ed3b(0x154)]>0x0;}async[_0x5b0912(0x14a)](_0xb463e0){const _0x407fcf=_0x5b0912,{id:_0xfe6dd}=_0xb463e0,_0x320a23='123456',_0xcbf9b2=await this['accessEntity'][_0x407fcf(0x184)]({'where':{'id':_0xfe6dd}});return this['userService'][_0x407fcf(0x143)](_0xcbf9b2[_0x407fcf(0x16b)],_0x320a23);}};function _0x284b(){const _0x15389b=['handleSaveAccess','添加管理员失败','queryUserInfoByIds','password','typeorm','findOne','createRandomUid','managerStatus','accessEntity','../user/user.service','accessLabel','queryOne','845745pYuztx','save','length','count','queryUserByUsername','set','metadata','InjectRepository','getManagerAccess','HttpException','__param','updateUserPassword','queryAccessByIds','flat','delete','135079dBScQK','parse','Injectable','handleResetPassword','defineProperty','filter','HttpStatus','handleUpdateStatus','delUser','BAD_REQUEST','DESC','decorate','用户不存在','affected','__decorate','forEach','getOne','419722nHnVdq','8fWpzoB','@nestjs/common','517200xMASrp','checked','comparePassword','function','438020qDkVjG','createdAt','find','object','@nestjs/typeorm','stringify','./access.entity','参数错误','458066ELbQLQ','AccessEntity','queryByPage','__metadata','userId','assign','map','GONE','UserService','queryAccessCount','log','get','clear','handleManagerUpdate','6SiQulu','userService','AccessService','778680rvQXpW','setManagerDelete','update','userMap','@manager.com','catch','分页参数错误'];_0x284b=function(){return _0x15389b;};return _0x284b();}AccessService=__decorate([(0x0,common_1[_0x5b0912(0x149)])(),__param(0x0,(0x0,typeorm_1[_0x5b0912(0x13f)])(access_entity_1[_0x5b0912(0x168)])),__metadata('design:paramtypes',[typeorm_2['Repository'],user_service_1[_0x5b0912(0x16f)]])],AccessService),exports[_0x5b0912(0x177)]=AccessService;