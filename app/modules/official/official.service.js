'use strict';function _0x49da(_0x520176,_0x5becb3){const _0x5d0098=_0x5d00();return _0x49da=function(_0x49dabb,_0x1134bd){_0x49dabb=_0x49dabb-0x107;let _0x2abf86=_0x5d0098[_0x49dabb];return _0x2abf86;},_0x49da(_0x520176,_0x5becb3);}const _0x44a1cd=_0x49da;(function(_0x9fc7b2,_0x47898b){const _0x43cf99=_0x49da,_0x34d01c=_0x9fc7b2();while(!![]){try{const _0x259c3f=-parseInt(_0x43cf99(0x16a))/0x1*(parseInt(_0x43cf99(0x12a))/0x2)+parseInt(_0x43cf99(0x108))/0x3*(parseInt(_0x43cf99(0x148))/0x4)+-parseInt(_0x43cf99(0x155))/0x5+-parseInt(_0x43cf99(0x114))/0x6+parseInt(_0x43cf99(0x15c))/0x7*(parseInt(_0x43cf99(0x153))/0x8)+-parseInt(_0x43cf99(0x123))/0x9*(-parseInt(_0x43cf99(0x136))/0xa)+parseInt(_0x43cf99(0x147))/0xb;if(_0x259c3f===_0x47898b)break;else _0x34d01c['push'](_0x34d01c['shift']());}catch(_0x107144){_0x34d01c['push'](_0x34d01c['shift']());}}}(_0x5d00,0x90d4b));var __decorate=this&&this['__decorate']||function(_0x4502ae,_0x14fa25,_0x2057e5,_0x50d329){const _0x5f42d8=_0x49da;var _0x358d73=arguments['length'],_0x2e4062=_0x358d73<0x3?_0x14fa25:_0x50d329===null?_0x50d329=Object[_0x5f42d8(0x13a)](_0x14fa25,_0x2057e5):_0x50d329,_0x4f4f1c;if(typeof Reflect===_0x5f42d8(0x168)&&typeof Reflect[_0x5f42d8(0x131)]===_0x5f42d8(0x121))_0x2e4062=Reflect[_0x5f42d8(0x131)](_0x4502ae,_0x14fa25,_0x2057e5,_0x50d329);else{for(var _0x1b3720=_0x4502ae['length']-0x1;_0x1b3720>=0x0;_0x1b3720--)if(_0x4f4f1c=_0x4502ae[_0x1b3720])_0x2e4062=(_0x358d73<0x3?_0x4f4f1c(_0x2e4062):_0x358d73>0x3?_0x4f4f1c(_0x14fa25,_0x2057e5,_0x2e4062):_0x4f4f1c(_0x14fa25,_0x2057e5))||_0x2e4062;}return _0x358d73>0x3&&_0x2e4062&&Object[_0x5f42d8(0x138)](_0x14fa25,_0x2057e5,_0x2e4062),_0x2e4062;},__metadata=this&&this['__metadata']||function(_0x388416,_0x554440){const _0x346d1e=_0x49da;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x346d1e(0x121))return Reflect[_0x346d1e(0x12c)](_0x388416,_0x554440);};Object[_0x44a1cd(0x138)](exports,_0x44a1cd(0x10e),{'value':!![]}),exports[_0x44a1cd(0x156)]=void 0x0;const globalConfig_service_1=require(_0x44a1cd(0x164)),auth_service_1=require('./../auth/auth.service'),user_service_1=require(_0x44a1cd(0x154)),autoreply_service_1=require('./../autoreply/autoreply.service'),common_1=require(_0x44a1cd(0x163)),crypto=require('crypto'),axios_1=require('axios'),utils_1=require(_0x44a1cd(0x129)),Login_vo_1=require(_0x44a1cd(0x13b)),redisKey_constant_1=require(_0x44a1cd(0x13c)),redisCache_service_1=require(_0x44a1cd(0x152));let OfficialService=class OfficialService{constructor(_0x15e74d,_0x55de81,_0x553a0d,_0x30459c,_0x2e19fd){const _0x43cd2d=_0x44a1cd;this[_0x43cd2d(0x117)]=_0x15e74d,this[_0x43cd2d(0x149)]=_0x55de81,this['authService']=_0x553a0d,this[_0x43cd2d(0x12e)]=_0x30459c,this[_0x43cd2d(0x109)]=_0x2e19fd,this['sceneStrMap']={},this[_0x43cd2d(0x130)]={};}async[_0x44a1cd(0x10f)](){const _0x4b6685=_0x44a1cd;await this['globalConfigService'][_0x4b6685(0x12b)](!![]);}async[_0x44a1cd(0x116)](_0x3046cd){const _0x4b489d=_0x44a1cd,{invitedBy:_0x4d55ee}=_0x3046cd;let _0x39c969=(0x0,utils_1[_0x4b489d(0x15b)])(0x20);return _0x4d55ee&&(_0x39c969+=':'+_0x4d55ee),this[_0x4b489d(0x12d)][_0x39c969]=!![],_0x39c969;}async['getQRSceneStrByBind'](_0x5179a0){const _0x4e928f=_0x44a1cd,{id:_0x4b533b}=_0x5179a0[_0x4e928f(0x134)],_0x4a981b=(0x0,utils_1[_0x4e928f(0x15b)])(0x20)+'/'+_0x4b533b;return this[_0x4e928f(0x12d)][_0x4a981b]=!![],_0x4a981b;}async[_0x44a1cd(0x16c)](_0x568979){const _0x4ae776=_0x44a1cd;return this[_0x4ae776(0x120)](_0x568979);}async[_0x44a1cd(0x119)](_0x31b645){const _0x2d3e7c=_0x44a1cd,_0xa09969=await this['globalConfigService'][_0x2d3e7c(0x166)]([_0x2d3e7c(0x11f)]),_0x312571=_0x2d3e7c(0x10c)+_0xa09969+_0x2d3e7c(0x135)+encodeURIComponent(_0x31b645)+_0x2d3e7c(0x161);return console[_0x2d3e7c(0x11c)](_0x2d3e7c(0x165),_0x312571),_0x312571;}async[_0x44a1cd(0x13f)](_0xb7d6a5){const _0x1c1fe7=_0x44a1cd,_0x5cdc7a=(0x0,utils_1[_0x1c1fe7(0x15b)])(0x20),_0x1bfda2=(Date[_0x1c1fe7(0x122)]()/0x3e8)[_0x1c1fe7(0x107)](0x0),_0x32417b=await this[_0x1c1fe7(0x12e)][_0x1c1fe7(0x166)]([_0x1c1fe7(0x132)]);console['log'](_0x1c1fe7(0x133),_0x32417b);const _0x322f52=await this[_0x1c1fe7(0x12e)][_0x1c1fe7(0x166)]([_0x1c1fe7(0x11f)]);console[_0x1c1fe7(0x11c)]('appId:\x20',_0x322f52);const _0x15779d='jsapi_ticket='+_0x32417b+_0x1c1fe7(0x112)+_0x5cdc7a+'&timestamp='+_0x1bfda2+'&url='+_0xb7d6a5;console[_0x1c1fe7(0x11c)](_0x1c1fe7(0x128),_0x15779d);const _0x5171df=this['sha1'](_0x15779d);return{'appId':_0x322f52,'nonceStr':_0x5cdc7a,'timestamp':_0x1bfda2,'signature':_0x5171df};}async[_0x44a1cd(0x120)](_0x153cf0){const _0x28a3c6=_0x44a1cd,_0x3d0406=await this[_0x28a3c6(0x12e)][_0x28a3c6(0x166)](['wechatAccessToken']),_0x20cc16={'action_name':'QR_STR_SCENE','action_info':{'scene':{'scene_str':_0x153cf0}}},_0x378dcc=await axios_1[_0x28a3c6(0x137)][_0x28a3c6(0x157)](_0x28a3c6(0x143)+_0x3d0406,_0x20cc16),{data:{errmsg:_0x4207ef,ticket:_0x5ea4a6}}=_0x378dcc;if(_0x4207ef)throw new common_1[(_0x28a3c6(0x115))](_0x4207ef,common_1[_0x28a3c6(0x141)][_0x28a3c6(0x140)]);return _0x5ea4a6;}async[_0x44a1cd(0x144)](_0x365b6e,_0x3d151d){const _0x1f1589=_0x44a1cd,_0x1d97d=await this[_0x1f1589(0x12e)][_0x1f1589(0x166)]([_0x1f1589(0x11f)]),_0x5a3b32=await this[_0x1f1589(0x12e)][_0x1f1589(0x166)]([_0x1f1589(0x15d)]),_0x454631=await axios_1[_0x1f1589(0x137)]['get']('https://api.weixin.qq.com/sns/oauth2/access_token?appid='+_0x1d97d+_0x1f1589(0x10b)+_0x5a3b32+'&code='+_0x3d151d+'&grant_type=authorization_code'),{data:{errmsg:_0x12b5e7,openid:_0x212e1b}}=_0x454631;if(_0x12b5e7)throw new common_1[(_0x1f1589(0x115))](_0x12b5e7,common_1[_0x1f1589(0x141)][_0x1f1589(0x140)]);let _0x42e695,_0x37c32c=new Login_vo_1[(_0x1f1589(0x113))]();return _0x37c32c[_0x1f1589(0x11d)]=_0x212e1b,_0x42e695=await this['userService'][_0x1f1589(0x14e)](_0x212e1b),_0x42e695&&(_0x37c32c[_0x1f1589(0x145)]=await this[_0x1f1589(0x127)][_0x1f1589(0x15f)](_0x42e695,_0x365b6e)),_0x37c32c;}async[_0x44a1cd(0x146)](_0x184e07,_0x61fe61){const _0x3f2b5f=_0x44a1cd;if(!this[_0x3f2b5f(0x12d)][_0x61fe61])throw new common_1[(_0x3f2b5f(0x115))](_0x3f2b5f(0x139),common_1[_0x3f2b5f(0x141)][_0x3f2b5f(0x140)]);this[_0x3f2b5f(0x130)][_0x61fe61]=_0x184e07;}async['loginBySceneStr'](_0x4cda49,_0x41d96c){const _0x35834e=_0x44a1cd;if(!this[_0x35834e(0x12d)][_0x41d96c])return;const _0x136dce=this[_0x35834e(0x130)][_0x41d96c];if(!_0x136dce)return new Login_vo_1[(_0x35834e(0x113))]();let _0x2fbf82,_0x3932d0=new Login_vo_1[(_0x35834e(0x113))]();return _0x3932d0['openId']=_0x136dce,_0x2fbf82=await this[_0x35834e(0x149)][_0x35834e(0x14e)](_0x136dce),_0x2fbf82&&(_0x3932d0['authToken']=await this[_0x35834e(0x127)][_0x35834e(0x15f)](_0x2fbf82,_0x4cda49)),delete this[_0x35834e(0x130)][_0x41d96c],_0x3932d0;}async[_0x44a1cd(0x118)](_0x87fe92,_0x329eba){const _0x553c18=_0x44a1cd;if(!this[_0x553c18(0x12d)][_0x329eba])throw new common_1['HttpException'](_0x553c18(0x139),common_1[_0x553c18(0x141)][_0x553c18(0x140)]);const _0x5e315e=_0x329eba[_0x553c18(0x16b)]('/')[0x1],_0x3008f4=await this[_0x553c18(0x149)][_0x553c18(0x10d)](_0x87fe92,_0x5e315e);this['scanedSceneStrMap'][_0x329eba]=_0x3008f4;}async[_0x44a1cd(0x15a)](_0x90d1ee,_0x219890){const _0x19a82c=_0x44a1cd;if(!this[_0x19a82c(0x12d)][_0x219890])throw new common_1[(_0x19a82c(0x115))]('非法参数',common_1[_0x19a82c(0x141)][_0x19a82c(0x140)]);const {id:_0xeb862c}=_0x90d1ee[_0x19a82c(0x134)],_0x3a2f35=this[_0x19a82c(0x130)][_0x219890];if(!_0x3a2f35)return'';return delete this[_0x19a82c(0x130)][_0x219890],_0x3a2f35;}async['verify'](_0x2c72ff,_0x2935a5,_0x2e02cf){const _0x267719=_0x44a1cd,_0x50e3f6=await this[_0x267719(0x12e)][_0x267719(0x166)]([_0x267719(0x14b)])||'jiangly';return await this[_0x267719(0x151)]([_0x50e3f6,_0x2935a5,_0x2e02cf][_0x267719(0x162)]()[_0x267719(0x142)](''))==_0x2c72ff;}[_0x44a1cd(0x151)](_0x410cab){const _0x1b2e4d=_0x44a1cd;return crypto[_0x1b2e4d(0x11a)](_0x1b2e4d(0x151))[_0x1b2e4d(0x124)](_0x410cab)['digest']('hex');}async[_0x44a1cd(0x159)](_0x45b08d,_0x5bdc7a){const _0x320589=_0x44a1cd,_0x207f63=await this['globalConfigService'][_0x320589(0x166)]([_0x5bdc7a]);return this[_0x320589(0x167)](_0x45b08d,_0x207f63);}async[_0x44a1cd(0x167)](_0x56cafd,_0x36737c){const _0x29eadb=_0x44a1cd;return _0x29eadb(0x12f)+_0x56cafd[_0x29eadb(0x150)][0x0]+_0x29eadb(0x14a)+_0x56cafd[_0x29eadb(0x14c)][0x0]+_0x29eadb(0x169)+new Date()['getTime']()+_0x29eadb(0x15e)+_0x36737c+_0x29eadb(0x160);}async['aotoPlay'](_0x2d003c){const _0x5d5f09=_0x44a1cd;let _0x4dac1b=await this[_0x5d5f09(0x117)]['checkAutoReply'](_0x2d003c);if(!_0x4dac1b){const _0x14394d=await this['globalConfigService'][_0x5d5f09(0x166)]([_0x5d5f09(0x158)]);_0x4dac1b=_0x14394d;}return _0x4dac1b;}async[_0x44a1cd(0x11b)](_0x3ea762,_0x42fab3){const _0x341b67=_0x44a1cd;console[_0x341b67(0x11c)](_0x3ea762['ip']);if(_0x42fab3===_0x341b67(0x14f)){const _0x3dec53=await this[_0x341b67(0x12e)]['getConfigs']([_0x341b67(0x126)]);return _0x3dec53;}else{if(_0x42fab3===_0x341b67(0x110)){const _0x3c2fc6=await this[_0x341b67(0x109)][_0x341b67(0x14d)]({'key':redisKey_constant_1['WE_MINI_ACCESS_KEY']});return _0x3c2fc6;}else throw new common_1[(_0x341b67(0x115))](null,common_1[_0x341b67(0x141)][_0x341b67(0x140)]);}}};OfficialService=__decorate([(0x0,common_1[_0x44a1cd(0x13d)])(),__metadata(_0x44a1cd(0x11e),[autoreply_service_1[_0x44a1cd(0x125)],user_service_1[_0x44a1cd(0x10a)],auth_service_1['AuthService'],globalConfig_service_1[_0x44a1cd(0x111)],redisCache_service_1[_0x44a1cd(0x13e)]])],OfficialService),exports[_0x44a1cd(0x156)]=OfficialService;function _0x5d00(){const _0x5d327c=['bindWx','__esModule','onModuleInit','mini','GlobalConfigService','&noncestr=','OfficialLoginVO','3297204zKlZKX','HttpException','getQRSceneStr','autoreplyService','scanBindWx','getRedirectUrl','createHash','getAccessToken','log','openId','design:paramtypes','wechatOfficialAppId','fetchQRCodeTicket','function','now','20457uurdyD','update','AutoreplyService','wechatAccessToken','authService','str:\x20','../../common/utils','68fsSSvb','getWechatAccessToken','metadata','sceneStrMap','globalConfigService','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA[','scanedSceneStrMap','decorate','wechatJsapiTicket','jsapiTicket:\x20','user','&redirect_uri=','50JdzErA','default','defineProperty','非法参数','getOwnPropertyDescriptor','./vo/Login.vo','../../common/constants/redisKey.constant','Injectable','RedisCacheService','getJsapiTicket','BAD_REQUEST','HttpStatus','join','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=','loginByCode','authToken','scan','5972472fQmDER','4cyFtEi','userService',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','wechatOfficialToken','tousername','get','getUserOpenId','official','fromusername','sha1','../redisCache/redisCache.service','11504SoumyW','./../user/user.service','1643405OxFwey','OfficialService','post','officialAutoReplyText','genXmlMsgByConfig','bindWxBySceneStr','createRandomNonceStr','1379YsVado','wechatOfficialAppSecret','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[','getJwtToken',']]></Content>\x0a\x20\x20\x20\x20</xml>','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','sort','@nestjs/common','./../globalConfig/globalConfig.service','回跳跳转地址:\x20','getConfigs','genXmlMsg','object',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','7235jGdqFT','split','getQRCodeTicket','toFixed','2639487iwkBGs','redisCacheService','UserService','&secret=','https://open.weixin.qq.com/connect/oauth2/authorize?appid='];_0x5d00=function(){return _0x5d327c;};return _0x5d00();}