'use strict';function _0x948a(_0x2a3bad,_0x146fb9){var _0x39fc44=_0x39fc();return _0x948a=function(_0x948ab,_0x4ac29d){_0x948ab=_0x948ab-0x13b;var _0x4c69f5=_0x39fc44[_0x948ab];return _0x4c69f5;},_0x948a(_0x2a3bad,_0x146fb9);}var _0x5bff50=_0x948a;(function(_0x5262b3,_0x4785b5){var _0x1b55cf=_0x948a,_0x41e799=_0x5262b3();while(!![]){try{var _0x53d34e=parseInt(_0x1b55cf(0x14b))/0x1*(-parseInt(_0x1b55cf(0x16b))/0x2)+parseInt(_0x1b55cf(0x14c))/0x3*(parseInt(_0x1b55cf(0x145))/0x4)+-parseInt(_0x1b55cf(0x15c))/0x5*(-parseInt(_0x1b55cf(0x159))/0x6)+parseInt(_0x1b55cf(0x144))/0x7*(-parseInt(_0x1b55cf(0x158))/0x8)+parseInt(_0x1b55cf(0x13e))/0x9*(-parseInt(_0x1b55cf(0x148))/0xa)+parseInt(_0x1b55cf(0x155))/0xb+-parseInt(_0x1b55cf(0x175))/0xc;if(_0x53d34e===_0x4785b5)break;else _0x41e799['push'](_0x41e799['shift']());}catch(_0x102f90){_0x41e799['push'](_0x41e799['shift']());}}}(_0x39fc,0x53aa2));var __decorate=this&&this[_0x5bff50(0x15b)]||function(_0x3f38c3,_0x37896b,_0x21f964,_0x5444c5){var _0x4ac57c=_0x5bff50,_0x1a7461=arguments[_0x4ac57c(0x140)],_0x5c221d=_0x1a7461<0x3?_0x37896b:_0x5444c5===null?_0x5444c5=Object['getOwnPropertyDescriptor'](_0x37896b,_0x21f964):_0x5444c5,_0x260907;if(typeof Reflect===_0x4ac57c(0x171)&&typeof Reflect[_0x4ac57c(0x170)]===_0x4ac57c(0x15f))_0x5c221d=Reflect[_0x4ac57c(0x170)](_0x3f38c3,_0x37896b,_0x21f964,_0x5444c5);else{for(var _0x21a838=_0x3f38c3[_0x4ac57c(0x140)]-0x1;_0x21a838>=0x0;_0x21a838--)if(_0x260907=_0x3f38c3[_0x21a838])_0x5c221d=(_0x1a7461<0x3?_0x260907(_0x5c221d):_0x1a7461>0x3?_0x260907(_0x37896b,_0x21f964,_0x5c221d):_0x260907(_0x37896b,_0x21f964))||_0x5c221d;}return _0x1a7461>0x3&&_0x5c221d&&Object['defineProperty'](_0x37896b,_0x21f964,_0x5c221d),_0x5c221d;},__metadata=this&&this[_0x5bff50(0x15a)]||function(_0x169360,_0x256dd0){var _0x1ed606=_0x5bff50;if(typeof Reflect===_0x1ed606(0x171)&&typeof Reflect[_0x1ed606(0x13c)]==='function')return Reflect['metadata'](_0x169360,_0x256dd0);},QueueProcessor_1;Object[_0x5bff50(0x16d)](exports,_0x5bff50(0x162),{'value':!![]}),exports[_0x5bff50(0x165)]=void 0x0;const bull_1=require(_0x5bff50(0x146)),common_1=require(_0x5bff50(0x177)),midjourney_service_1=require(_0x5bff50(0x167)),process=require(_0x5bff50(0x15d));function _0x39fc(){var _0x55cf8d=['metadata','Logger','5394717shCbwL','onQueueProgress','length','error','onQueueFailed','队列恢复的时候调用','1361339zoNCSq','20572JIhyxp','@nestjs/bull','prototype','10rGEdjI','onQueueActive','MidjourneyService','233KYjQBW','294MAoTOL','\x20were\x20cleaned.','队列任务完成的时候调用','将在队列中的任务变为活动状态时被调用','OnQueueActive','MJDRAW','onQueueCleaned','logger','Queue\x20cleaned:\x20','7524198ZdEbGJ','drawFailed','design:type','8IknplJ','5718XzIJSX','__metadata','__decorate','1735MjDtsW','process','onQueueDrained','function','OnQueueResumed','OnQueueCleaned','__esModule','design:paramtypes','midjourneyService','QueueProcessor','OnQueueDrained\x20当前队列已经空了','../midjourney/midjourney.service','name','log','current\x20CONCURRENCY','1430FUPjXu','env','defineProperty','onQueueResumed','design:returntype','decorate','object','handleJob','队列任务的一个回调用于通知当前进度','OnQueueDrained','2586576qWJCxs','onQueuePaused','@nestjs/common','\x20jobs\x20of\x20type\x20','OnQueueError',':\x20绘画失败\x20','CONCURRENCY','OnQueueFailed','onQueueError'];_0x39fc=function(){return _0x55cf8d;};return _0x39fc();}let QueueProcessor=QueueProcessor_1=class QueueProcessor{constructor(_0x46479b){var _0x3da7cb=_0x5bff50;this[_0x3da7cb(0x164)]=_0x46479b,this[_0x3da7cb(0x153)]=new common_1[(_0x3da7cb(0x13d))](QueueProcessor_1[_0x3da7cb(0x168)]);}async[_0x5bff50(0x172)](_0x4b313d){var _0x400a31=_0x5bff50;common_1['Logger'][_0x400a31(0x169)](process[_0x400a31(0x16c)][_0x400a31(0x17b)],_0x400a31(0x16a));}[_0x5bff50(0x149)](_0x493db7){var _0x1f3448=_0x5bff50;this[_0x1f3448(0x153)][_0x1f3448(0x169)](_0x1f3448(0x14f),_0x493db7['id']);}['onQueueError'](_0x55075c){this['logger']['log']('绘图队列发生错误',_0x55075c);}[_0x5bff50(0x13f)](_0x39920d,_0x3ec5d){var _0x2e9e53=_0x5bff50;this['logger'][_0x2e9e53(0x169)](_0x2e9e53(0x173),_0x39920d['id'],_0x3ec5d);}['onQueueCompleted'](_0x29ff05,_0x5b7888){var _0x35973b=_0x5bff50;this[_0x35973b(0x153)][_0x35973b(0x169)](_0x35973b(0x14e),_0x29ff05['id'],_0x5b7888);}[_0x5bff50(0x142)](_0x450827,_0x38636d){var _0x120355=_0x5bff50;common_1[_0x120355(0x13d)][_0x120355(0x141)]('draw\x20mj\x20failed:\x20'+_0x38636d['message']+_0x120355(0x17a)+_0x450827['id'],_0x120355(0x165)),this['midjourneyService'][_0x120355(0x156)](_0x450827['data']);}[_0x5bff50(0x176)](){var _0x34e7fc=_0x5bff50;this[_0x34e7fc(0x153)][_0x34e7fc(0x169)]('队列暂停的时候调用');}[_0x5bff50(0x16e)](){var _0x5529a4=_0x5bff50;this[_0x5529a4(0x153)][_0x5529a4(0x169)](_0x5529a4(0x143));}[_0x5bff50(0x152)](_0x4d9a0b,_0x3430f8){var _0x270c0c=_0x5bff50;common_1[_0x270c0c(0x13d)][_0x270c0c(0x169)](_0x270c0c(0x154)+_0x4d9a0b[_0x270c0c(0x140)]+_0x270c0c(0x178)+_0x3430f8+_0x270c0c(0x14d),_0x270c0c(0x165));}[_0x5bff50(0x15e)](){var _0x57f8d3=_0x5bff50;this[_0x57f8d3(0x153)][_0x57f8d3(0x169)](_0x57f8d3(0x166));}};__decorate([(0x0,bull_1['Process'])({'name':'mjDraw','concurrency':process['env'][_0x5bff50(0x17b)]?+process[_0x5bff50(0x16c)][_0x5bff50(0x17b)]:0xa}),__metadata(_0x5bff50(0x157),Function),__metadata(_0x5bff50(0x163),[Object]),__metadata('design:returntype',Promise)],QueueProcessor[_0x5bff50(0x147)],_0x5bff50(0x172),null),__decorate([(0x0,bull_1[_0x5bff50(0x150)])(),__metadata(_0x5bff50(0x157),Function),__metadata(_0x5bff50(0x163),[Object]),__metadata(_0x5bff50(0x16f),void 0x0)],QueueProcessor[_0x5bff50(0x147)],_0x5bff50(0x149),null),__decorate([(0x0,bull_1[_0x5bff50(0x179)])(),__metadata('design:type',Function),__metadata(_0x5bff50(0x163),[Error]),__metadata(_0x5bff50(0x16f),void 0x0)],QueueProcessor[_0x5bff50(0x147)],_0x5bff50(0x13b),null),__decorate([(0x0,bull_1['OnQueueProgress'])(),__metadata(_0x5bff50(0x157),Function),__metadata('design:paramtypes',[Object,Number]),__metadata(_0x5bff50(0x16f),void 0x0)],QueueProcessor[_0x5bff50(0x147)],'onQueueProgress',null),__decorate([(0x0,bull_1['OnQueueCompleted'])(),__metadata(_0x5bff50(0x157),Function),__metadata('design:paramtypes',[Object,Object]),__metadata(_0x5bff50(0x16f),void 0x0)],QueueProcessor[_0x5bff50(0x147)],'onQueueCompleted',null),__decorate([(0x0,bull_1[_0x5bff50(0x17c)])(),__metadata('design:type',Function),__metadata(_0x5bff50(0x163),[Object,Error]),__metadata(_0x5bff50(0x16f),void 0x0)],QueueProcessor[_0x5bff50(0x147)],'onQueueFailed',null),__decorate([(0x0,bull_1['OnQueuePaused'])(),__metadata(_0x5bff50(0x157),Function),__metadata(_0x5bff50(0x163),[]),__metadata('design:returntype',void 0x0)],QueueProcessor['prototype'],_0x5bff50(0x176),null),__decorate([(0x0,bull_1[_0x5bff50(0x160)])(),__metadata(_0x5bff50(0x157),Function),__metadata('design:paramtypes',[]),__metadata(_0x5bff50(0x16f),void 0x0)],QueueProcessor[_0x5bff50(0x147)],'onQueueResumed',null),__decorate([(0x0,bull_1[_0x5bff50(0x161)])(),__metadata(_0x5bff50(0x157),Function),__metadata(_0x5bff50(0x163),[Array,String]),__metadata(_0x5bff50(0x16f),void 0x0)],QueueProcessor[_0x5bff50(0x147)],'onQueueCleaned',null),__decorate([(0x0,bull_1[_0x5bff50(0x174)])(),__metadata(_0x5bff50(0x157),Function),__metadata(_0x5bff50(0x163),[]),__metadata(_0x5bff50(0x16f),void 0x0)],QueueProcessor[_0x5bff50(0x147)],_0x5bff50(0x15e),null),QueueProcessor=QueueProcessor_1=__decorate([(0x0,bull_1['Processor'])(_0x5bff50(0x151)),__metadata(_0x5bff50(0x163),[midjourney_service_1[_0x5bff50(0x14a)]])],QueueProcessor),exports[_0x5bff50(0x165)]=QueueProcessor;