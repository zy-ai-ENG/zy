'use strict';const _0x309671=_0x9dd4;(function(_0x3757d3,_0x2d4bcf){const _0x4ac730=_0x9dd4,_0x20a4d0=_0x3757d3();while(!![]){try{const _0x2e7203=parseInt(_0x4ac730(0x175))/0x1*(-parseInt(_0x4ac730(0x16c))/0x2)+parseInt(_0x4ac730(0x15b))/0x3+-parseInt(_0x4ac730(0x15a))/0x4*(-parseInt(_0x4ac730(0x165))/0x5)+parseInt(_0x4ac730(0x16f))/0x6*(-parseInt(_0x4ac730(0x178))/0x7)+parseInt(_0x4ac730(0x160))/0x8+-parseInt(_0x4ac730(0x182))/0x9*(parseInt(_0x4ac730(0x17c))/0xa)+parseInt(_0x4ac730(0x169))/0xb;if(_0x2e7203===_0x2d4bcf)break;else _0x20a4d0['push'](_0x20a4d0['shift']());}catch(_0xe604d2){_0x20a4d0['push'](_0x20a4d0['shift']());}}}(_0x13a8,0x59f70));Object[_0x309671(0x171)](exports,_0x309671(0x168),{'value':!![]}),exports[_0x309671(0x181)]=exports[_0x309671(0x17a)]=exports[_0x309671(0x173)]=exports[_0x309671(0x183)]=void 0x0;function _0x13a8(){const _0x425056=['HS256','application/json','6bHqFsX','round','defineProperty','json\x20parse\x20error\x20from\x20zhipu!','compilerMetaJsonStr','trim','449815BDwbRl','now','event:','74641TBkahG','id:','compilerStream','https://open.bigmodel.cn/api/paas/v3/model-api/','110cwOThw','parse','jsonwebtoken','sign','POST','sendMessageFromZhipu','223101kYWxTs','generateToken','split','stream','/sse-invoke','toString','data','length','axios','65964lVGfwz','819663VCnJdZ','log','text','meta:','usage','748976duAtEL','SIGN','error:\x20','data:','replace','90jfrfkj','is_end','error','__esModule','4817692HhXWWP','filter','then','2guoMCf'];_0x13a8=function(){return _0x425056;};return _0x13a8();}const axios=require(_0x309671(0x159)),jwt=require(_0x309671(0x17e));function generateToken(_0x45efea,_0x32b49b=0x3e8*0x3c*0x3c*0x18*0x168){const _0x5bf9ee=_0x309671,[_0x423f21,_0x332fdf]=_0x45efea[_0x5bf9ee(0x184)]('.'),_0x3e0274={'api_key':_0x423f21,'exp':Math[_0x5bf9ee(0x170)](Date['now']())+_0x32b49b*0x3e8,'timestamp':Math[_0x5bf9ee(0x170)](Date[_0x5bf9ee(0x176)]())};return jwt[_0x5bf9ee(0x17f)](_0x3e0274,_0x332fdf,{'algorithm':'HS256','header':{'alg':_0x5bf9ee(0x16d),'sign_type':_0x5bf9ee(0x161)}});}exports['generateToken']=generateToken;function compilerMetaJsonStr(_0x396527){const _0x1ff5d2=_0x309671;let _0x371bf7={};try{_0x371bf7=JSON[_0x1ff5d2(0x17d)](_0x396527);}catch(_0x32aa63){_0x371bf7={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x1ff5d2(0x167)](_0x1ff5d2(0x172),_0x396527);}return _0x371bf7;}exports[_0x309671(0x173)]=compilerMetaJsonStr;function _0x9dd4(_0x424585,_0x42bb30){const _0x13a8db=_0x13a8();return _0x9dd4=function(_0x9dd47d,_0x346340){_0x9dd47d=_0x9dd47d-0x154;let _0x48ac2b=_0x13a8db[_0x9dd47d];return _0x48ac2b;},_0x9dd4(_0x424585,_0x42bb30);}function compilerStream(_0x5ea361){const _0x309b09=_0x309671;console[_0x309b09(0x15c)](_0x5ea361);if(_0x5ea361[_0x309b09(0x158)]===0x3)return{'event':_0x5ea361[0x0][_0x309b09(0x164)](_0x309b09(0x177),''),'id':_0x5ea361[0x1][_0x309b09(0x164)](_0x309b09(0x179),''),'is_end':![],'result':_0x5ea361[0x2][_0x309b09(0x164)](_0x309b09(0x163),'')[_0x309b09(0x174)]()};if(_0x5ea361[_0x309b09(0x158)]===0x4)return{'event':_0x5ea361[0x0][_0x309b09(0x164)](_0x309b09(0x177),''),'id':_0x5ea361[0x1][_0x309b09(0x164)](_0x309b09(0x179),''),'result':_0x5ea361[0x2][_0x309b09(0x164)](_0x309b09(0x163),'')[_0x309b09(0x174)](),'is_end':!![],'usage':compilerMetaJsonStr(_0x5ea361[0x3][_0x309b09(0x164)](_0x309b09(0x15e),''))?.[_0x309b09(0x15f)]};}exports[_0x309671(0x17a)]=compilerStream;async function sendMessageFromZhipu(_0x40c65c,{onProgress:_0x5b64b1,key:_0xa01516,model:_0x57e9ba,temperature:temperature=0.95}){const _0xa0c771=await generateToken(_0xa01516);return new Promise((_0x3c2b34,_0x4965bc)=>{const _0x2b53e0=_0x9dd4,_0x35b98b=_0x2b53e0(0x17b)+_0x57e9ba+_0x2b53e0(0x155),_0x1c9d96={'method':_0x2b53e0(0x180),'url':_0x35b98b,'responseType':_0x2b53e0(0x154),'headers':{'Content-Type':_0x2b53e0(0x16e),'Authorization':_0xa0c771},'data':{'prompt':_0x40c65c,'temperature':temperature}};axios(_0x1c9d96)[_0x2b53e0(0x16b)](_0x246808=>{const _0x318cf1=_0x2b53e0,_0x53b7e3=_0x246808[_0x318cf1(0x157)];let _0x2a0886,_0x270327='';_0x53b7e3['on']('data',_0x589745=>{const _0x539c0d=_0x318cf1,_0x92f5ef=_0x589745[_0x539c0d(0x156)]()['split']('\x0a')[_0x539c0d(0x16a)](_0x1e0a44=>_0x1e0a44['trim']()!=='');console[_0x539c0d(0x15c)](_0x92f5ef);const _0x21c4b5=compilerStream(_0x92f5ef);console[_0x539c0d(0x15c)](_0x21c4b5);if(!_0x21c4b5)return;const {id:_0x33e0fc,result:_0x43f4df,is_end:_0x57bf4a}=_0x21c4b5;_0x43f4df&&(_0x270327+=_0x43f4df['trim']()),_0x57bf4a&&(_0x21c4b5[_0x539c0d(0x166)]=![],_0x2a0886=_0x21c4b5,_0x2a0886[_0x539c0d(0x15d)]=_0x270327),_0x5b64b1(_0x21c4b5);}),_0x53b7e3['on']('end',()=>{_0x3c2b34(_0x2a0886),_0x270327='';});})['catch'](_0x4e4521=>{const _0x21a63b=_0x2b53e0;console[_0x21a63b(0x15c)](_0x21a63b(0x162),_0x4e4521);});});}exports['sendMessageFromZhipu']=sendMessageFromZhipu;