'use strict';const _0x1880fe=_0xf477;(function(_0x49ffb7,_0xcdd029){const _0x2a347c=_0xf477,_0x8be5b8=_0x49ffb7();while(!![]){try{const _0x4c0f77=parseInt(_0x2a347c(0x1d9))/0x1+-parseInt(_0x2a347c(0x1d7))/0x2+parseInt(_0x2a347c(0x1d2))/0x3*(parseInt(_0x2a347c(0x1cc))/0x4)+-parseInt(_0x2a347c(0x1d0))/0x5+-parseInt(_0x2a347c(0x1ba))/0x6+parseInt(_0x2a347c(0x1c6))/0x7+parseInt(_0x2a347c(0x1bc))/0x8*(-parseInt(_0x2a347c(0x1dd))/0x9);if(_0x4c0f77===_0xcdd029)break;else _0x8be5b8['push'](_0x8be5b8['shift']());}catch(_0x1fc6b9){_0x8be5b8['push'](_0x8be5b8['shift']());}}}(_0x5c52,0x2319f));Object[_0x1880fe(0x1ce)](exports,'__esModule',{'value':!![]}),exports[_0x1880fe(0x1cf)]=void 0x0;const uuid_1=require(_0x1880fe(0x1c2)),tiktoken_1=require(_0x1880fe(0x1d6)),tokenizer=(0x0,tiktoken_1['get_encoding'])(_0x1880fe(0x1d1));function _0xf477(_0x222925,_0x417360){const _0x5c523c=_0x5c52();return _0xf477=function(_0xf47766,_0x167cbe){_0xf47766=_0xf47766-0x1b9;let _0xea8f63=_0x5c523c[_0xf47766];return _0xea8f63;},_0xf477(_0x222925,_0x417360);}class NineStore{constructor(_0x37de96){const _0x1e7809=_0x1880fe,{store:_0x2075ec,namespace:_0x207ac1,expires:_0x11b7e5}=this['formatOptions'](_0x37de96);this[_0x1e7809(0x1c8)]=_0x2075ec,this[_0x1e7809(0x1d3)]=_0x207ac1,this[_0x1e7809(0x1c4)]=_0x11b7e5;}['formatOptions'](_0x570d98){const _0x2f4792=_0x1880fe,{store:_0x459dca,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x2f4792(0x1de)}=_0x570d98;return{'store':_0x459dca,'namespace':namespace,'expires':expires};}[_0x1880fe(0x1b9)](_0x18b656){const _0x2017a5=_0x1880fe;return this['namespace']?this[_0x2017a5(0x1d3)]+'-'+_0x18b656:_0x18b656;}async[_0x1880fe(0x1dc)](_0x2c19e5){const _0x3ece2f=_0x1880fe,_0x1a2dfe=await this['store'][_0x3ece2f(0x1d5)](_0x2c19e5);return _0x1a2dfe;}async[_0x1880fe(0x1bd)](_0x11dc68,_0x5ae6c6=this['expires']){const _0x489f2e=_0x1880fe;await this['store'][_0x489f2e(0x1cb)](_0x11dc68['id'],_0x11dc68,_0x5ae6c6);}async[_0x1880fe(0x1ca)](_0xc3c109,_0x541218){const _0xe9be=_0x1880fe;let {maxRounds:_0x4d9872,maxModelToken:_0x29208e,maxResponseTokens:_0x3c5d40,systemMessage:systemMessage='',name:_0x2d3a50}=_0x541218,{parentMessageId:_0x40d0f0}=_0x541218,_0x2e17d6=[],_0x2ff95e=0x0;systemMessage&&_0x2e17d6[_0xe9be(0x1cd)]({'role':'system','content':systemMessage});const _0x47e106=_0x2e17d6[_0xe9be(0x1d4)];let _0x38fcc6=0x0,_0x1957f4=_0xc3c109?_0x2e17d6[_0xe9be(0x1bb)]([{'role':'user','content':_0xc3c109,'name':_0x2d3a50}]):_0x2e17d6;do{if(!_0x40d0f0)break;const _0x557522=await this[_0xe9be(0x1dc)](_0x40d0f0);if(!_0x557522)break;const {text:_0x58142d,name:_0x19fd8a,role:_0x367cc3}=_0x557522;_0x1957f4=_0x1957f4['slice'](0x0,_0x47e106)[_0xe9be(0x1bb)]([{'role':_0x367cc3,'content':_0x58142d,'name':_0x19fd8a},..._0x1957f4[_0xe9be(0x1bf)](_0x47e106)]),_0x38fcc6++;if(_0x4d9872&&_0x38fcc6>=_0x4d9872)break;if(_0x29208e&&_0x3c5d40){const _0x307e1f=_0x29208e-_0x3c5d40;_0x2ff95e=await this[_0xe9be(0x1c0)](_0x1957f4);const _0x24e774=_0x2ff95e+0xc8<=_0x307e1f;!_0x24e774&&(_0x1957f4=this[_0xe9be(0x1d8)](_0x2e17d6,_0x307e1f,systemMessage));}_0x40d0f0=_0x557522[_0xe9be(0x1c3)];}while(!![]);const _0x31da59=Math['max'](0x1,Math[_0xe9be(0x1da)](_0x29208e-_0x2ff95e,_0x3c5d40));return _0x1957f4;}async['_getTokenCount'](_0x48cb16){const _0x39e8f2=_0x1880fe;let _0x600cdf=_0x48cb16[_0x39e8f2(0x1c5)]((_0x37607e,_0x209ee5)=>{const _0xcb0dd5=_0x39e8f2;return _0x37607e+=_0x209ee5[_0xcb0dd5(0x1be)];},'');return console[_0x39e8f2(0x1c1)]('汇总的文本数量:\x20',_0x600cdf),_0x600cdf=_0x600cdf[_0x39e8f2(0x1c7)](/<\|endoftext\|>/g,''),tokenizer[_0x39e8f2(0x1db)](_0x600cdf)[_0x39e8f2(0x1d4)];}async[_0x1880fe(0x1d8)](_0x3cdfee,_0x1e208d,_0x2c0dab){const _0x2b2fd1=_0x1880fe,_0x323d26=await this[_0x2b2fd1(0x1c0)](_0x3cdfee);if(_0x323d26<=_0x1e208d)return _0x3cdfee;return _0x3cdfee['splice'](_0x2c0dab?0x1:0x0,0x1),this[_0x2b2fd1(0x1d8)](_0x3cdfee,_0x1e208d,_0x2c0dab);}[_0x1880fe(0x1c9)](){return(0x0,uuid_1['v4'])();}}function _0x5c52(){const _0x38e0d2=['getUuid','buildMessageFromParentMessageId','set','52kWvqSG','push','defineProperty','NineStore','430180rvbDBw','cl100k_base','52515mEtCLj','namespace','length','get','@dqbd/tiktoken','302632oETDbk','_recursivePruning','225591mmivoF','min','encode','getData','9TDFcQu','chat','generateKey','332592qvXCia','concat','1270480Wiwrgy','setData','content','slice','_getTokenCount','log','uuid','parentMessageId','expires','reduce','995491XRyWKZ','replace','store'];_0x5c52=function(){return _0x38e0d2;};return _0x5c52();}exports['NineStore']=NineStore;