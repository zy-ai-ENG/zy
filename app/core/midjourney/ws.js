'use strict';const _0x44b02b=_0x5399;(function(_0x378456,_0x135394){const _0x3f2f5b=_0x5399,_0x1bdafa=_0x378456();while(!![]){try{const _0x3dc094=parseInt(_0x3f2f5b(0xa4))/0x1*(parseInt(_0x3f2f5b(0xdc))/0x2)+parseInt(_0x3f2f5b(0xe1))/0x3+-parseInt(_0x3f2f5b(0x95))/0x4+parseInt(_0x3f2f5b(0xcc))/0x5+-parseInt(_0x3f2f5b(0xc2))/0x6*(-parseInt(_0x3f2f5b(0xf2))/0x7)+parseInt(_0x3f2f5b(0xe0))/0x8+parseInt(_0x3f2f5b(0xea))/0x9*(-parseInt(_0x3f2f5b(0xaf))/0xa);if(_0x3dc094===_0x135394)break;else _0x1bdafa['push'](_0x1bdafa['shift']());}catch(_0x556361){_0x1bdafa['push'](_0x1bdafa['shift']());}}}(_0x2b9f,0x8d2ae));Object[_0x44b02b(0xf1)](exports,_0x44b02b(0xdd),{'value':!![]}),exports['MidjourneyWs']=void 0x0;const eventemitter3_1=require('eventemitter3'),{WebSocket}=require(_0x44b02b(0xab)),msgMap_1=require(_0x44b02b(0xc7)),utils_1=require(_0x44b02b(0x9c));function _0x2b9f(){const _0x5f877c=['get','501381odQtiR','wsClient\x20is\x20open!','emitNonce','timestamp','ws创建失败','imgBaseUrl','handleMessageDelete','defineProperty','28jkCchM','waitReady','open','length','Mac\x20OS\x20X','parse','handleMessage','debug','connect','WS_OPEN','2478608sTVedQ','MESSAGE_CREATE','heartbeat','random','replace','stringify','close','./utils','INTERACTION_IFRAME_MODAL_CREATE','processingImage','arrayBuffer','wsClient','discord\x20wsClient\x20was\x20close,\x20error\x20code:\x20','prompt','then','71563sKMzri','json','wsBaseUrl','heartbeat_interval','discordsaysUrl','emitEmbed','getMsgByOriginId','isomorphic-ws','handleMessageUpdate','info','reconnectionTask','230HnhUxI','nonce','from','getMsgById','MidjourneyWs','url','/inpaint','MidjourneyMsgMap','match','MESSAGE_UPDATE','heartbeatTask','call','updateMsgByNonce','embed','Chrome','session_id','number','addEventListener','MESSAGE_DELETE','551682hgQIsj','off','auth','EventEmitter','msgMap','./msgMap','READY','message','image_url','emit','4695795XDdDOv','user','base64','lastSequence','channel_id','discord\x20wsClient\x20occurred\x20an\x20error:\x20','toString','error','INTERACTION_MODAL_CREATE','getMsgByparentId','data','nonce\x20is\x20none','split','bind','set','send','2dnTBOW','__esModule','handleMessageCreate','wsBaseUrl\x20can\x27t\x20be\x20empty','900968UYDGOg','2964150Pmxznk','formatComponents','opts','discord\x20wsClient\x20reconnect...','once','wsProxyUrl','skipHeartbeat','parseInt'];_0x2b9f=function(){return _0x5f877c;};return _0x2b9f();}class MidjourneyWs extends eventemitter3_1[_0x44b02b(0xc5)]{constructor(_0x338f43){const _0x3aa167=_0x44b02b;super(),this[_0x3aa167(0xe3)]=_0x338f43,this['lastSequence']=null,this[_0x3aa167(0xb9)]=null,this[_0x3aa167(0xae)]=null,this[_0x3aa167(0xc6)]=new msgMap_1[(_0x3aa167(0xb6))](),this[_0x3aa167(0xa0)]=this[_0x3aa167(0x93)]();}['connect'](){const _0x63c08a=_0x44b02b;if(!this[_0x63c08a(0xe3)][_0x63c08a(0xa6)])throw new Error(_0x63c08a(0xdf));let _0x42b430;!this[_0x63c08a(0xe3)][_0x63c08a(0xe6)]&&this[_0x63c08a(0xe3)]['wsBaseUrl']&&(_0x42b430=new WebSocket(this[_0x63c08a(0xe3)][_0x63c08a(0xa6)]));if(!_0x42b430)throw _0x63c08a(0xee);return _0x42b430[_0x63c08a(0xc0)](_0x63c08a(0xf4),()=>{const _0x19f5a8=_0x63c08a;this[_0x19f5a8(0xcb)](_0x19f5a8(0x94)),this[_0x19f5a8(0xe3)][_0x19f5a8(0x92)]?.('MidjourneyWs',_0x19f5a8(0x93))(_0x19f5a8(0xeb)),this[_0x19f5a8(0xae)]&&(clearTimeout(this[_0x19f5a8(0xae)]),this[_0x19f5a8(0xae)]=null);}),_0x42b430['addEventListener']('message',this[_0x63c08a(0xc9)][_0x63c08a(0xd9)](this)),_0x42b430[_0x63c08a(0xc0)](_0x63c08a(0xd3),_0x58cd83=>{const _0x2204a1=_0x63c08a;this[_0x2204a1(0xcb)]('WS_ERROR',_0x58cd83['message']),this[_0x2204a1(0xe3)][_0x2204a1(0x92)]?.(_0x2204a1(0xb3),_0x2204a1(0x93))(_0x2204a1(0xd1)+_0x58cd83[_0x2204a1(0xc9)]),this[_0x2204a1(0xa0)][_0x2204a1(0x9b)]();}),_0x42b430['addEventListener']('close',({code:_0x472458,reason:_0x876563})=>{const _0x5a050e=_0x63c08a;this[_0x5a050e(0xcb)]('WS_CLOSE'),this[_0x5a050e(0xe3)][_0x5a050e(0x92)]?.(_0x5a050e(0xb3),_0x5a050e(0x93))(_0x5a050e(0xa1)+_0x472458+',\x20error\x20reason:\x20'+_0x876563),_0x472458===0xfa4?this['emit'](_0x5a050e(0xc8),new Error(_0x876563)):this[_0x5a050e(0xae)]=setTimeout(()=>{const _0x3b64b5=_0x5a050e;this[_0x3b64b5(0xe3)][_0x3b64b5(0x92)]?.(_0x3b64b5(0xb3),_0x3b64b5(0x93))(_0x3b64b5(0xe4)),this[_0x3b64b5(0xb9)]&&typeof this[_0x3b64b5(0xb9)]===_0x3b64b5(0xbf)&&(clearInterval(this['heartbeatTask']),this[_0x3b64b5(0xb9)]=null),this[_0x3b64b5(0xa0)]=this[_0x3b64b5(0x93)][_0x3b64b5(0xba)](this);},0xfa0);}),_0x42b430;}[_0x44b02b(0xc4)](){const _0x355d5d=_0x44b02b;this['wsClient'][_0x355d5d(0xdb)](JSON['stringify']({'op':0x2,'d':{'token':this[_0x355d5d(0xe3)]['token'],'capabilities':0x3ffd,'properties':{'os':_0x355d5d(0xf6),'browser':_0x355d5d(0xbd),'device':''},'compress':![]}}));}[_0x44b02b(0x97)](_0x554b29){const _0x4b70cd=_0x44b02b,_0x497777=_0x554b29*Math[_0x4b70cd(0x98)]();this['heartbeatTask']=setTimeout(()=>{const _0xac7f44=_0x4b70cd;this[_0xac7f44(0xa0)]['readyState']===WebSocket['OPEN']&&(this[_0xac7f44(0xa0)][_0xac7f44(0xdb)](JSON['stringify']({'op':0x1,'d':this[_0xac7f44(0xcf)]})),this[_0xac7f44(0x97)](_0x554b29));},_0x497777);}[_0x44b02b(0xc9)](_0x267dab){const _0x231860=_0x44b02b,_0x5500f6=JSON[_0x231860(0x90)](_0x267dab[_0x231860(0xd6)]),_0x3d579e=_0x5500f6['d'],_0x57ca21=_0x5500f6['t'],_0x58738b=_0x5500f6['s'],_0x52bdca=_0x5500f6['op'];_0x58738b&&(this[_0x231860(0xcf)]=_0x58738b);_0x52bdca===0xa&&(this[_0x231860(0x97)](_0x3d579e[_0x231860(0xa7)]),this[_0x231860(0xc4)]());_0x57ca21===_0x231860(0xc8)&&(this[_0x231860(0xe3)][_0x231860(0xbe)]=_0x3d579e[_0x231860(0xbe)],this[_0x231860(0xe3)]['user']=_0x3d579e[_0x231860(0xcd)],this['opts'][_0x231860(0x92)]?.(_0x231860(0xb3),_0x231860(0xc9))('wsClient\x20connect\x20successfully!'),this[_0x231860(0xcb)](_0x231860(0xc8),_0x3d579e['user']));if(_0x57ca21===_0x231860(0x96)||_0x57ca21===_0x231860(0xb8)||_0x57ca21===_0x231860(0xc1)||_0x57ca21===_0x231860(0x9d)||_0x57ca21===_0x231860(0xd4))this[_0x231860(0x91)](_0x57ca21,_0x3d579e);_0x52bdca===0xb&&(!this['opts'][_0x231860(0xe7)]&&this[_0x231860(0xe3)][_0x231860(0x92)]?.('MidjourneyWs',_0x231860(0xc9))('discord\x20heartbeat\x20ack!'));}[_0x44b02b(0x91)](_0x4682bc,_0x3cd5ac){const _0x121da6=_0x44b02b;if(_0x3cd5ac[_0x121da6(0xd0)]!==this[_0x121da6(0xe3)][_0x121da6(0xd0)])return;if(_0x4682bc===_0x121da6(0x96)||_0x4682bc==='INTERACTION_IFRAME_MODAL_CREATE'||_0x4682bc==='INTERACTION_MODAL_CREATE')this[_0x121da6(0xde)](_0x4682bc,_0x3cd5ac);else{if(_0x4682bc===_0x121da6(0xb8))this[_0x121da6(0xac)](_0x121da6(0xb8),_0x3cd5ac);else this[_0x121da6(0xf0)](_0x3cd5ac);}}[_0x44b02b(0xde)](_0x248e6d,_0x2a211f){const _0x2f19cb=_0x44b02b;let {nonce:_0x279f55,id:_0x222630,embeds:embeds=[],custom_id:_0x7c7807,content:_0x30bdd2,attachments:attachments=[],components:_0x526e71}=_0x2a211f;_0x279f55=_0x279f55||(0x0,utils_1['matchRegionNonce'])(_0x30bdd2);if(_0x279f55&&!attachments['length']){this[_0x2f19cb(0xc6)][_0x2f19cb(0xbb)](_0x222630,_0x279f55);if(embeds[0x0]){const {color:_0x48bbb2}=embeds[0x0];switch(_0x48bbb2){case 0xff0000:this[_0x2f19cb(0xa9)](_0x222630,'MESSAGE_CREATE',embeds[0x0]);break;default:break;}}if(_0x248e6d===_0x2f19cb(0x9d)&&_0x7c7807){_0x7c7807=_0x7c7807[_0x2f19cb(0xd8)]('::')[0x2];let _0x2fb75a='';return fetch(this[_0x2f19cb(0xe3)][_0x2f19cb(0xa8)]+'/inpaint/api/get-image-info/0/0/'+_0x7c7807)[_0x2f19cb(0xa3)](async _0x1da2cb=>{const _0x18c289=_0x2f19cb;if(_0x1da2cb['ok']){const _0x42cae1=await _0x1da2cb[_0x18c289(0xa5)]();_0x2fb75a=_0x42cae1[_0x18c289(0xa2)];const _0x58d90e=await fetch(this[_0x18c289(0xe3)][_0x18c289(0xa8)]+_0x18c289(0xb5)+_0x42cae1[_0x18c289(0xca)]?.[_0x18c289(0x99)](/^\./,''))[_0x18c289(0xa3)](_0x5ca213=>_0x5ca213[_0x18c289(0x9f)]())[_0x18c289(0xa3)](_0xcd149f=>Buffer[_0x18c289(0xb1)](_0xcd149f)[_0x18c289(0xd2)](_0x18c289(0xce)));this[_0x18c289(0xec)](_0x279f55,_0x248e6d,{'custom_id':_0x7c7807,'varyRegionPrompt':_0x2fb75a,'varyRegionImgBase64':_0x58d90e});}});}_0x248e6d===_0x2f19cb(0xd4)&&_0x7c7807&&_0x526e71['length']&&this[_0x2f19cb(0xec)](_0x279f55,_0x248e6d,{'id':_0x222630,'custom_id':_0x7c7807,'components':_0x526e71});}this[_0x2f19cb(0xac)](_0x2f19cb(0x96),_0x2a211f);}[_0x44b02b(0xac)](_0x154bcd,_0x4acd30){const _0x2dc3a2=_0x44b02b,{content:_0x2e7a43,interaction:interaction={},nonce:_0x50a129,flags:_0x4bac18,attachments:_0x1fb6ba,components:components=[],embeds:embeds=[],id:_0x25a85b}=_0x4acd30;if(!_0x50a129){const {name:_0x1dc88a}=interaction,_0x27addd=this[_0x2dc3a2(0xc6)][_0x2dc3a2(0xb2)](_0x25a85b);if(_0x27addd&&_0x27addd[_0x2dc3a2(0xb0)])switch(_0x1dc88a){case'settings':this[_0x2dc3a2(0xec)](_0x27addd[_0x2dc3a2(0xb0)],_0x154bcd,{'id':_0x25a85b,'flags':_0x4bac18,'components':(0x0,utils_1[_0x2dc3a2(0xe2)])(components),'progress':0x64});return;case _0x2dc3a2(0xad):embeds['at'](0x0)&&this['emitNonce'](_0x27addd[_0x2dc3a2(0xb0)],_0x154bcd,{'id':_0x25a85b,'embed':embeds[0x0],'progress':0x64});return;case'describe':embeds['at'](0x0)&&this[_0x2dc3a2(0xec)](_0x27addd[_0x2dc3a2(0xb0)],_0x154bcd,{'flags':_0x4bac18,'url':embeds[0x0]['image'][_0x2dc3a2(0xb4)],'timestamp':_0x4acd30[_0x2dc3a2(0xed)],'components':(0x0,utils_1[_0x2dc3a2(0xe2)])(components),'id':_0x25a85b,'embed':embeds[0x0],'progress':0x64});return;}}_0x2e7a43&&this[_0x2dc3a2(0x9e)](_0x154bcd,_0x4acd30);}[_0x44b02b(0xf0)]({id:_0x44a3c0}){const _0x1ce0d3=_0x44b02b;this[_0x1ce0d3(0xec)](_0x44a3c0,_0x1ce0d3(0xc1),{'id':_0x44a3c0},!![]);}['processingImage'](_0x1f0290,_0x313876){const _0x52f099=_0x44b02b,{content:_0xbf98d3,id:_0x4c5117,attachments:attachments=[],flags:_0x222334,components:components=[],nonce:_0x1bbb12,timestamp:_0x81f5d1,message_reference:message_reference={}}=_0x313876,{message_id:_0x55b5d2}=message_reference,_0x537c3d=this[_0x52f099(0xc6)][_0x52f099(0xb2)](_0x4c5117)||this['msgMap'][_0x52f099(0xd5)](_0x55b5d2)||this[_0x52f099(0xc6)]['getMsgByContent'](_0xbf98d3);if(!_0x537c3d?.[_0x52f099(0xb0)]){console[_0x52f099(0xd3)](_0x52f099(0xd7));return;}let _0x4b2fea=attachments['at'](0x0)?.['url'];if(_0x4b2fea&&this['opts'][_0x52f099(0xef)])_0x4b2fea=_0x4b2fea['replace']('https://cdn.discordapp.com',this[_0x52f099(0xe3)][_0x52f099(0xef)]);const _0x2a400b=_0xbf98d3?.[_0x52f099(0xb7)](/\((\d+?)%\)\s\(\w+?\)/)?.[0x1],_0x1683c8=!_0x1bbb12&&attachments[_0x52f099(0xf5)]&&components[_0x52f099(0xf5)]&&_0x1f0290===_0x52f099(0x96),_0x237e1d=_0x1683c8?0x64:_0x2a400b?Number[_0x52f099(0xe8)](_0x2a400b):0x0,_0x1b1916=_0x537c3d?.['id']!==_0x4c5117?_0x537c3d?.['id']:undefined,_0x183c50=JSON[_0x52f099(0x90)](JSON[_0x52f099(0x9a)]({'id':_0x4c5117,'url':_0x4b2fea,'originId':_0x1b1916,'attachments':attachments,'content':_0xbf98d3[_0x52f099(0x99)](/^\*\*regionNonce:\s\d+?,\s/,'**'),'parentId':_0x55b5d2,'flags':_0x222334,'components':(0x0,utils_1['formatComponents'])(components),'progress':_0x237e1d,'timestamp':_0x81f5d1}));this[_0x52f099(0xec)](_0x537c3d[_0x52f099(0xb0)],_0x1f0290,_0x183c50);}[_0x44b02b(0xec)](_0x3bf8ac,_0x4b3531,_0x6c363,_0x3565a2=![]){const _0x24a677=_0x44b02b,_0x3f919a=this[_0x24a677(0xc6)][_0x24a677(0xe9)](_0x3bf8ac)||this['msgMap'][_0x24a677(0xb2)](_0x3bf8ac)||this[_0x24a677(0xc6)][_0x24a677(0xaa)](_0x3bf8ac);_0x3f919a&&_0x3f919a[_0x24a677(0xb0)]&&this[_0x24a677(0xcb)](_0x3f919a[_0x24a677(0xb0)],_0x4b3531,_0x3565a2?_0x6c363:Object['assign']({},_0x3f919a,_0x6c363));}['emitEmbed'](_0x9761e7,_0x5c5323,_0x1d61bc){const _0x96f0da=_0x44b02b,_0x19ad89=this[_0x96f0da(0xc6)][_0x96f0da(0xb2)](_0x9761e7);if(!_0x19ad89||!_0x19ad89['nonce'])return;_0x19ad89[_0x96f0da(0xbc)]=_0x1d61bc,this[_0x96f0da(0xec)](_0x19ad89['nonce'],_0x5c5323,_0x19ad89);}[_0x44b02b(0xf3)](){return new Promise((_0xec2254,_0x3a9a02)=>{const _0x13d9d0=_0x5399;this[_0x13d9d0(0xe5)](_0x13d9d0(0xc8),_0xa1deb0=>_0xa1deb0 instanceof Error?_0x3a9a02(_0xa1deb0):_0xec2254(_0xa1deb0));});}['waitMessage']({nonce:_0x314d40,parentId:_0x106eaa,cb:_0x54f256}){const _0x473a70=_0x44b02b;this[_0x473a70(0xc6)][_0x473a70(0xda)](_0x314d40,{'id':'','nonce':_0x314d40});const _0xb7527=_0x106eaa&&this[_0x473a70(0xc6)][_0x473a70(0xb2)](_0x106eaa);return new Promise((_0x202adb,_0x24ddd4)=>{const _0x23c97f=_0x473a70;_0xb7527&&_0xb7527[_0x23c97f(0xb0)]&&this[_0x23c97f(0xe5)](_0xb7527[_0x23c97f(0xb0)],(_0x473f4a,_0x307e4b)=>{const _0x54d6b4=_0x23c97f;_0x54f256?.(_0x473f4a,_0x307e4b),this[_0x54d6b4(0xc3)](_0xb7527[_0x54d6b4(0xb0)]);}),this['on'](_0x314d40,(_0x2a7593,_0x47e21f)=>{const _0x326e8c=_0x23c97f;_0x54f256?.(_0x2a7593,_0x47e21f);if(_0x2a7593===_0x326e8c(0xc1)&&_0x47e21f['id']){const _0x43899a=this['msgMap'][_0x326e8c(0xaa)](_0x47e21f['id']);_0x43899a&&this[_0x326e8c(0xc3)](_0x314d40)&&_0x202adb(_0x43899a);return;}if(_0x2a7593==='INTERACTION_IFRAME_MODAL_CREATE'||_0x2a7593===_0x326e8c(0xd4)){this[_0x326e8c(0xc3)](_0x314d40);return;}this[_0x326e8c(0xc6)][_0x326e8c(0xda)](_0x314d40,_0x47e21f),_0x47e21f[_0x326e8c(0xd3)]&&(this['off'](_0x314d40),_0x24ddd4(_0x47e21f[_0x326e8c(0xd3)]));});});}}function _0x5399(_0x212574,_0x37dfd5){const _0x2b9f67=_0x2b9f();return _0x5399=function(_0x5399cf,_0x21efeb){_0x5399cf=_0x5399cf-0x90;let _0x102b5e=_0x2b9f67[_0x5399cf];return _0x102b5e;},_0x5399(_0x212574,_0x37dfd5);}exports[_0x44b02b(0xb3)]=MidjourneyWs;