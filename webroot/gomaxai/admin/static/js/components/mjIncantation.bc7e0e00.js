
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{A as a}from"../mj/mj.482967bc.js";import{a as e}from"../system/system.a11a12d4.js";import{d as n,r as l,G as t,C as i,j as o,o as s,J as d,g as u,f as c,h as r,e as p,b as m,c as g,W as f,V as h,O as y,P as v,q as b}from"../main-646ffc07.js";const w={style:{height:"auto","overflow-y":"auto","overflow-x":"hidden"}},_=["src"],j=b(n({__name:"mjIncantation",props:{list:{type:Array,required:!0,default:()=>[]}},emits:["fresh"],setup(n,{expose:b,emit:j}){const C=l(!1),V=l(""),x=l(0),E=l(),k=l(!1),q=t({incantationCn:"",incantationEn:"",pid:void 0,img:""}),I=n,M=i((()=>I.list.filter((a=>2===a.level)))),O=j,U=t({incantationCn:[{required:!0,message:"咒语名称不能为空",trigger:"change"},{max:50,message:"最大长度50"}],incantationEn:[{required:!0,message:"咒语英文翻译不能为空",trigger:"change"},{max:100,message:"最大长度100"}],pid:[{required:!0,message:"分类必选",trigger:"change"}]});const z=a=>"image/jpeg"!==a.type&&"image/png"!==a.type?(v.error("只支持jpg和png格式"),!1):!(a.size/1024/1024>2)||(v.error("图片不能大于2M!"),!1),A=async a=>{await(null==a?void 0:a.validate((async a=>{a&&(x.value?await D({id:x.value,...q}):await F(q),O("fresh",!0),C.value=!1,Object.assign(q,{}))})))},F=async e=>(await a.addMjIncantation(e),v.success("添加咒语成功！"),!0),P=async e=>await a.getMjIncantation(e).then((a=>a.data)),D=async e=>{await a.modifyMjIncantation(e),v.success("更新咒语成功！")};return b({open:function(a){C.value=!0,x.value=a||0,V.value=a?"编辑咒语":"添加咒语",a&&a>0?P({id:a}).then((a=>{const{incantationCn:e,incantationEn:n,img:l,pid:t}=a;Object.assign(q,{incantationCn:e,incantationEn:n,img:l,pid:t})})):Object.assign(q,{incantationCn:"",incantationEn:"",pid:void 0,img:""})}}),(n,l)=>{const t=o("Plus"),i=o("el-icon"),v=o("el-upload"),b=o("el-form-item"),j=o("el-input"),x=o("el-col"),I=o("el-button"),O=o("el-row"),F=o("el-option"),P=o("el-select"),D=o("el-form"),G=o("el-dialog");return s(),d(G,{modelValue:p(C),"onUpdate:modelValue":l[7]||(l[7]=a=>y(C)?C.value=a:null),"append-to-body":!0,"close-on-click-modal":!1,title:p(V),top:"80px",fullscreen:!1,width:"500px","z-index":2e3},{footer:u((()=>[c(I,{onClick:l[5]||(l[5]=a=>C.value=!1)},{default:u((()=>[r(" 取消 ")])),_:1}),c(I,{type:"primary",onClick:l[6]||(l[6]=a=>A(p(E)))},{default:u((()=>[r(" 确认 ")])),_:1})])),default:u((()=>[m("div",w,[c(D,{model:q,"label-position":"right",disabled:p(k),ref_key:"formRef",ref:E,rules:U,inline:!1,"label-width":"80px"},{default:u((()=>[c(b,{label:"咒语图片",prop:"img"},{default:u((()=>[c(v,{class:"logo-uploader",action:"","auto-upload":!1,"show-file-list":!1,onChange:l[0]||(l[0]=a=>(a=>{const n=a.name.split(".")[1],l=new FormData;l.append("filename",a.raw.uid+"."+n),l.append("file",a.raw),l.append("dir","gpts-logo"),e.uploadFile(l).then((a=>{q.img=a.data}))})(a)),"before-upload":z},{default:u((()=>[q.img?(s(),g("img",{key:0,src:q.img,class:"avatar"},null,8,_)):(s(),d(i,{key:1,class:"logo-uploader-icon"},{default:u((()=>[c(t)])),_:1}))])),_:1})])),_:1}),c(b,{label:"咒语名称",prop:"incantationCn"},{default:u((()=>[c(O,{gutter:4},{default:u((()=>[c(x,{span:23},{default:u((()=>[c(j,{modelValue:q.incantationCn,"onUpdate:modelValue":l[1]||(l[1]=a=>q.incantationCn=a),style:{width:"100%"},placeholder:"输入中文咒语",clearable:"",maxlength:"50"},null,8,["modelValue"])])),_:1}),c(x,{span:1},{default:u((()=>[c(I,{onClick:l[2]||(l[2]=e=>(async e=>{k.value=!0;const n=await a.getCnTranslateEn({text:e}).then((a=>a.data)).catch((a=>{k.value=!1}));q.incantationEn=n,k.value=!1})(q.incantationCn)),loading:p(k)},{default:u((()=>[r("翻译")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1}),c(b,{label:"咒语英译",prop:"incantationEn"},{default:u((()=>[c(j,{modelValue:q.incantationEn,"onUpdate:modelValue":l[3]||(l[3]=a=>q.incantationEn=a),placeholder:"输入咒语英译",clearable:"",maxlength:"50"},null,8,["modelValue"])])),_:1}),c(b,{label:"分类",prop:"pid"},{default:u((()=>[c(P,{modelValue:q.pid,"onUpdate:modelValue":l[4]||(l[4]=a=>q.pid=a),placeholder:"选择分类","fit-input-width":"",style:{width:"100%"}},{default:u((()=>[(s(!0),g(h,null,f(p(M),(a=>(s(),d(F,{value:a.id,label:a.classifyName},null,8,["value","label"])))),256))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","disabled","rules"])])])),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-c894a7ab"]]);export{j as default};
