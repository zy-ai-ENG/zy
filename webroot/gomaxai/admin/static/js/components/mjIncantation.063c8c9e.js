
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{A as a}from"../mj/mj.d955ece3.js";import{a as e}from"../system/system.02ba9747.js";import{d as n,r as l,Q as t,B as i,h as o,o as s,I as d,f as u,e as c,l as r,b as p,a as m,c as g,U as f,S as h,W as y,E as v,n as b}from"../main-1d1da8fb.js";const _={style:{height:"auto","overflow-y":"auto","overflow-x":"hidden"}},w=["src"],j=b(n({__name:"mjIncantation",props:{list:{type:Array,required:!0,default:()=>[]}},emits:["fresh"],setup(n,{expose:b,emit:j}){const C=l(!1),x=l(""),V=l(0),E=l(),k=l(!1),I=t({incantationCn:"",incantationEn:"",pid:void 0,img:""}),U=n,q=i((()=>U.list.filter((a=>2===a.level)))),M=j,A=t({incantationCn:[{required:!0,message:"咒语名称不能为空",trigger:"change"},{max:50,message:"最大长度50"}],incantationEn:[{required:!0,message:"咒语英文翻译不能为空",trigger:"change"},{max:100,message:"最大长度100"}],pid:[{required:!0,message:"分类必选",trigger:"change"}]});const O=a=>"image/jpeg"!==a.type&&"image/png"!==a.type?(v.error("只支持jpg和png格式"),!1):!(a.size/1024/1024>2)||(v.error("图片不能大于2M!"),!1),z=async a=>{await(null==a?void 0:a.validate((async a=>{a&&(V.value?await D({id:V.value,...I}):await F(I),M("fresh",!0),C.value=!1,Object.assign(I,{}))})))},F=async e=>(await a.addMjIncantation(e),v.success("添加咒语成功！"),!0),B=async e=>await a.getMjIncantation(e).then((a=>a.data)),D=async e=>{await a.modifyMjIncantation(e),v.success("更新咒语成功！")};return b({open:function(a){C.value=!0,V.value=a||0,x.value=a?"编辑咒语":"添加咒语",a&&a>0?B({id:a}).then((a=>{const{incantationCn:e,incantationEn:n,img:l,pid:t}=a;Object.assign(I,{incantationCn:e,incantationEn:n,img:l,pid:t})})):Object.assign(I,{incantationCn:"",incantationEn:"",pid:void 0,img:""})}}),(n,l)=>{const t=o("Plus"),i=o("el-icon"),v=o("el-upload"),b=o("el-form-item"),j=o("el-input"),V=o("el-col"),U=o("el-button"),M=o("el-row"),F=o("el-option"),B=o("el-select"),D=o("el-form"),N=o("el-dialog");return s(),d(N,{modelValue:p(C),"onUpdate:modelValue":l[7]||(l[7]=a=>y(C)?C.value=a:null),"append-to-body":!0,"close-on-click-modal":!1,title:p(x),top:"80px",fullscreen:!1,width:"500px","z-index":2e3},{footer:u((()=>[c(U,{onClick:l[5]||(l[5]=a=>C.value=!1)},{default:u((()=>[r(" 取消 ")])),_:1}),c(U,{type:"primary",onClick:l[6]||(l[6]=a=>z(p(E)))},{default:u((()=>[r(" 确认 ")])),_:1})])),default:u((()=>[m("div",_,[c(D,{model:I,"label-position":"right",disabled:p(k),ref_key:"formRef",ref:E,rules:A,inline:!1,"label-width":"80px"},{default:u((()=>[c(b,{label:"咒语图片",prop:"img"},{default:u((()=>[c(v,{class:"logo-uploader",action:"","auto-upload":!1,"show-file-list":!1,onChange:l[0]||(l[0]=a=>(a=>{const n=a.name.split(".")[1],l=new FormData;l.append("filename",a.raw.uid+"."+n),l.append("file",a.raw),l.append("dir","gpts-logo"),e.uploadFile(l).then((a=>{I.img=a.data}))})(a)),"before-upload":O},{default:u((()=>[I.img?(s(),g("img",{key:0,src:I.img,class:"avatar"},null,8,w)):(s(),d(i,{key:1,class:"logo-uploader-icon"},{default:u((()=>[c(t)])),_:1}))])),_:1})])),_:1}),c(b,{label:"咒语名称",prop:"incantationCn"},{default:u((()=>[c(M,{gutter:4},{default:u((()=>[c(V,{span:23},{default:u((()=>[c(j,{modelValue:I.incantationCn,"onUpdate:modelValue":l[1]||(l[1]=a=>I.incantationCn=a),style:{width:"100%"},placeholder:"输入中文咒语",clearable:"",maxlength:"50"},null,8,["modelValue"])])),_:1}),c(V,{span:1},{default:u((()=>[c(U,{onClick:l[2]||(l[2]=e=>(async e=>{k.value=!0;const n=await a.getCnTranslateEn({text:e}).then((a=>a.data)).catch((a=>{k.value=!1}));I.incantationEn=n,k.value=!1})(I.incantationCn)),loading:p(k)},{default:u((()=>[r("翻译")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1}),c(b,{label:"咒语英译",prop:"incantationEn"},{default:u((()=>[c(j,{modelValue:I.incantationEn,"onUpdate:modelValue":l[3]||(l[3]=a=>I.incantationEn=a),placeholder:"输入咒语英译",clearable:"",maxlength:"50"},null,8,["modelValue"])])),_:1}),c(b,{label:"分类",prop:"pid"},{default:u((()=>[c(B,{modelValue:I.pid,"onUpdate:modelValue":l[4]||(l[4]=a=>I.pid=a),placeholder:"选择分类","fit-input-width":"",style:{width:"100%"}},{default:u((()=>[(s(!0),g(h,null,f(p(q),(a=>(s(),d(F,{value:a.id,label:a.classifyName},null,8,["value","label"])))),256))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","disabled","rules"])])])),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-c894a7ab"]]);export{j as default};
