
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as e}from"../index/index.abdd0241.js";import{A as l}from"./package.6e5cc305.js";import{A as a,b as o}from"../main-a44a7162.js";import{u as t}from"../utcformatTime/utcformatTime.f6db2c52.js";import{C as r}from"../index/index.a3bb1d7d.js";import{E as u}from"../element-plus@2.3.4_vue@3.2.47/element-plus@2.3.4_vue@3.2.47.34526108.js";import{d as s,l as i,m as d,o as n,c as m,j as p,H as c,F as _,R as v,L as f,a as g,G as y,K as h,I as b,U as j,Y as w}from"../@vue_runtime-core@3.2.47/@vue_runtime-core@3.2.47.f65ce9b3.js";import{k as C,h as k,u as z,a as V}from"../@vue_reactivity@3.2.47/@vue_reactivity@3.2.47.e3514ec5.js";import{M as x}from"../@vue_shared@3.2.47/@vue_shared@3.2.47.0f451126.js";import"../@element-plus_icons-vue@2.1.0_vue@3.2.47/@element-plus_icons-vue@2.1.0_vue@3.2.47.ac084a9d.js";import"../mitt@3.0.0/mitt@3.0.0.f0e54764.js";import"../@iconify_vue@4.1.1_vue@3.2.47/@iconify_vue@4.1.1_vue@3.2.47.f5d0ccbf.js";import"../vue-router@4.1.6_vue@3.2.47/vue-router@4.1.6_vue@3.2.47.0dcda182.js";import"../eruda@3.0.0/eruda@3.0.0.b4351698.js";import"../copy-to-clipboard@3.3.3/copy-to-clipboard@3.3.3.e0d05bd3.js";import"../toggle-selection@1.0.6/toggle-selection@1.0.6.c563a038.js";import"../vconsole@3.15.0/vconsole@3.15.0.c5df0a73.js";import"../hotkeys-js@3.10.2/hotkeys-js@3.10.2.e364e5e1.js";import"../pinia@2.0.35_typescript@5.0.4_vue@3.2.47/pinia@2.0.35_typescript@5.0.4_vue@3.2.47.44d93223.js";import"../vue-demi@0.14.0_vue@3.2.47/vue-demi@0.14.0_vue@3.2.47.71ba0ef2.js";import"../lodash-es@4.17.21/lodash-es@4.17.21.4b0f838c.js";import"../@codemirror_language-data@6.3.1_@codemirror_state@6.2.0_@codemirror_view@6.10.1_@lezer_common@1.0.2/@codemirror_language-data@6.3.1_@codemirror_state@6.2.0_@codemirror_view@6.10.1_@lezer_common@1.0.2.c8753240.js";import"../@codemirror_language@6.6.0/@codemirror_language@6.6.0.b1412095.js";import"../@lezer_common@1.0.2/@lezer_common@1.0.2.f1b3fc52.js";import"../@codemirror_state@6.2.0/@codemirror_state@6.2.0.50a19798.js";import"../@codemirror_view@6.10.1/@codemirror_view@6.10.1.3e2a74d9.js";import"../style-mod@4.0.3/style-mod@4.0.3.2c0c074d.js";import"../w3c-keyname@2.2.6/w3c-keyname@2.2.6.89c2fad7.js";import"../@lezer_highlight@1.1.4/@lezer_highlight@1.1.4.ab75f228.js";import"../path-browserify@1.0.1/path-browserify@1.0.1.2c28aad1.js";import"../echarts@5.4.2/echarts@5.4.2.80043e35.js";import"../tslib@2.3.0/tslib@2.3.0.a4e99503.js";import"../zrender@5.4.3/zrender@5.4.3.e2452002.js";import"../resize-observer-polyfill@1.5.1/resize-observer-polyfill@1.5.1.ad543aa3.js";import"../axios@1.4.0/axios@1.4.0.a8ee11a1.js";import"../@vueuse_integrations@10.1.2_axios@1.4.0_nprogress@0.2.0_vue@3.2.47/@vueuse_integrations@10.1.2_axios@1.4.0_nprogress@0.2.0_vue@3.2.47.f14b7780.js";import"../nprogress@0.2.0/nprogress@0.2.0.8c969ce6.js";import"../@vueuse_shared@10.1.2_vue@3.2.47/@vueuse_shared@10.1.2_vue@3.2.47.a4edebfd.js";import"../@vue_runtime-dom@3.2.47/@vue_runtime-dom@3.2.47.439158bd.js";import"../@vueuse_core@9.13.0_vue@3.2.47/@vueuse_core@9.13.0_vue@3.2.47.c260552e.js";import"../@vueuse_shared@9.13.0_vue@3.2.47/@vueuse_shared@9.13.0_vue@3.2.47.5682e459.js";import"../@sxzz_popperjs-es@2.11.7/@sxzz_popperjs-es@2.11.7.b78c3215.js";import"../@ctrl_tinycolor@3.6.0/@ctrl_tinycolor@3.6.0.91de2ec7.js";import"../dayjs@1.11.7/dayjs@1.11.7.d5551305.js";import"../@vue_reactivity@3.3.0-beta.3/@vue_reactivity@3.3.0-beta.3.d2bad40d.js";import"../@vue_shared@3.3.0-beta.3/@vue_shared@3.3.0-beta.3.6870dbff.js";import"../async-validator@4.2.5/async-validator@4.2.5.cf877c1f.js";import"../memoize-one@6.0.0/memoize-one@6.0.0.63ab667a.js";import"../escape-html@1.0.3/escape-html@1.0.3.0dbb34ec.js";import"../normalize-wheel-es@1.2.0/normalize-wheel-es@1.2.0.3222b0a2.js";import"../@floating-ui_dom@1.2.7/@floating-ui_dom@1.2.7.88b7d3a9.js";import"../@floating-ui_core@1.2.6/@floating-ui_core@1.2.6.88778327.js";const M={style:{float:"right"}},U={key:1},I={class:"dialog-footer"},q={style:{"max-height":"200px",overflow:"scroll"}},A={class:"dialog-footer"},R=s({__name:"crami",setup(o){const s=C(),R=C(0),$=C(!1),L=C(!1),N=C(),Y=C(0),J=C([]),P=C([]),D=C(!1),F=C([]),S=C([]),T=k({packageId:null,count:1,drawMjCount:0,model3Count:0,model4Count:0}),E=k({useId:"",status:"",page:1,size:15}),O=k({packageId:[{required:!0,message:"请选择套餐类型",trigger:"change"}],days:[{required:!0,message:"请填写有效期天数",trigger:"blur"}],count:[{required:!0,message:"请填写想要生成的数量",trigger:"blur"}],drawMjCount:[{required:!0,message:"卡密携带MJ绘画数量",trigger:"blur"}],model3Count:[{required:!0,message:"卡密携带基础模型对话数量",trigger:"blur"}],model4Count:[{required:!0,message:"卡密携带高级模型金额",trigger:"blur"}]}),B=C([]);async function K(){try{D.value=!0;const e=await l.queryAllCrami(E),{rows:a,count:o}=e.data;D.value=!1,R.value=o,B.value=a}catch(e){D.value=!1}}async function G(e){const l=await a.queryAllUser({size:30,username:e});P.value=l.data.rows}function H(){!async function(){const e=await l.queryAllPackage({size:100});J.value=e.data.rows}(),$.value=!0}async function X(e){F.value=e}async function Z(){try{D.value=!0,await l.batchDelCrami({ids:F.value.map((e=>e.id))}),D.value=!1,u({type:"success",message:"删除卡密成功！"}),K()}catch(e){D.value=!1}}function Q(){L.value=!0;const e=F.value.map((e=>`${e.code}<----\x3e${e.packageName||"自定义套餐"}`));S.value=e}function W(){!function(e,l){const a=function(e){return e.join("\n")}(e),o=new Blob([a],{type:"text/plain"}),t=URL.createObjectURL(o),r=document.createElement("a");r.href=t,r.download=`${l}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),setTimeout((()=>URL.revokeObjectURL(t)),0)}(F.value.map((e=>`${e.code}<----\x3e${e.packageName||"自定义套餐"}`)),"卡密信息")}const ee=i((()=>B.value.some((e=>e.email))));return d((()=>{K()})),(a,o)=>{const i=j("el-option"),d=j("el-select"),C=j("el-form-item"),k=j("el-button"),le=j("Plus"),ae=j("el-icon"),oe=j("el-form"),te=e,re=j("el-table-column"),ue=j("el-tag"),se=j("el-popconfirm"),ie=j("el-table"),de=j("el-pagination"),ne=j("el-row"),me=j("el-switch"),pe=j("el-input"),ce=j("el-dialog"),_e=w("loading");return n(),m("div",null,[p(te,null,{default:c((()=>[p(oe,{ref_key:"formRef",ref:s,inline:!0,model:E},{default:c((()=>[p(C,{label:"用户名称",prop:"useId"},{default:c((()=>[p(d,{modelValue:E.useId,"onUpdate:modelValue":o[0]||(o[0]=e=>E.useId=e),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":G,style:{width:"192px"}},{default:c((()=>[(n(!0),m(_,null,v(z(P),(e=>(n(),y(i,{key:e.id,label:e.username,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),p(C,{label:"卡密状态",prop:"status"},{default:c((()=>[p(d,{modelValue:E.status,"onUpdate:modelValue":o[1]||(o[1]=e=>E.status=e),placeholder:"请选择卡密状态",clearable:"",style:{width:"192px"}},{default:c((()=>[(n(!0),m(_,null,v(z(r),(e=>(n(),y(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),p(C,null,{default:c((()=>[p(k,{type:"primary",onClick:K},{default:c((()=>[f(" 查询 ")])),_:1}),p(k,{onClick:o[2]||(o[2]=e=>{return null==(l=z(s))||l.resetFields(),void K();var l})},{default:c((()=>[f(" 重置 ")])),_:1})])),_:1}),g("div",M,[z(F).length?(n(),y(k,{key:0,type:"danger",onClick:Q},{default:c((()=>[f(" 显示选中卡密 ")])),_:1})):h("",!0),z(F).length?(n(),y(k,{key:1,type:"danger",onClick:Z},{default:c((()=>[f(" 批量删除卡密 ")])),_:1})):h("",!0),z(F).length?(n(),y(k,{key:2,type:"primary",onClick:W},{default:c((()=>[f(" 批量导出卡密 ")])),_:1})):h("",!0),p(k,{type:"success",onClick:H},{default:c((()=>[f(" 批量生成卡密 "),p(ae,{class:"ml-3"},{default:c((()=>[p(le)])),_:1})])),_:1})])])),_:1},8,["model"])])),_:1}),p(te,{bottomPadding:"20px",bottomMargin:"0px"},{default:c((()=>[b((n(),y(ie,{border:"",data:z(B),height:"calc(100vh - 310px)",style:{width:"100%"},size:"large",onSelectionChange:X},{default:c((()=>[p(re,{type:"selection",width:"55"}),p(re,{prop:"code",label:"卡密账号",width:"180"}),p(re,{prop:"packageName",label:"套餐类型",width:"180"},{default:c((e=>[p(ue,{type:e.row.packageName?"success":"danger"},{default:c((()=>[f(x(e.row.packageName||"自定义卡密"),1)])),_:2},1032,["type"])])),_:1}),p(re,{prop:"code",label:"卡密状态",width:"180"},{default:c((e=>[p(ue,{type:e.row.status?"danger":"success"},{default:c((()=>[f(x(e.row.status?"已使用":"未使用"),1)])),_:2},1032,["type"])])),_:1}),p(re,{prop:"useId",label:"使用人ID",width:"100"}),z(ee)?(n(),y(re,{key:0,prop:"email",label:"使用人邮箱",width:"180"})):h("",!0),p(re,{prop:"model3Count",label:"基础模型额度"}),p(re,{prop:"model4Count",label:"高级模型额度"}),p(re,{prop:"drawMjCount",label:"MJ额度"}),p(re,{prop:"days",label:"有效天数"},{default:c((e=>[f(x(e.row.days>0?`${e.row.days}天`:"永久"),1)])),_:1}),p(re,{prop:"createdAt",label:"注册时间",width:"200"},{default:c((e=>[f(x(z(t)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)])),_:1}),p(re,{label:"操作"},{default:c((e=>[p(se,{title:"确认删除此卡密么?",width:"200","icon-color":"red",onConfirm:a=>async function(e){await l.delCrami({id:e.id}),u({type:"success",message:"删除卡密成功！"}),K()}(e.row)},{reference:c((()=>[p(k,{link:"",type:"danger",size:"small"},{default:c((()=>[f(" 删除卡密 ")])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[_e,z(D)]]),p(ne,{class:"flex justify-end mt-5"},{default:c((()=>[p(de,{"current-page":E.page,"onUpdate:currentPage":o[3]||(o[3]=e=>E.page=e),"page-size":E.size,"onUpdate:pageSize":o[4]||(o[4]=e=>E.size=e),class:"mr-5","page-sizes":[15,50,100,200],layout:"total, sizes, prev, pager, next, jumper",total:z(R),onSizeChange:K,onCurrentChange:K},null,8,["current-page","page-size","total"])])),_:1})])),_:1}),p(ce,{modelValue:z($),"onUpdate:modelValue":o[13]||(o[13]=e=>V($)?$.value=e:null),title:"生成卡密",width:"450",onClose:o[14]||(o[14]=e=>{var l;null==(l=z(N))||l.resetFields()})},{footer:c((()=>[g("span",I,[p(k,{onClick:o[11]||(o[11]=e=>$.value=!1)},{default:c((()=>[f("放弃生成")])),_:1}),p(k,{type:"primary",onClick:o[12]||(o[12]=e=>async function(e){null==e||e.validate((async e=>{e&&(await l.createCrami(T),u({type:"success",message:"生成卡密成功！"}),$.value=!1,K())}))}(z(N)))},{default:c((()=>[f(" 确定生成 ")])),_:1})])])),default:c((()=>[p(oe,{ref_key:"formCramiRef",ref:N,"label-position":"right","label-width":"100px",model:T,rules:O},{default:c((()=>[p(ne,null,{default:c((()=>[p(C,{label:"是否生成自定义卡密","label-width":"170px"},{default:c((()=>[p(me,{modelValue:z(Y),"onUpdate:modelValue":o[5]||(o[5]=e=>V(Y)?Y.value=e:null),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1})])),_:1}),z(Y)?h("",!0):(n(),y(C,{key:0,label:"套餐类型",prop:"packageId"},{default:c((()=>[p(d,{modelValue:T.packageId,"onUpdate:modelValue":o[6]||(o[6]=e=>T.packageId=e),modelModifiers:{number:!0},placeholder:"请选择套餐类型",clearable:"",style:{width:"100%"}},{default:c((()=>[(n(!0),m(_,null,v(z(J),(e=>(n(),y(i,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})),z(Y)?(n(),m("div",U,[p(C,{label:"基础模型额度",prop:"model3Count"},{default:c((()=>[p(pe,{modelValue:T.model3Count,"onUpdate:modelValue":o[7]||(o[7]=e=>T.model3Count=e),modelModifiers:{number:!0},type:"number",placeholder:"卡密携带基础模型额度"},null,8,["modelValue"])])),_:1}),p(C,{label:"高级模型额度",prop:"model4Count"},{default:c((()=>[p(pe,{modelValue:T.model4Count,"onUpdate:modelValue":o[8]||(o[8]=e=>T.model4Count=e),modelModifiers:{number:!0},type:"number",placeholder:"卡密携带高级模型额度"},null,8,["modelValue"])])),_:1}),p(C,{label:"MJ绘画额度",prop:"drawMjCount"},{default:c((()=>[p(pe,{modelValue:T.drawMjCount,"onUpdate:modelValue":o[9]||(o[9]=e=>T.drawMjCount=e),modelModifiers:{number:!0},type:"number",placeholder:"卡密携带MJ绘画额度"},null,8,["modelValue"])])),_:1})])):h("",!0),p(C,{label:"生成数量",prop:"count"},{default:c((()=>[p(pe,{modelValue:T.count,"onUpdate:modelValue":o[10]||(o[10]=e=>T.count=e),modelModifiers:{number:!0},type:"number",placeholder:"本次生成的张数"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"]),p(ce,{modelValue:z(L),"onUpdate:modelValue":o[16]||(o[16]=e=>V(L)?L.value=e:null),title:"卡密列表"},{footer:c((()=>[g("span",A,[p(k,{onClick:o[15]||(o[15]=e=>L.value=!1)},{default:c((()=>[f("关闭弹窗")])),_:1})])])),default:c((()=>[g("div",q,[(n(!0),m(_,null,v(z(S),((e,l)=>(n(),m("div",{key:l},x(e),1)))),128))])])),_:1},8,["modelValue"])])}}});"function"==typeof o&&o(R);export{R as default};
