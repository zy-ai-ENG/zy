
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as e}from"../index/index.abdd0241.js";import{g as a,b as t}from"../main-a44a7162.js";import{A as s,U as r,a as o,M as i,b as l}from"../index/index.a3bb1d7d.js";import n from"../components/manager.89179dd8.js";import{E as u}from"../element-plus@2.3.4_vue@3.2.47/element-plus@2.3.4_vue@3.2.47.34526108.js";import{d as m,m as p,o as d,c,j as _,H as v,F as f,R as g,L as j,a as y,I as b,G as h,U as w,Y as z}from"../@vue_runtime-core@3.2.47/@vue_runtime-core@3.2.47.f65ce9b3.js";import{k as x,h as k,u as C}from"../@vue_reactivity@3.2.47/@vue_reactivity@3.2.47.e3514ec5.js";import{M as S}from"../@vue_shared@3.2.47/@vue_shared@3.2.47.0f451126.js";import"../@element-plus_icons-vue@2.1.0_vue@3.2.47/@element-plus_icons-vue@2.1.0_vue@3.2.47.ac084a9d.js";import"../mitt@3.0.0/mitt@3.0.0.f0e54764.js";import"../@iconify_vue@4.1.1_vue@3.2.47/@iconify_vue@4.1.1_vue@3.2.47.f5d0ccbf.js";import"../vue-router@4.1.6_vue@3.2.47/vue-router@4.1.6_vue@3.2.47.0dcda182.js";import"../eruda@3.0.0/eruda@3.0.0.b4351698.js";import"../copy-to-clipboard@3.3.3/copy-to-clipboard@3.3.3.e0d05bd3.js";import"../toggle-selection@1.0.6/toggle-selection@1.0.6.c563a038.js";import"../vconsole@3.15.0/vconsole@3.15.0.c5df0a73.js";import"../hotkeys-js@3.10.2/hotkeys-js@3.10.2.e364e5e1.js";import"../pinia@2.0.35_typescript@5.0.4_vue@3.2.47/pinia@2.0.35_typescript@5.0.4_vue@3.2.47.44d93223.js";import"../vue-demi@0.14.0_vue@3.2.47/vue-demi@0.14.0_vue@3.2.47.71ba0ef2.js";import"../lodash-es@4.17.21/lodash-es@4.17.21.4b0f838c.js";import"../@codemirror_language-data@6.3.1_@codemirror_state@6.2.0_@codemirror_view@6.10.1_@lezer_common@1.0.2/@codemirror_language-data@6.3.1_@codemirror_state@6.2.0_@codemirror_view@6.10.1_@lezer_common@1.0.2.c8753240.js";import"../@codemirror_language@6.6.0/@codemirror_language@6.6.0.b1412095.js";import"../@lezer_common@1.0.2/@lezer_common@1.0.2.f1b3fc52.js";import"../@codemirror_state@6.2.0/@codemirror_state@6.2.0.50a19798.js";import"../@codemirror_view@6.10.1/@codemirror_view@6.10.1.3e2a74d9.js";import"../style-mod@4.0.3/style-mod@4.0.3.2c0c074d.js";import"../w3c-keyname@2.2.6/w3c-keyname@2.2.6.89c2fad7.js";import"../@lezer_highlight@1.1.4/@lezer_highlight@1.1.4.ab75f228.js";import"../path-browserify@1.0.1/path-browserify@1.0.1.2c28aad1.js";import"../echarts@5.4.2/echarts@5.4.2.80043e35.js";import"../tslib@2.3.0/tslib@2.3.0.a4e99503.js";import"../zrender@5.4.3/zrender@5.4.3.e2452002.js";import"../resize-observer-polyfill@1.5.1/resize-observer-polyfill@1.5.1.ad543aa3.js";import"../axios@1.4.0/axios@1.4.0.a8ee11a1.js";import"../@vueuse_integrations@10.1.2_axios@1.4.0_nprogress@0.2.0_vue@3.2.47/@vueuse_integrations@10.1.2_axios@1.4.0_nprogress@0.2.0_vue@3.2.47.f14b7780.js";import"../nprogress@0.2.0/nprogress@0.2.0.8c969ce6.js";import"../@vueuse_shared@10.1.2_vue@3.2.47/@vueuse_shared@10.1.2_vue@3.2.47.a4edebfd.js";import"../@vue_runtime-dom@3.2.47/@vue_runtime-dom@3.2.47.439158bd.js";import"../@vueuse_core@9.13.0_vue@3.2.47/@vueuse_core@9.13.0_vue@3.2.47.c260552e.js";import"../@vueuse_shared@9.13.0_vue@3.2.47/@vueuse_shared@9.13.0_vue@3.2.47.5682e459.js";import"../@sxzz_popperjs-es@2.11.7/@sxzz_popperjs-es@2.11.7.b78c3215.js";import"../@ctrl_tinycolor@3.6.0/@ctrl_tinycolor@3.6.0.91de2ec7.js";import"../dayjs@1.11.7/dayjs@1.11.7.d5551305.js";import"../@vue_reactivity@3.3.0-beta.3/@vue_reactivity@3.3.0-beta.3.d2bad40d.js";import"../@vue_shared@3.3.0-beta.3/@vue_shared@3.3.0-beta.3.6870dbff.js";import"../async-validator@4.2.5/async-validator@4.2.5.cf877c1f.js";import"../memoize-one@6.0.0/memoize-one@6.0.0.63ab667a.js";import"../escape-html@1.0.3/escape-html@1.0.3.0dbb34ec.js";import"../normalize-wheel-es@1.2.0/normalize-wheel-es@1.2.0.3222b0a2.js";import"../@floating-ui_dom@1.2.7/@floating-ui_dom@1.2.7.88b7d3a9.js";import"../@floating-ui_core@1.2.6/@floating-ui_core@1.2.6.88778327.js";const U={style:{float:"right"}},V=m({__name:"user-access",setup(t){const m=x(),V=x(0);x(!1);const L=x(!1);k({status:0,id:0});const M=k({username:"",name:"",status:0,page:1,size:20}),P=x(),A=x([]);async function R(){try{L.value=!0;const e=await a.queryAccessList(M),{rows:t,count:s}=e.data;L.value=!1,V.value=s,A.value=t}catch(e){L.value=!1}}function F(){P.value.open()}const I=e=>{if(!e)return"全部";return(e&&JSON.parse(e)||[]).map((e=>l.map().get(e))).join("，")},O=e=>["super","admin"].includes(e);return p((()=>R())),(t,l)=>{const p=w("el-input"),x=w("el-form-item"),k=w("el-option"),$=w("el-select"),E=w("el-button"),J=w("Plus"),N=w("el-icon"),Y=w("el-form"),q=e,B=w("el-table-column"),D=w("el-tag"),G=w("el-popconfirm"),H=w("el-table"),K=w("el-pagination"),T=w("el-row"),X=z("loading");return d(),c("div",null,[_(n,{ref_key:"managerRef",ref:P,onFresh:R},null,512),_(q,null,{default:v((()=>[_(Y,{ref_key:"formRef",ref:m,inline:!0,model:M},{default:v((()=>[_(x,{label:"管理员账号",prop:"name"},{default:v((()=>[_(p,{modelValue:M.username,"onUpdate:modelValue":l[0]||(l[0]=e=>M.username=e),placeholder:"用户账号[模糊搜索]",clearable:""},null,8,["modelValue"])])),_:1}),_(x,{label:"管理员状态",prop:"status"},{default:v((()=>[_($,{modelValue:M.status,"onUpdate:modelValue":l[1]||(l[1]=e=>M.status=e),style:{width:"192px"}},{default:v((()=>[(d(!0),c(f,null,g(C(s),(e=>(d(),h(k,{label:e.label,value:e.value},null,8,["label","value"])))),256))])),_:1},8,["modelValue"])])),_:1}),_(x,null,{default:v((()=>[_(E,{type:"primary",onClick:R},{default:v((()=>[j(" 查询 ")])),_:1}),_(E,{onClick:l[2]||(l[2]=e=>(m.value,Object.assign(M,{username:"",name:"",status:0,page:1,size:20}),void R()))},{default:v((()=>[j(" 重置 ")])),_:1})])),_:1}),y("span",U,[_(E,{type:"success",onClick:F},{default:v((()=>[j(" 添加管理员 "),_(N,{class:"ml-3"},{default:v((()=>[_(J)])),_:1})])),_:1})])])),_:1},8,["model"])])),_:1}),_(q,{bottomPadding:"20px",bottomMargin:"0px"},{default:v((()=>[b((d(),h(H,{border:"",data:A.value,height:"66vh",width:"100%",size:"large"},{default:v((()=>[_(B,{prop:"id",label:"管理员ID",width:"100"}),_(B,{prop:"username",label:"登录账号"}),_(B,{prop:"password",label:"登录密码"}),_(B,{prop:"managerStatus",label:"管理员状态",align:"center"},{default:v((({row:e})=>[_(D,{type:C(r)[e.managerStatus]},{default:v((()=>[j(S(C(o)[e.managerStatus]),1)])),_:2},1032,["type"])])),_:1}),_(B,{prop:"role",label:"角色",width:"130",align:"center"},{default:v((({row:e})=>[y("p",null,S(C(i)[e.role]),1)])),_:1}),_(B,{prop:"accessLabel",label:"权限",width:"320",align:"center"},{default:v((({row:e})=>[y("p",null,S(I(e.accessLabel)),1)])),_:1}),_(B,{fixed:"right",label:"操作",width:"280",align:"center"},{default:v((e=>[_(E,{link:"",type:"primary",size:"small",disabled:O(e.row.role),onClick:a=>async function(e){P.value.open(e.userId)}(e.row)},{default:v((()=>[j(" 编辑权限 ")])),_:2},1032,["disabled","onClick"]),_(E,{link:"",type:"primary",size:"small",disabled:O(e.row.role),onClick:t=>async function(e){const t={id:e.id,status:1===e.managerStatus?2:1};(await a.updateManagerStatus(t)).success&&u({type:"success",message:`管理员${1===e.managerStatus?"停用":"启用"}成功！`}),await R()}(e.row)},{default:v((()=>[j(S(1===e.row.managerStatus?"停用":"启用"),1)])),_:2},1032,["disabled","onClick"]),_(G,{title:"确认重置此用户密码为【123456】?","confirm-button-text":"确认重置",onConfirm:t=>async function(e){const{id:t}=e;(await a.resetUserPassword({id:t})).success&&u({type:"success",message:`重置管理员[ ${e.username} ]密码为初始密码为[123456]完成！`}),await R()}(e.row)},{reference:v((()=>[_(E,{link:"",type:"danger",disabled:O(e.row.role)},{default:v((()=>[j(" 重置密码 ")])),_:2},1032,["disabled"])])),_:2},1032,["onConfirm"]),_(G,{title:"删除后不可找回，确定删除?","confirm-button-text":"确认",onConfirm:t=>(async e=>{await a.deleteAccess({id:e.id}),u.success("删除管理员成功！"),await R()})(e.row)},{reference:v((()=>[_(E,{link:"",type:"danger",disabled:O(e.row.role),size:"small"},{default:v((()=>[j(" 删除 ")])),_:2},1032,["disabled"])])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[X,L.value]]),_(T,{class:"flex justify-end mt-5 pb-5"},{default:v((()=>[_(K,{"current-page":M.page,"onUpdate:currentPage":l[3]||(l[3]=e=>M.page=e),"page-size":M.size,"onUpdate:pageSize":l[4]||(l[4]=e=>M.size=e),class:"mr-5","page-sizes":[15,30,50,100],layout:"total, sizes, prev, pager, next, jumper",total:V.value,onSizeChange:R,onCurrentChange:R},null,8,["current-page","page-size","total"])])),_:1})])),_:1})])}}});"function"==typeof t&&t(V);export{V as default};
