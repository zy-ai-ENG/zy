
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as e}from"../index/index.0db9df33.js";import{d as a,r as l,Q as t,x as s,h as n,R as r,o,c as u,e as i,f as d,S as c,U as p,b as m,l as f,a as g,w as b,I as w,t as _,V as y,E as v,q as h}from"../main-0579ff80.js";import{A as x,U as z,a as C,M as k,b as S}from"../index/index.f6e2b57f.js";import j from"../components/manager.962ac26a.js";const U={style:{float:"right"}},V=a({__name:"user-access",setup(a){const h=l(),V=l(0);l(!1);const P=l(!1);t({status:0,id:0});const A=t({username:"",name:"",status:0,page:1,size:20}),I=l(),L=l([]);async function M(){try{P.value=!0;const e=await y.queryAccessList(A),{rows:a,count:l}=e.data;P.value=!1,V.value=l,L.value=a}catch(e){P.value=!1}}function R(){I.value.open()}const q=e=>{if(!e)return"全部";return(e&&JSON.parse(e)||[]).map((e=>S.map().get(e))).join("，")},E=e=>["super","admin"].includes(e);return s((()=>M())),(a,l)=>{const t=n("el-input"),s=n("el-form-item"),S=n("el-option"),O=n("el-select"),$=n("el-button"),D=n("Plus"),F=n("el-icon"),G=n("el-form"),J=e,N=n("el-table-column"),Q=n("el-tag"),B=n("el-popconfirm"),H=n("el-table"),K=n("el-pagination"),T=n("el-row"),W=r("loading");return o(),u("div",null,[i(j,{ref_key:"managerRef",ref:I,onFresh:M},null,512),i(J,null,{default:d((()=>[i(G,{ref_key:"formRef",ref:h,inline:!0,model:A},{default:d((()=>[i(s,{label:"管理员账号",prop:"name"},{default:d((()=>[i(t,{modelValue:A.username,"onUpdate:modelValue":l[0]||(l[0]=e=>A.username=e),placeholder:"用户账号[模糊搜索]",clearable:""},null,8,["modelValue"])])),_:1}),i(s,{label:"管理员状态",prop:"status"},{default:d((()=>[i(O,{modelValue:A.status,"onUpdate:modelValue":l[1]||(l[1]=e=>A.status=e),style:{width:"192px"}},{default:d((()=>[(o(!0),u(c,null,p(m(x),(e=>(o(),w(S,{label:e.label,value:e.value},null,8,["label","value"])))),256))])),_:1},8,["modelValue"])])),_:1}),i(s,null,{default:d((()=>[i($,{type:"primary",onClick:M},{default:d((()=>[f(" 查询 ")])),_:1}),i($,{onClick:l[2]||(l[2]=e=>(h.value,Object.assign(A,{username:"",name:"",status:0,page:1,size:20}),void M()))},{default:d((()=>[f(" 重置 ")])),_:1})])),_:1}),g("span",U,[i($,{type:"success",onClick:R},{default:d((()=>[f(" 添加管理员 "),i(F,{class:"ml-3"},{default:d((()=>[i(D)])),_:1})])),_:1})])])),_:1},8,["model"])])),_:1}),i(J,{bottomPadding:"20px",bottomMargin:"0px"},{default:d((()=>[b((o(),w(H,{border:"",data:L.value,height:"66vh",width:"100%",size:"large"},{default:d((()=>[i(N,{prop:"id",label:"管理员ID",width:"100"}),i(N,{prop:"username",label:"登录账号"}),i(N,{prop:"password",label:"登录密码"}),i(N,{prop:"managerStatus",label:"管理员状态",align:"center"},{default:d((({row:e})=>[i(Q,{type:m(z)[e.managerStatus]},{default:d((()=>[f(_(m(C)[e.managerStatus]),1)])),_:2},1032,["type"])])),_:1}),i(N,{prop:"role",label:"角色",width:"130",align:"center"},{default:d((({row:e})=>[g("p",null,_(m(k)[e.role]),1)])),_:1}),i(N,{prop:"accessLabel",label:"权限",width:"320",align:"center"},{default:d((({row:e})=>[g("p",null,_(q(e.accessLabel)),1)])),_:1}),i(N,{fixed:"right",label:"操作",width:"280",align:"center"},{default:d((e=>[i($,{link:"",type:"primary",size:"small",disabled:E(e.row.role),onClick:a=>async function(e){I.value.open(e.userId)}(e.row)},{default:d((()=>[f(" 编辑权限 ")])),_:2},1032,["disabled","onClick"]),i($,{link:"",type:"primary",size:"small",disabled:E(e.row.role),onClick:a=>async function(e){const a={id:e.id,status:1===e.managerStatus?2:1};(await y.updateManagerStatus(a)).success&&v({type:"success",message:`管理员${1===e.managerStatus?"停用":"启用"}成功！`}),await M()}(e.row)},{default:d((()=>[f(_(1===e.row.managerStatus?"停用":"启用"),1)])),_:2},1032,["disabled","onClick"]),i(B,{title:"确认重置此用户密码为【123456】?","confirm-button-text":"确认重置",onConfirm:a=>async function(e){const{id:a}=e;(await y.resetUserPassword({id:a})).success&&v({type:"success",message:`重置管理员[ ${e.username} ]密码为初始密码为[123456]完成！`}),await M()}(e.row)},{reference:d((()=>[i($,{link:"",type:"danger",disabled:E(e.row.role)},{default:d((()=>[f(" 重置密码 ")])),_:2},1032,["disabled"])])),_:2},1032,["onConfirm"]),i(B,{title:"删除后不可找回，确定删除?","confirm-button-text":"确认",onConfirm:a=>(async e=>{await y.deleteAccess({id:e.id}),v.success("删除管理员成功！"),await M()})(e.row)},{reference:d((()=>[i($,{link:"",type:"danger",disabled:E(e.row.role),size:"small"},{default:d((()=>[f(" 删除 ")])),_:2},1032,["disabled"])])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[W,P.value]]),i(T,{class:"flex justify-end mt-5 pb-5"},{default:d((()=>[i(K,{"current-page":A.page,"onUpdate:currentPage":l[3]||(l[3]=e=>A.page=e),"page-size":A.size,"onUpdate:pageSize":l[4]||(l[4]=e=>A.size=e),class:"mr-5","page-sizes":[15,30,50,100],layout:"total, sizes, prev, pager, next, jumper",total:V.value,onSizeChange:M,onCurrentChange:M},null,8,["current-page","page-size","total"])])),_:1})])),_:1})])}}});"function"==typeof h&&h(V);export{V as default};
