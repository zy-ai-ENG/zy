
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{p as e}from"../@lezer_xml@1.0.1/@lezer_xml@1.0.1.ca8e6967.js";import{L as t,d as n,j as o,l,c as r,s as a}from"../@codemirror_language@6.6.0/@codemirror_language@6.6.0.b1412095.js";import"../@lezer_lr@1.3.4/@lezer_lr@1.3.4.69ac56de.js";import"../@lezer_common@1.0.2/@lezer_common@1.0.2.f1b3fc52.js";import"../@lezer_highlight@1.1.4/@lezer_highlight@1.1.4.ab75f228.js";import"../@codemirror_state@6.2.0/@codemirror_state@6.2.0.50a19798.js";import"../@codemirror_view@6.10.1/@codemirror_view@6.10.1.3e2a74d9.js";import"../style-mod@4.0.3/style-mod@4.0.3.2c0c074d.js";import"../w3c-keyname@2.2.6/w3c-keyname@2.2.6.89c2fad7.js";function i(e,t){let n=t&&t.getChild("TagName");return n?e.sliceString(n.from,n.to):""}function s(e,t){let n=t&&t.firstChild;return n&&"OpenTag"==n.name?i(e,n):""}function m(e){for(let t=e&&e.parent;t;t=t.parent)if("Element"==t.name)return t;return null}class p{constructor(e,t,n){this.attrs=t,this.attrValues=n,this.children=[],this.name=e.name,this.completion=Object.assign(Object.assign({type:"type"},e.completion||{}),{label:this.name}),this.openCompletion=Object.assign(Object.assign({},this.completion),{label:"<"+this.name}),this.closeCompletion=Object.assign(Object.assign({},this.completion),{label:"</"+this.name+">",boost:2}),this.closeNameCompletion=Object.assign(Object.assign({},this.completion),{label:this.name+">"}),this.text=e.textContent?e.textContent.map((e=>({label:e,type:"text"}))):[]}}const c=/^[:\-\.\w\u00b7-\uffff]*$/;function u(e){return Object.assign(Object.assign({type:"property"},e.completion||{}),{label:e.name})}function f(e){return"string"==typeof e?{label:`"${e}"`,type:"constant"}:/^"/.test(e.label)?e:Object.assign(Object.assign({},e),{label:`"${e.label}"`})}function g(e,t){let n=[],o=[],l=Object.create(null);for(let a of t){let e=u(a);n.push(e),a.global&&o.push(e),a.values&&(l[a.name]=a.values.map(f))}let r=[],g=[],d=Object.create(null);for(let a of e){let e=o,t=l;a.attributes&&(e=e.concat(a.attributes.map((e=>"string"==typeof e?n.find((t=>t.label==e))||{label:e,type:"property"}:(e.values&&(t==l&&(t=Object.create(t)),t[e.name]=e.values.map(f)),u(e))))));let i=new p(a,e,t);d[i.name]=i,r.push(i),a.top&&g.push(i)}g.length||(g=r);for(let a=0;a<r.length;a++){let t=e[a],n=r[a];if(t.children)for(let e of t.children)d[e]&&n.children.push(d[e]);else n.children=r}return e=>{var t;let{doc:n}=e.state,p=function(e,t){var n;let o=a(e).resolveInner(t,-1),l=null;for(let r=o;!l&&r.parent;r=r.parent)"OpenTag"!=r.name&&"CloseTag"!=r.name&&"SelfClosingTag"!=r.name&&"MismatchedCloseTag"!=r.name||(l=r);if(l&&(l.to>t||l.lastChild.type.isError)){let e=l.parent;if("TagName"==o.name)return"CloseTag"==l.name||"MismatchedCloseTag"==l.name?{type:"closeTag",from:o.from,context:e}:{type:"openTag",from:o.from,context:m(e)};if("AttributeName"==o.name)return{type:"attrName",from:o.from,context:l};if("AttributeValue"==o.name)return{type:"attrValue",from:o.from,context:l};let n=o==l||"Attribute"==o.name?o.childBefore(t):o;return"StartTag"==(null==n?void 0:n.name)?{type:"openTag",from:t,context:m(e)}:"StartCloseTag"==(null==n?void 0:n.name)&&n.to<=t?{type:"closeTag",from:t,context:e}:"Is"==(null==n?void 0:n.name)?{type:"attrValue",from:t,context:l}:n?{type:"attrName",from:t,context:l}:null}if("StartCloseTag"==o.name)return{type:"closeTag",from:t,context:o.parent};for(;o.parent&&o.to==t&&!(null===(n=o.lastChild)||void 0===n?void 0:n.type.isError);)o=o.parent;return"Element"==o.name||"Text"==o.name||"Document"==o.name?{type:"tag",from:t,context:"Element"==o.name?o:m(o)}:null}(e.state,e.pos);if(!p||"tag"==p.type&&!e.explicit)return null;let{type:u,from:f,context:h}=p;if("openTag"==u){let e=g,t=s(n,h);if(t){let n=d[t];e=(null==n?void 0:n.children)||r}return{from:f,options:e.map((e=>e.completion)),validFor:c}}if("closeTag"==u){let o=s(n,h);return o?{from:f,to:e.pos+(">"==n.sliceString(e.pos,e.pos+1)?1:0),options:[(null===(t=d[o])||void 0===t?void 0:t.closeNameCompletion)||{label:o+">",type:"type"}],validFor:c}:null}if("attrName"==u){let e=d[i(n,h)];return{from:f,options:(null==e?void 0:e.attrs)||o,validFor:c}}if("attrValue"==u){let t=function(e,t,n){let o=t&&t.getChildren("Attribute").find((e=>e.from<=n&&e.to>=n)),l=o&&o.getChild("AttributeName");return l?e.sliceString(l.from,l.to):""}(n,h,f);if(!t)return null;let o=d[i(n,h)],r=((null==o?void 0:o.attrValues)||l)[t];return r&&r.length?{from:f,to:e.pos+('"'==n.sliceString(e.pos,e.pos+1)?1:0),options:r,validFor:/^"[^"]*"?$/}:null}if("tag"==u){let t=s(n,h),o=d[t],l=[],a=h&&h.lastChild;!t||a&&"CloseTag"==a.name&&i(n,a)==t||l.push(o?o.closeCompletion:{label:"</"+t+">",type:"type",boost:2});let m=l.concat(((null==o?void 0:o.children)||(h?r:g)).map((e=>e.openCompletion)));if(h&&(null==o?void 0:o.text.length)){let t=h.firstChild;t.to>e.pos-20&&!/\S/.test(e.state.sliceDoc(t.to,e.pos))&&(m=m.concat(o.text))}return{from:f,options:m,validFor:/^<\/?[:\-\.\w\u00b7-\uffff]*$/}}return null}}const d=t.define({name:"xml",parser:e.configure({props:[n.add({Element(e){let t=/^\s*<\//.test(e.textAfter);return e.lineIndent(e.node.from)+(t?0:e.unit)},"OpenTag CloseTag SelfClosingTag":e=>e.column(e.node.from)+e.unit}),o.add({Element(e){let t=e.firstChild,n=e.lastChild;return t&&"OpenTag"==t.name?{from:t.to,to:"CloseTag"==n.name?n.from:e.to}:null}}),l.add({"OpenTag CloseTag":e=>e.getChild("TagName")})]}),languageData:{commentTokens:{block:{open:"\x3c!--",close:"--\x3e"}},indentOnInput:/^\s*<\/$/}});function h(e={}){return new r(d,d.data.of({autocomplete:g(e.elements||[],e.attributes||[])}))}export{g as completeFromSchema,h as xml,d as xmlLanguage};
