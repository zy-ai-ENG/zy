
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{P as e,E as t}from"../@codemirror_state@6.2.0/@codemirror_state@6.2.0.50a19798.js";import{k as r}from"../@codemirror_view@6.10.1/@codemirror_view@6.10.1.3e2a74d9.js";import{c as o,p as n,s,o as l,j as i,d as a,q as m,r as f,t as c,P as u}from"../@codemirror_language@6.6.0/@codemirror_language@6.6.0.b1412095.js";import{M as g,p as h,a as p,G as d,S as _,b as x,E as k}from"../@lezer_markdown@1.0.2/@lezer_markdown@1.0.2.741ae096.js";import{html as w}from"./@codemirror_lang-html@6.4.3.0189ec43.js";import{N as j}from"../@lezer_common@1.0.2/@lezer_common@1.0.2.f1b3fc52.js";import"../style-mod@4.0.3/style-mod@4.0.3.2c0c074d.js";import"../w3c-keyname@2.2.6/w3c-keyname@2.2.6.89c2fad7.js";import"../@lezer_highlight@1.1.4/@lezer_highlight@1.1.4.ab75f228.js";import"../@lezer_html@1.3.4/@lezer_html@1.3.4.0264342b.js";import"../@lezer_lr@1.3.4/@lezer_lr@1.3.4.69ac56de.js";import"./@codemirror_lang-css@6.2.0_@codemirror_view@6.10.1.a40e4ad4.js";import"../@lezer_css@1.1.1/@lezer_css@1.1.1.57763336.js";import"./@codemirror_lang-javascript@6.1.7.eb8f05cb.js";import"../@lezer_javascript@1.4.3/@lezer_javascript@1.4.3.50886484.js";import"../@codemirror_autocomplete@6.6.0_@codemirror_language@6.6.0_@codemirror_state@6.2.0_@codemirror_paybmlmgsxoxfhwyti4vm2xwei/@codemirror_autocomplete@6.6.0_@codemirror_language@6.6.0_@codemirror_state@6.2.0_@codemirror_paybmlmgsxoxfhwyti4vm2xwei.ad350a41.js";const v=l({commentTokens:{block:{open:"\x3c!--",close:"--\x3e"}}}),y=new j,A=p.configure({props:[i.add((e=>!e.is("Block")||e.is("Document")||null!=B(e)?void 0:(e,t)=>({from:t.doc.lineAt(e.from).to,to:e.to}))),y.add(B),a.add({Document:()=>null}),m.add({Document:v})]});function B(e){let t=/^(?:ATX|Setext)Heading(\d)$/.exec(e.name);return t?+t[1]:void 0}function b(e,t){let r=e;for(;;){let e,o=r.nextSibling;if(!o||null!=(e=B(o.type))&&e<=t)break;r=o}return r.to}const L=f.of(((e,t,r)=>{for(let o=s(e).resolveInner(r,-1);o&&!(o.from<t);o=o.parent){let e=o.type.prop(y);if(null==e)continue;let t=b(o,e);if(t>r)return{from:r,to:t}}return null}));function z(e){return new n(v,e,[L],"markdown")}const S=z(A),I=z(A.configure([d,_,x,k]));class C{constructor(e,t,r,o,n,s,l){this.node=e,this.from=t,this.to=r,this.spaceBefore=o,this.spaceAfter=n,this.type=s,this.item=l}blank(e,t=!0){let r=this.spaceBefore+("Blockquote"==this.node.name?">":"");if(null!=e){for(;r.length<e;)r+=" ";return r}for(let o=this.to-this.from-r.length-this.spaceAfter.length;o>0;o--)r+=" ";return r+(t?this.spaceAfter:"")}marker(e,t){let r="OrderedList"==this.node.name?String(+O(this.item,e)[2]+t):"";return this.spaceBefore+r+this.type+this.spaceAfter}}function E(e,t){let r=[];for(let n=e;n&&"Document"!=n.name;n=n.parent)"ListItem"!=n.name&&"Blockquote"!=n.name&&"FencedCode"!=n.name||r.push(n);let o=[];for(let n=r.length-1;n>=0;n--){let e,s=r[n],l=t.lineAt(s.from),i=s.from-l.from;if("FencedCode"==s.name)o.push(new C(s,i,i,"","","",null));else if("Blockquote"==s.name&&(e=/^[ \t]*>( ?)/.exec(l.text.slice(i))))o.push(new C(s,i,i+e[0].length,"",e[1],">",null));else if("ListItem"==s.name&&"OrderedList"==s.parent.name&&(e=/^([ \t]*)\d+([.)])([ \t]*)/.exec(l.text.slice(i)))){let t=e[3],r=e[0].length;t.length>=4&&(t=t.slice(0,t.length-4),r-=4),o.push(new C(s.parent,i,i+r,e[1],t,e[2],s))}else if("ListItem"==s.name&&"BulletList"==s.parent.name&&(e=/^([ \t]*)([-+*])([ \t]{1,4}\[[ xX]\])?([ \t]+)/.exec(l.text.slice(i)))){let t=e[4],r=e[0].length;t.length>4&&(t=t.slice(0,t.length-4),r-=4);let n=e[2];e[3]&&(n+=e[3].replace(/[xX]/," ")),o.push(new C(s.parent,i,i+r,e[1],t,n,s))}}return o}function O(e,t){return/^(\s*)(\d+)(?=[.)])/.exec(t.sliceString(e.from,e.from+10))}function q(e,t,r,o=0){for(let n=-1,s=e;;){if("ListItem"==s.name){let e=O(s,t),l=+e[2];if(n>=0){if(l!=n+1)return;r.push({from:s.from+e[1].length,to:s.from+e[0].length,insert:String(n+2+o)})}n=l}let e=s.nextSibling;if(!e)break;s=e}}const P=({state:e,dispatch:r})=>{let o=s(e),{doc:n}=e,l=null,i=e.changeByRange((r=>{if(!r.empty||!I.isActiveAt(e,r.from))return l={range:r};let s=r.from,i=n.lineAt(s),a=E(o.resolveInner(s,-1),n);for(;a.length&&a[a.length-1].from>s-i.from;)a.pop();if(!a.length)return l={range:r};let m=a[a.length-1];if(m.to-m.spaceAfter.length>s-i.from)return l={range:r};let f=s>=m.to-m.spaceAfter.length&&!/\S/.test(i.text.slice(m.to));if(m.item&&f){if(m.node.firstChild.to>=s||i.from>0&&!/[^\s>]/.test(n.lineAt(i.from-1).text)){let e,r=a.length>1?a[a.length-2]:null,o="";r&&r.item?(e=i.from+r.from,o=r.marker(n,1)):e=i.from+(r?r.to:0);let l=[{from:e,to:s,insert:o}];return"OrderedList"==m.node.name&&q(m.item,n,l,-2),r&&"OrderedList"==r.node.name&&q(r.item,n,l),{range:t.cursor(e+o.length),changes:l}}{let r="";for(let e=0,t=a.length-2;e<=t;e++)r+=a[e].blank(e<t?a[e+1].from-r.length:null,e<t);return r+=e.lineBreak,{range:t.cursor(s+r.length),changes:{from:i.from,insert:r}}}}if("Blockquote"==m.node.name&&f&&i.from){let t=n.lineAt(i.from-1),o=/>\s*$/.exec(t.text);if(o&&o.index==m.from){let n=e.changes([{from:t.from+o.index,to:t.to},{from:i.from+m.from,to:i.to}]);return{range:r.map(n),changes:n}}}let c=[];"OrderedList"==m.node.name&&q(m.item,n,c);let u=m.item&&m.item.from<i.from,g="";if(!u||/^[\s\d.)\-+*>]*/.exec(i.text)[0].length>=m.to)for(let e=0,t=a.length-1;e<=t;e++)g+=e!=t||u?a[e].blank(e<t?a[e+1].from-g.length:null):a[e].marker(n,1);let h=s;for(;h>i.from&&/\s/.test(i.text.charAt(h-i.from-1));)h--;return g=e.lineBreak+g,c.push({from:h,to:s,insert:g}),{range:t.cursor(h+g.length),changes:c}}));return!l&&(r(e.update(i,{scrollIntoView:!0,userEvent:"input"})),!0)};function D(e){return"QuoteMark"==e.name||"ListMark"==e.name}const M=({state:e,dispatch:r})=>{let o=s(e),n=null,l=e.changeByRange((r=>{let s=r.from,{doc:l}=e;if(r.empty&&I.isActiveAt(e,r.from)){let e=l.lineAt(s),n=E(function(e,t){let r=e.resolveInner(t,-1),o=t;D(r)&&(o=r.from,r=r.parent);for(let n;n=r.childBefore(o);)if(D(n))o=n.from;else{if("OrderedList"!=n.name&&"BulletList"!=n.name)break;r=n.lastChild,o=r.to}return r}(o,s),l);if(n.length){let o=n[n.length-1],l=o.to-o.spaceAfter.length+(o.spaceAfter?1:0);if(s-e.from>l&&!/\S/.test(e.text.slice(l,s-e.from)))return{range:t.cursor(e.from+l),changes:{from:e.from+l,to:s}};if(s-e.from==l&&(!o.item||e.from<=o.item.from||!/\S/.test(e.text.slice(0,o.to)))){let n=e.from+o.from;if(o.item&&o.node.from<o.item.from&&/\S/.test(e.text.slice(o.from,o.to)))return{range:r,changes:{from:n,to:e.from+o.to,insert:o.blank(o.to-o.from)}};if(n<s)return{range:t.cursor(n),changes:{from:n,to:s}}}}}return n={range:r}}));return!n&&(r(e.update(l,{scrollIntoView:!0,userEvent:"delete"})),!0)},R=[{key:"Enter",run:P},{key:"Backspace",run:M}],T=w({matchClosingTags:!1});function X(t={}){let{codeLanguages:n,defaultCodeLanguage:s,addKeymap:l=!0,base:{parser:i}=S}=t;if(!(i instanceof g))throw new RangeError("Base parser provided to `markdown` should be a Markdown parser");let a,m=t.extensions?[t.extensions]:[],f=[T.support];s instanceof o?(f.push(s.support),a=s.language):s&&(a=s);let p=n||a?(d=n,_=a,e=>{if(e&&d){let t=null;if(e=/\S*/.exec(e)[0],t="function"==typeof d?d(e):c.matchLanguageName(d,e,!0),t instanceof c)return t.support?t.support.language.parser:u.getSkippingParser(t.load());if(t)return t.parser}return _?_.parser:null}):void 0;var d,_;return m.push(h({codeParser:p,htmlParser:T.language.parser})),l&&f.push(e.high(r.of(R))),new o(z(i.configure(m)),f)}export{S as commonmarkLanguage,M as deleteMarkupBackward,P as insertNewlineContinueMarkup,X as markdown,R as markdownKeymap,I as markdownLanguage};
