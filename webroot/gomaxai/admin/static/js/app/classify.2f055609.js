
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as e}from"../index/index.3ad5ed39.js";import{d as a,r as l,Q as t,B as o,x as s,h as r,R as u,o as d,c as n,e as i,f as p,k as m,m as c,S as f,U as g,b as v,l as b,w as _,I as y,t as h,a as w,W as V,$ as I,X as C,E as k,q as x}from"../main-01383ffb.js";import{u as z}from"../utcformatTime/utcformatTime.f6db2c52.js";import{E as U,j}from"../index/index.4485e23d.js";const P=["src"],q={class:"flex justify-end mr-5"},D=a({__name:"classify",setup(a){const x=l(),D=l(0),M=l(!1),Y=l(!1),E=l("/api/upload/file"),F=t({name:"",status:"",page:1,size:10}),G=l(),K=l(0),R=t({name:"",des:"",coverImg:"",order:100,status:0}),S=t({name:[{required:!0,message:"请填写分类名称",trigger:"blur"}],des:[{required:!0,message:"请填写分类描述",trigger:"blur"}],coverImg:[{required:!1,message:"请填写分类封面图片地址",trigger:"blur"}],order:[{required:!1,message:"请填写排序ID",trigger:"blur"}],status:[{required:!0,message:"请选择分类状态",trigger:"change"}]}),A=l([]),B=o((()=>K.value?"更新套餐":"新增套餐")),J=o((()=>K.value?"确认更新":"确认新增"));async function T(){try{Y.value=!0;const e=await I.queryCats(F),{rows:a,count:l}=e.data;Y.value=!1,D.value=l,A.value=a}catch(e){Y.value=!1}}const W=(e,a)=>{R.coverImg=e.data},H=e=>["image/png","image/jpeg","image/gif","image/webp"].includes(e.type)?!(e.size/1024>300)||(k.error("当前限制文件最大不超过 300KB!"),!1):(k.error("当前系统仅支持 PNG、JPEG、GIF、和 WebP 格式的图片!"),!1);return s((()=>{T()})),(a,l)=>{const t=r("el-alert"),o=e,s=r("el-input"),L=r("el-form-item"),N=r("el-option"),O=r("el-select"),Q=r("el-button"),X=r("Plus"),$=r("el-icon"),Z=r("el-form"),ee=r("el-image"),ae=r("el-table-column"),le=r("el-tag"),te=r("el-popconfirm"),oe=r("el-table"),se=r("el-pagination"),re=r("el-row"),ue=r("el-switch"),de=r("el-upload"),ne=r("el-dialog"),ie=u("loading");return d(),n("div",null,[i(o,{bottomPadding:"20px"},{default:p((()=>[i(t,{closable:!1,"show-icon":"",title:"应用分类说明",description:"你创建的为系统内置分类、可能会被多个用户收藏、一旦创建、不建议删除、系统或限制已经创建的应用、请合理规范应用以免造成不必要的迷惑。",type:"success"})])),_:1}),i(o,null,{default:p((()=>[i(Z,{ref_key:"formRef",ref:x,inline:!0,model:F},{default:p((()=>[i(L,{label:"分类名称",prop:"name"},{default:p((()=>[i(s,{modelValue:F.name,"onUpdate:modelValue":l[0]||(l[0]=e=>F.name=e),placeholder:"分类名称[模糊搜索]",onKeydown:m(c(T,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"])])),_:1}),i(L,{label:"分类状态",prop:"status"},{default:p((()=>[i(O,{modelValue:F.status,"onUpdate:modelValue":l[1]||(l[1]=e=>F.status=e),placeholder:"请选择分类状态",clearable:"",style:{width:"192px"}},{default:p((()=>[(d(!0),n(f,null,g(v(U),(e=>(d(),y(N,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(L,null,{default:p((()=>[i(Q,{type:"primary",onClick:T},{default:p((()=>[b(" 查询 ")])),_:1}),i(Q,{onClick:l[2]||(l[2]=e=>{return null==(a=v(x))||a.resetFields(),void T();var a})},{default:p((()=>[b(" 重置 ")])),_:1})])),_:1}),i(Q,{type:"success",style:{float:"right"},onClick:l[3]||(l[3]=e=>M.value=!0)},{default:p((()=>[b(" 创建分类 "),i($,{class:"ml-3"},{default:p((()=>[i(X)])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),i(o,{bottomPadding:"20px",bottomMargin:"0px"},{default:p((()=>[_((d(),y(oe,{border:"",data:v(A),height:"54vh",style:{width:"100%"},size:"large"},{default:p((()=>[i(ae,{prop:"coverImg",label:"套餐封面",width:"120"},{default:p((e=>[i(ee,{style:{height:"50px"},src:e.row.coverImg,fit:"fill"},null,8,["src"])])),_:1}),i(ae,{prop:"name",label:"分类名称"}),i(ae,{prop:"appCount",label:"app数量"}),i(ae,{prop:"order",label:"排序ID"}),i(ae,{prop:"status",label:"分类状态"},{default:p((e=>[i(le,{type:1===e.row.status?"success":"danger"},{default:p((()=>[b(h(v(j)[e.row.status]),1)])),_:2},1032,["type"])])),_:1}),i(ae,{prop:"des",label:"描述信息",width:"300"}),i(ae,{prop:"createdAt",label:"创建时间",width:"200"},{default:p((e=>[b(h(v(z)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)])),_:1}),i(ae,{label:"操作",width:"200"},{default:p((e=>[i(Q,{link:"",type:"primary",size:"small",onClick:a=>function(e){K.value=e.id;const{name:a,status:l,des:t,order:o,coverImg:s}=e;C((()=>{Object.assign(R,{name:a,status:l,des:t,order:o,coverImg:s})})),M.value=!0}(e.row)},{default:p((()=>[b(" 编辑 ")])),_:2},1032,["onClick"]),i(te,{title:"确认删除此分类么?",width:"200","icon-color":"red",onConfirm:a=>async function(e){await I.deleteCats({id:e.id}),k.success("删除分类成功"),T()}(e.row)},{reference:p((()=>[i(Q,{link:"",type:"danger",size:"small"},{default:p((()=>[b(" 删除分类 ")])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[ie,v(Y)]]),i(re,{class:"flex justify-end mt-5"},{default:p((()=>[i(se,{"current-page":F.page,"onUpdate:currentPage":l[4]||(l[4]=e=>F.page=e),"page-size":F.size,"onUpdate:pageSize":l[5]||(l[5]=e=>F.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:v(D),onSizeChange:T,onCurrentChange:T},null,8,["current-page","page-size","total"])])),_:1})])),_:1}),i(ne,{modelValue:v(M),"onUpdate:modelValue":l[13]||(l[13]=e=>V(M)?M.value=e:null),"close-on-click-modal":!1,title:v(B),width:"570",onClose:l[14]||(l[14]=e=>{return a=v(G),K.value=0,void(null==a||a.resetFields());var a})},{footer:p((()=>[w("span",q,[i(Q,{onClick:l[11]||(l[11]=e=>M.value=!1)},{default:p((()=>[b("取消")])),_:1}),i(Q,{type:"primary",onClick:l[12]||(l[12]=e=>{var a;null==(a=v(G))||a.validate((async e=>{e&&(K.value?(await I.updateCats({id:K.value,...R}),k({type:"success",message:"更新套餐成功！"})):(await I.createCats(R),k({type:"success",message:"创建新的套餐成功！"})),M.value=!1,T())}))})},{default:p((()=>[b(h(v(J)),1)])),_:1})])])),default:p((()=>[i(Z,{ref_key:"formPackageRef",ref:G,"label-position":"right","label-width":"100px",model:R,rules:S},{default:p((()=>[i(L,{label:"分类名称",prop:"name"},{default:p((()=>[i(s,{modelValue:R.name,"onUpdate:modelValue":l[6]||(l[6]=e=>R.name=e),placeholder:"请填写分类名称"},null,8,["modelValue"])])),_:1}),i(L,{label:"分类状态",prop:"status"},{default:p((()=>[i(ue,{modelValue:R.status,"onUpdate:modelValue":l[7]||(l[7]=e=>R.status=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1}),i(L,{label:"背景地址",prop:"coverImg"},{default:p((()=>[i(s,{modelValue:R.coverImg,"onUpdate:modelValue":l[8]||(l[8]=e=>R.coverImg=e),placeholder:"请填写封面图地址"},null,8,["modelValue"])])),_:1}),i(L,{label:"封面",prop:"coverImg"},{default:p((()=>[i(de,{class:"avatar-uploader",action:v(E),"show-file-list":!1,"on-success":W,"before-upload":H},{default:p((()=>[R.coverImg?(d(),n("img",{key:0,src:R.coverImg,style:{width:"100px"},class:"avatar"},null,8,P)):(d(),y($,{key:1,class:"avatar-uploader-icon"},{default:p((()=>[i(X)])),_:1}))])),_:1},8,["action"])])),_:1}),i(L,{label:"排序ID",prop:"order"},{default:p((()=>[i(s,{modelValue:R.order,"onUpdate:modelValue":l[9]||(l[9]=e=>R.order=e),modelModifiers:{number:!0},placeholder:"请填写排序ID[数字越大越靠前]"},null,8,["modelValue"])])),_:1}),i(L,{label:"套餐描述",prop:"des"},{default:p((()=>[i(s,{modelValue:R.des,"onUpdate:modelValue":l[10]||(l[10]=e=>R.des=e),type:"textarea",placeholder:"请填写分类介绍信息、用于对外展示...",rows:4},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}});"function"==typeof x&&x(D);export{D as default};
