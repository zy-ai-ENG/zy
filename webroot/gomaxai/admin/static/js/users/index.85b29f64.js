
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as e}from"../index/index.0db9df33.js";import{d as l,r as a,Q as t,x as o,h as n,R as u,o as r,c as d,e as i,f as s,S as m,U as p,b as c,l as f,w as b,I as v,t as w,P as g,E as _,q as C}from"../main-0579ff80.js";import{x as h,U as y,w as M}from"../index/index.f6e2b57f.js";import{u as V}from"../utcformatTime/utcformatTime.f6db2c52.js";const x=l({__name:"index",setup(l){const C=a(),x=a(0),k=a(!1),I=a(!1),j=a(!1),U=a(0),z=a(),T=t({status:0,id:0}),D=t({model3Count:0,model4Count:0,drawMjCount:0}),$=t({username:"",email:"",status:"",page:1,size:15}),q=t({model3Count:[{required:!0,message:"请填写赠送基础模型额度",trigger:"blur"}],model4Count:[{required:!0,message:"请填写赠送高级模型额度",trigger:"blur"}],drawMjCount:[{required:!0,message:"请填写赠送MJ绘画额度",trigger:"blur"}]}),J=a([]);async function P(){try{I.value=!0;const e=await g.queryAllUser($),{rows:l,count:a}=e.data;I.value=!1,x.value=a,J.value=l}catch(e){I.value=!1}}async function S(){(await g.updateUserStatus(T)).success&&_({type:"success",message:"变更用户状态成功！"}),k.value=!1,P()}return o((()=>P())),(l,a)=>{const t=n("el-input"),o=n("el-form-item"),Y=n("el-option"),A=n("el-select"),R=n("el-button"),E=n("el-form"),F=e,G=n("el-table-column"),H=n("el-tag"),Q=n("el-popconfirm"),B=n("el-table"),K=n("el-pagination"),L=n("el-row"),N=n("el-dialog"),O=u("loading");return r(),d("div",null,[i(F,null,{default:s((()=>[i(E,{ref_key:"formRef",ref:C,inline:!0,model:$},{default:s((()=>[i(o,{label:"用户名称",prop:"username"},{default:s((()=>[i(t,{modelValue:$.username,"onUpdate:modelValue":a[0]||(a[0]=e=>$.username=e),placeholder:"用户姓名[模糊搜索]",clearable:""},null,8,["modelValue"])])),_:1}),i(o,{label:"用户邮箱",prop:"email"},{default:s((()=>[i(t,{modelValue:$.email,"onUpdate:modelValue":a[1]||(a[1]=e=>$.email=e),placeholder:"用户邮箱[模糊搜索]",clearable:""},null,8,["modelValue"])])),_:1}),i(o,{label:"用户状态",prop:"status"},{default:s((()=>[i(A,{modelValue:$.status,"onUpdate:modelValue":a[2]||(a[2]=e=>$.status=e),placeholder:"请选择用户状态",clearable:"",style:{width:"192px"}},{default:s((()=>[(r(!0),d(m,null,p(c(h),(e=>(r(),v(Y,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(o,null,{default:s((()=>[i(R,{type:"primary",onClick:P},{default:s((()=>[f(" 查询 ")])),_:1}),i(R,{onClick:a[3]||(a[3]=e=>{return null==(l=C.value)||l.resetFields(),void P();var l})},{default:s((()=>[f(" 重置 ")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),i(F,{bottomPadding:"20px",bottomMargin:"0px"},{default:s((()=>[b((r(),v(B,{border:"",height:"66vh",data:J.value,style:{width:"100%"},size:"large"},{default:s((()=>[i(G,{fixed:"",prop:"username",label:"用户名称",width:"150"}),i(G,{prop:"id",label:"用户ID",width:"80"}),i(G,{prop:"phone",label:"用户手机号",width:"250",align:"center"}),i(G,{prop:"email",label:"用户邮箱",width:"250",align:"center"}),i(G,{prop:"status",label:"用户状态",width:"120",align:"center"},{default:s((({row:e})=>[i(H,{type:c(y)[e.status]},{default:s((()=>[f(w(c(M)[e.status]),1)])),_:2},1032,["type"])])),_:1}),i(G,{prop:"balanceInfo.model3Count",label:"基础模型",width:"120",align:"center"}),i(G,{prop:"balanceInfo.model4Count",label:"高级模型",width:"120",align:"center"}),i(G,{prop:"balanceInfo.drawMjCount",label:"MJ余额",width:"120",align:"center"}),f("expirationTime "),i(G,{prop:"balanceInfo.drawMjCount",label:"会员到期时间",width:"170",align:"center"},{default:s((e=>[i(H,{type:"success"},{default:s((()=>{var l,a,t,o;return[f(w((null==(a=null==(l=e.row)?void 0:l.balanceInfo)?void 0:a.expirationTime)?c(V)(new Date(null==(o=null==(t=e.row)?void 0:t.balanceInfo)?void 0:o.expirationTime)):"非会员"),1)]})),_:2},1024)])),_:1}),i(G,{prop:"balanceInfo.memberModel3Count",label:"基础模型[会员]",width:"130",align:"center"}),i(G,{prop:"balanceInfo.memberModel4Count",label:"高级模型[会员]",width:"130",align:"center"}),i(G,{prop:"balanceInfo.memberDrawMjCount",label:"MJ余额[会员]",width:"130",align:"center"}),i(G,{prop:"balanceInfo.useModel3Count",label:"已用基础模型",width:"160",align:"center"},{default:s((e=>{var l,a;return[f(w(`${(null==(l=e.row.balanceInfo)?void 0:l.useModel3Count)||0}次 | ${(null==(a=e.row.balanceInfo)?void 0:a.useModel3Token)||0} Token`),1)]})),_:1}),i(G,{prop:"balanceInfo.useModel4Count",label:"已用高级模型",width:"160",align:"center"},{default:s((e=>{var l,a;return[f(w(`${(null==(l=e.row.balanceInfo)?void 0:l.useModel4Count)||0}次 | ${(null==(a=e.row.balanceInfo)?void 0:a.useModel4Token)||0} Token`),1)]})),_:1}),i(G,{prop:"balanceInfo.useDrawMjToken",label:"已用绘画MJ",width:"160",align:"center"},{default:s((e=>{var l;return[f(w(`${(null==(l=e.row.balanceInfo)?void 0:l.useDrawMjToken)||0} Token`),1)]})),_:1}),i(G,{prop:"createdAt",label:"注册时间",width:"200",align:"center"},{default:s((e=>[f(w(c(V)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)])),_:1}),i(G,{fixed:"right",label:"操作",width:"250",align:"center"},{default:s((e=>[i(R,{link:"",type:"primary",size:"small",onClick:l=>{return a=e.row,k.value=!0,T.status=a.status,void(T.id=a.id);var a}},{default:s((()=>[f(" 修改状态 ")])),_:2},1032,["onClick"]),i(Q,{title:"确认重置此用户密码为【123456】?","confirm-button-text":"确认重置",onConfirm:l=>async function(e){const{id:l,email:a}=e;(await g.resetUserPassword({id:l})).success&&_({type:"success",message:`重置用户[${a}密码为初始密码为[123456]完成！`})}(e.row)},{reference:s((()=>[i(R,{link:"",type:"danger"},{default:s((()=>[f(" 重置密码 ")])),_:1})])),_:2},1032,["onConfirm"]),i(R,{link:"",type:"primary",size:"small",onClick:l=>{return a=e.row,j.value=!0,void(U.value=a.id);var a}},{default:s((()=>[f(" 赠送卡密 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[O,I.value]]),i(L,{class:"flex justify-end mt-5"},{default:s((()=>[i(K,{"current-page":$.page,"onUpdate:currentPage":a[4]||(a[4]=e=>$.page=e),"page-size":$.size,"onUpdate:pageSize":a[5]||(a[5]=e=>$.size=e),class:"mr-5","page-sizes":[15,30,50,100],layout:"total, sizes, prev, pager, next, jumper",total:x.value,onSizeChange:P,onCurrentChange:P},null,8,["current-page","page-size","total"])])),_:1})])),_:1}),i(N,{modelValue:k.value,"onUpdate:modelValue":a[7]||(a[7]=e=>k.value=e),title:"变更用户状态",width:"500px"},{default:s((()=>[i(E,{model:T,inline:!0},{default:s((()=>[i(o,{label:"用户状态","label-width":"90px"},{default:s((()=>[i(A,{modelValue:T.status,"onUpdate:modelValue":a[6]||(a[6]=e=>T.status=e),placeholder:"请选择用户状态",clearable:""},{default:s((()=>[(r(!0),d(m,null,p(c(h),(e=>(r(),v(Y,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(o,null,{default:s((()=>[i(R,{type:"primary",onClick:S},{default:s((()=>[f(" 确认变更 ")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),i(N,{modelValue:j.value,"onUpdate:modelValue":a[13]||(a[13]=e=>j.value=e),title:"主动赠送用户",width:"450px",onClose:a[14]||(a[14]=e=>{return l=z.value,U.value=0,void(null==l||l.resetFields());var l})},{footer:s((()=>[i(R,{onClick:a[11]||(a[11]=e=>j.value=!1)},{default:s((()=>[f(" 放弃赠送 ")])),_:1}),i(R,{type:"primary",onClick:a[12]||(a[12]=e=>async function(e){null==e||e.validate((async e=>{e&&(await g.sendUserCrami({...D,userId:U.value}),_.success("赠送用户成功！"),j.value=!1,P())}))}(z.value))},{default:s((()=>[f(" 确认赠送 ")])),_:1})])),default:s((()=>[i(E,{ref_key:"cramiRef",ref:z,model:D,rules:q,"label-width":"115px"},{default:s((()=>[i(o,{label:"基础模型积分",prop:"model3Count"},{default:s((()=>[i(t,{modelValue:D.model3Count,"onUpdate:modelValue":a[8]||(a[8]=e=>D.model3Count=e),modelModifiers:{number:!0},type:"number",placeholder:"赠送基础模型积分"},null,8,["modelValue"])])),_:1}),i(o,{label:"高级模型积分",prop:"model4Count"},{default:s((()=>[i(t,{modelValue:D.model4Count,"onUpdate:modelValue":a[9]||(a[9]=e=>D.model4Count=e),modelModifiers:{number:!0},type:"number",placeholder:"赠送高级模型积分"},null,8,["modelValue"])])),_:1}),i(o,{label:"绘画额度积分",prop:"drawMjCount"},{default:s((()=>[i(t,{modelValue:D.drawMjCount,"onUpdate:modelValue":a[10]||(a[10]=e=>D.drawMjCount=e),modelModifiers:{number:!0},type:"number",placeholder:"赠送绘画额度积分"},null,8,["modelValue"])])),_:1}),i(o,{class:"flex justify-end"})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])}}});"function"==typeof C&&C(x);export{x as default};
