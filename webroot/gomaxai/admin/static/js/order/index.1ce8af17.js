
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as e}from"../index/index.c9f6880f.js";import{Y as a,d as l,r as t,G as o,y as r,j as s,U as u,o as n,c as d,f as i,g as p,V as f,W as c,e as m,h as w,w as g,J as h,t as b,S as y,P as v,s as _}from"../main-646ffc07.js";import{P as x,s as z,t as I,u as V}from"../index/index.5ad1a92e.js";import{u as j}from"../utcformatTime/utcformatTime.f6db2c52.js";const k=e=>a.get("order/queryAll",{params:e}),C=e=>a.post("order/delete",e),U=()=>a.post("order/deleteNotPay"),P=l({__name:"index",setup(a){const l=t(!1),_=t(!1),P=t([]),Y=t(),A=t(0),D=t(0),M=o({userId:"",platform:"",status:"",page:1,size:15}),S=t([]);async function q(){l.value=!0;try{const e=await k(M);l.value=!1;const{rows:a,count:t,total_price:o}=e.data;A.value=t,S.value=a,D.value=o}catch(e){l.value=!1}}async function G(e){const a=await y.queryAllUser({size:30,username:e});P.value=a.data.rows}async function J(){_.value=!0;try{await U(),v.success("删除未支付订单完成!"),await q(),_.value=!1}catch(e){v.error("删除未支付订单失败!"),_.value=!1}}return r((()=>{q()})),(a,t)=>{const o=s("el-option"),r=s("el-select"),y=s("el-form-item"),k=s("el-button"),U=s("el-popconfirm"),T=s("el-form"),F=s("el-statistic"),N=e,R=s("el-table-column"),W=s("el-tag"),B=s("el-table"),E=s("el-pagination"),H=s("el-row"),K=u("loading");return n(),d("div",null,[i(N,{class:"flex justify-between items-center"},{default:p((()=>[i(T,{ref_key:"formRef",ref:Y,inline:!0,model:M},{default:p((()=>[i(y,{label:"用户名称",prop:"userId"},{default:p((()=>[i(r,{modelValue:M.userId,"onUpdate:modelValue":t[0]||(t[0]=e=>M.userId=e),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":G,style:{width:"192px"}},{default:p((()=>[(n(!0),d(f,null,c(m(P),(e=>(n(),h(o,{key:e.id,label:e.username,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(y,{label:"支付平台",prop:"platform"},{default:p((()=>[i(r,{modelValue:M.platform,"onUpdate:modelValue":t[1]||(t[1]=e=>M.platform=e),clearable:"",placeholder:"请选择支付平台","remote-show-suffix":"",style:{width:"192px"}},{default:p((()=>[(n(!0),d(f,null,c(m(x),(e=>(n(),h(o,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(y,{label:"支付状态",prop:"status"},{default:p((()=>[i(r,{modelValue:M.status,"onUpdate:modelValue":t[2]||(t[2]=e=>M.status=e),clearable:"",placeholder:"请选择支付状态","remote-show-suffix":"",style:{width:"192px"}},{default:p((()=>[(n(!0),d(f,null,c(m(z),(e=>(n(),h(o,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(y,null,{default:p((()=>[i(k,{type:"primary",onClick:q},{default:p((()=>[w(" 查询 ")])),_:1}),i(k,{onClick:t[3]||(t[3]=e=>{return null==(a=m(Y))||a.resetFields(),void q();var a})},{default:p((()=>[w(" 重置 ")])),_:1}),i(U,{title:"确认删除所有未支付订单么?",onConfirm:J},{reference:p((()=>[i(k,{type:"danger"},{default:p((()=>[w("删除所有未支付订单")])),_:1})])),_:1})])),_:1})])),_:1},8,["model"]),i(F,{title:"累计已支付订单金额",value:m(D)},null,8,["value"])])),_:1}),i(N,{bottomPadding:"20px",bottomMargin:"0px"},{default:p((()=>[g((n(),h(B,{border:"",data:m(S),height:"67vh",style:{width:"100%"},size:"large","tooltip-options":{}},{default:p((()=>[i(R,{fixed:"",prop:"orderId",label:"订单ID",width:"315"}),i(R,{prop:"userInfo.username",label:"用户名称",width:"180"}),i(R,{prop:"userInfo.email",label:"用户邮箱",width:"200"}),i(R,{prop:"goodsInfo.name",label:"套餐名称",width:"140"}),i(R,{prop:"price",label:"商品单价",width:"110"}),i(R,{prop:"count",label:"购买数量",width:"90",align:"center"}),i(R,{prop:"total",label:"订单总价",width:"90",align:"center"}),i(R,{prop:"total",label:"支付平台",width:"90",align:"center"},{default:p((e=>[w(b(m(I)[e.row.payPlatform]),1)])),_:1}),i(R,{prop:"status",label:"支付状态",width:"90",align:"center"},{default:p((e=>[i(W,{type:1===e.row.status?"success":"warning"},{default:p((()=>[w(b(m(V)[e.row.status]),1)])),_:2},1032,["type"])])),_:1}),i(R,{prop:"createdAt",label:"订单时间",width:"200",fixed:"right"},{default:p((e=>[w(b(m(j)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)])),_:1}),i(R,{fixed:"right",label:"操作"},{default:p((e=>[i(U,{title:"确认删除此订单么、删除订单不可恢复?",width:"400","icon-color":"red",onConfirm:a=>async function(e){const{orderId:a}=e;await C({orderId:a}),v.success("删除订单完成!"),q()}(e.row)},{reference:p((()=>[i(k,{link:"",type:"danger",size:"small",loading:m(_)},{default:p((()=>[w(" 删除订单 ")])),_:1},8,["loading"])])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[K,m(l)]]),i(H,{class:"flex justify-end mt-5"},{default:p((()=>[i(E,{"current-page":M.page,"onUpdate:currentPage":t[4]||(t[4]=e=>M.page=e),"page-size":M.size,"onUpdate:pageSize":t[5]||(t[5]=e=>M.size=e),class:"mr-5","page-sizes":[15,30,50,100],layout:"total, sizes, prev, pager, next, jumper",total:m(A),onSizeChange:q,onCurrentChange:q},null,8,["current-page","page-size","total"])])),_:1})])),_:1})])}}});"function"==typeof _&&_(P);export{P as default};
