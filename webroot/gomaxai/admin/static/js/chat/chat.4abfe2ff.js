
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as e}from"../index/index.129bbe0b.js";import{d as a,r as l,Q as t,x as r,h as o,R as s,o as n,c as d,e as p,f as i,S as u,U as m,k as c,m as f,l as w,b as h,w as g,I as _,t as b,a as v,P as y,n as k,q as z}from"../main-dd192319.js";import{m as x}from"../marked.esm/marked.esm.b7e5160c.js";import{A as T}from"./chat.2c531501.js";import{u as j}from"../utcformatTime/utcformatTime.f6db2c52.js";const A={class:"answer"},I=["innerHTML"],C=a({__name:"chat",setup(a){const k=new x.Renderer;x.setOptions({renderer:k,gfm:!0,pedantic:!1,sanitize:!1});const z=l(!1),C=l(),U=l(0),V=t({userId:"",prompt:"",page:1,size:10}),M=l([]);async function L(){z.value=!0;try{const e=await T.queryChatAll(V);z.value=!1;const{rows:a,count:l}=e.data;U.value=l,M.value=a}catch(e){z.value=!1}}async function Y(e){await y.queryAllUser({size:30,username:e})}return r((()=>{L()})),(a,l)=>{const t=o("el-option"),r=o("el-select"),y=o("el-form-item"),k=o("el-input"),T=o("el-button"),q=o("el-form"),K=e,P=o("el-table-column"),R=o("el-popover"),S=o("el-table"),D=o("el-pagination"),H=o("el-row"),F=s("loading");return n(),d("div",null,[p(K,null,{default:i((()=>[p(q,{ref_key:"formRef",ref:C,inline:!0,model:V},{default:i((()=>[p(y,{label:"用户名称",prop:"userId"},{default:i((()=>[p(r,{modelValue:V.userId,"onUpdate:modelValue":l[0]||(l[0]=e=>V.userId=e),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":Y,style:{width:"192px"}},{default:i((()=>[(n(!0),d(u,null,m(a.userList,(e=>(n(),_(t,{key:e.id,label:e.username,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),p(y,{label:"用户询问的问题",prop:"prompt"},{default:i((()=>[p(k,{modelValue:V.prompt,"onUpdate:modelValue":l[1]||(l[1]=e=>V.prompt=e),placeholder:"提问问题[模糊搜索]",onKeydown:c(f(L,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"])])),_:1}),p(y,null,{default:i((()=>[p(T,{type:"primary",onClick:L},{default:i((()=>[w(" 查询 ")])),_:1}),p(T,{onClick:l[2]||(l[2]=e=>{return null==(a=h(C))||a.resetFields(),void L();var a})},{default:i((()=>[w(" 重置 ")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),p(K,{bottomPadding:"20px",bottomMargin:"0px"},{default:i((()=>[g((n(),_(S,{height:"66vh",border:"",data:h(M),style:{width:"100%"},size:"large","tooltip-options":{}},{default:i((()=>[p(P,{fixed:"",prop:"username",label:"用户名称",width:"150"}),p(P,{prop:"createdAt",label:"角色",width:"80"},{default:i((e=>[w(b("user"===e.row.role?"用户":"电脑"),1)])),_:1}),p(P,{prop:"email",label:"用户邮箱",width:"200"}),p(P,{prop:"answer",label:"用户询问/AI回复"},{default:i((e=>[p(R,{placement:"top",width:400,trigger:"click"},{reference:i((()=>[v("div",A,b("user"===e.row.role?e.row.prompt:e.row.answer),1)])),default:i((()=>[v("div",{class:"answer_container",innerHTML:h(x)("user"===e.row.role?e.row.prompt:e.row.answer||"")},null,8,I)])),_:2},1024)])),_:1}),p(P,{prop:"completionTokens",label:"提问/回答Token",width:"140",align:"center"},{default:i((e=>[w(b("user"===e.row.role?e.row.promptTokens:e.row.completionTokens),1)])),_:1}),p(P,{prop:"totalTokens",label:"总计Toekn",width:"110",align:"center"}),p(P,{prop:"model",label:"模型",width:"200"}),p(P,{prop:"createdAt",label:"提问时间",width:"200"},{default:i((e=>[w(b(h(j)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)])),_:1})])),_:1},8,["data"])),[[F,h(z)]]),p(H,{class:"flex justify-end mt-5"},{default:i((()=>[p(D,{"current-page":V.page,"onUpdate:currentPage":l[3]||(l[3]=e=>V.page=e),"page-size":V.size,"onUpdate:pageSize":l[4]||(l[4]=e=>V.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:h(U),onSizeChange:L,onCurrentChange:L},null,8,["current-page","page-size","total"])])),_:1})])),_:1})])}}});"function"==typeof z&&z(C);const U=k(C,[["__scopeId","data-v-2d29503a"]]);export{U as default};
