
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as e}from"../index/index.0db9df33.js";import{d as a,r as l,Q as t,x as r,h as o,R as s,o as n,c as d,e as p,f as i,S as u,U as m,b as c,k as f,m as w,l as h,w as g,I as _,t as b,a as v,P as y,n as k,q as z}from"../main-0579ff80.js";import{m as x}from"../marked.esm/marked.esm.b7e5160c.js";import{A as T}from"./chat.e0cffff1.js";import{u as I}from"../utcformatTime/utcformatTime.f6db2c52.js";const j={class:"answer"},A=["innerHTML"],C=a({__name:"chat",setup(a){const k=new x.Renderer;x.setOptions({renderer:k,gfm:!0,pedantic:!1,sanitize:!1});const z=l(!1),C=l([]),U=l(),V=l(0),M=t({userId:"",prompt:"",page:1,size:10}),Y=l([]);async function q(){z.value=!0;try{const e=await T.queryChatAll(M);z.value=!1;const{rows:a,count:l}=e.data;V.value=l,Y.value=a}catch(e){z.value=!1}}async function H(e){const a=await y.queryAllUser({size:30,username:e});C.value=a.data.rows}return r((()=>{q()})),(a,l)=>{const t=o("el-option"),r=o("el-select"),y=o("el-form-item"),k=o("el-input"),T=o("el-button"),P=o("el-form"),R=e,S=o("el-table-column"),D=o("el-popover"),K=o("el-table"),L=o("el-pagination"),E=o("el-row"),F=s("loading");return n(),d("div",null,[p(R,null,{default:i((()=>[p(P,{ref_key:"formRef",ref:U,inline:!0,model:M},{default:i((()=>[p(y,{label:"用户名称",prop:"userId"},{default:i((()=>[p(r,{modelValue:M.userId,"onUpdate:modelValue":l[0]||(l[0]=e=>M.userId=e),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":H,style:{width:"192px"}},{default:i((()=>[(n(!0),d(u,null,m(c(C),(e=>(n(),_(t,{key:e.id,label:e.username,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),p(y,{label:"用户询问的问题",prop:"prompt"},{default:i((()=>[p(k,{modelValue:M.prompt,"onUpdate:modelValue":l[1]||(l[1]=e=>M.prompt=e),placeholder:"提问问题[模糊搜索]",onKeydown:f(w(q,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"])])),_:1}),p(y,null,{default:i((()=>[p(T,{type:"primary",onClick:q},{default:i((()=>[h(" 查询 ")])),_:1}),p(T,{onClick:l[2]||(l[2]=e=>{return null==(a=c(U))||a.resetFields(),void q();var a})},{default:i((()=>[h(" 重置 ")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),p(R,{bottomPadding:"20px",bottomMargin:"0px"},{default:i((()=>[g((n(),_(K,{height:"66vh",border:"",data:c(Y),style:{width:"100%"},size:"large","tooltip-options":{}},{default:i((()=>[p(S,{fixed:"",prop:"username",label:"用户名称",width:"150"}),p(S,{prop:"createdAt",label:"角色",width:"80"},{default:i((e=>[h(b("user"===e.row.role?"用户":"电脑"),1)])),_:1}),p(S,{prop:"email",label:"用户邮箱",width:"200"}),p(S,{prop:"answer",label:"用户询问/AI回复"},{default:i((e=>[p(D,{placement:"top",width:400,trigger:"click"},{reference:i((()=>[v("div",j,b("user"===e.row.role?e.row.prompt:e.row.answer),1)])),default:i((()=>[v("div",{class:"answer_container",innerHTML:c(x)("user"===e.row.role?e.row.prompt:e.row.answer||"")},null,8,A)])),_:2},1024)])),_:1}),p(S,{prop:"completionTokens",label:"提问/回答Token",width:"140",align:"center"},{default:i((e=>[h(b("user"===e.row.role?e.row.promptTokens:e.row.completionTokens),1)])),_:1}),p(S,{prop:"totalTokens",label:"总计Toekn",width:"110",align:"center"}),p(S,{prop:"model",label:"模型",width:"200"}),p(S,{prop:"createdAt",label:"提问时间",width:"200"},{default:i((e=>[h(b(c(I)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)])),_:1})])),_:1},8,["data"])),[[F,c(z)]]),p(E,{class:"flex justify-end mt-5"},{default:i((()=>[p(L,{"current-page":M.page,"onUpdate:currentPage":l[3]||(l[3]=e=>M.page=e),"page-size":M.size,"onUpdate:pageSize":l[4]||(l[4]=e=>M.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:c(V),onSizeChange:q,onCurrentChange:q},null,8,["current-page","page-size","total"])])),_:1})])),_:1})])}}});"function"==typeof z&&z(C);const U=k(C,[["__scopeId","data-v-18928d69"]]);export{U as default};
