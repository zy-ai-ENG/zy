import{v as e}from"../@vue_runtime-dom@3.2.47/@vue_runtime-dom@3.2.47.298398d5.js";import{u as t,a}from"../vue-router@4.1.6_vue@3.2.47/vue-router@4.1.6_vue@3.2.47.018c715a.js";import{u as l,_ as i,d as s,b as n,a as o,j as r,h as u}from"../main-bb4220d0.js";import{d as c,o as d,a as p,b as v,t as f,F as m,Q as y,c as x,M as g,R as b,N as k,n as h,m as C,p as w,G as S,S as _,U as D}from"../@vue_runtime-core@3.2.47/@vue_runtime-core@3.2.47.e62b9a68.js";import{J as A,n as I,o as G}from"../@vue_shared@3.2.47/@vue_shared@3.2.47.9d8e617e.js";import{x as j,r as T}from"../@vue_reactivity@3.2.47/@vue_reactivity@3.2.47.859737a0.js";import{r as E,a5 as M,Y as P,e as q,d as z,p as B,a6 as U}from"../naive-ui@2.34.3_vue@3.2.47/naive-ui@2.34.3_vue@3.2.47.d79924d9.js";const $=v("div",{style:{"background-color":"#3076ED"}},null,-1),F={class:"mb-2 text-xs text-neutral-400 font-bold"},K={class:"ml-1"},L=["onClick"],R={class:"relative flex-1 overflow-hidden break-all text-ellipsis whitespace-nowrap"},V={key:1},H={key:0,class:"absolute z-10 flex visible right-1"},N=["onClick"],W={key:0,class:"p-1"},J={key:1,class:"p-1"},Q={class:"p-1"},Y=c({__name:"ListItem",props:{dataSources:null,title:null,hideSticky:{type:Boolean}},emits:["update","delete","sticky","select"],setup(e,{emit:t}){const a=e,s=a.dataSources,n=l();const o=function(e,t){let a;return(...l)=>{clearTimeout(a),a=setTimeout((()=>{clearTimeout(a),e(...l)}),t)}}((async function(e,a){null==a||a.stopPropagation(),t("delete",e)}),600);async function r(e){const{uuid:t,title:a}=e;e.isEdit=!1,await n.updateGroupInfo({groupId:t,title:a}),await n.queryMyGroup()}function u(e){return n.active===e}return(l,c)=>{var h;return d(),p(m,null,[$,v("p",F,[f(A(a.title)+" ",1),v("span",K,"("+A(null==(h=j(s))?void 0:h.length)+")",1)]),(d(!0),p(m,null,y(j(s),(a=>(d(),p("div",{key:`${a.uuid}`},[v("a",{class:I(["bg-[#fff] dark:bg-[#171726] relative flex items-center dark:border-transparent border-gray-200 gap-3 px-3 py-2.5 break-all border rounded-md cursor-pointer hover:bg-gradient-to-l dark:to-[#54A2F5] hover:dark:text-[#2D6DD9] group",[u(a.uuid)?" dark:text-[#2D6DD9] text-[#3378ED] bg-gradient-to-l border-transparent bg-[#ebe9e9] dark:bg-[#15171A] pr-20":"dark:bg-[#1A1D21]"]]),onClick:e=>async function(e){t("select",e)}(a)},[v("span",null,[x(j(i),{icon:a.isSticky?"ri:pushpin-2-line":a.appId?"icon-park-outline:application-one":"ri:message-3-line"},null,8,["icon"])]),v("div",R,[a.isEdit?(d(),g(j(E),{key:0,value:a.title,"onUpdate:value":e=>a.title=e,size:"tiny",onKeypress:e=>async function(e,t){null==t||t.stopPropagation(),"Enter"===t.key&&r(e)}(a,e)},null,8,["value","onUpdate:value","onKeypress"])):(d(),p("span",V,A(a.title),1))]),u(a.uuid)?(d(),p("div",H,[a.isEdit?(d(),p("button",{key:0,class:"p-1",onClick:e=>{return t=a,null==(l=e)||l.stopPropagation(),void r(t);var t,l}},[x(j(i),{icon:"ri:save-line"})],8,N)):(d(),p(m,{key:1},[e.hideSticky?b("",!0):(d(),p("button",W,[x(j(i),{icon:a.isSticky?"ri:unpin-line":"ri:pushpin-line",onClick:e=>async function(e,t){null==t||t.stopPropagation(),await n.updateGroupInfo({isSticky:!e.isSticky,groupId:e.uuid}),await n.queryMyGroup()}(a,e)},null,8,["icon","onClick"])])),a.appId?b("",!0):(d(),p("button",J,[x(j(i),{icon:"ri:edit-line",onClick:e=>{return t=a,l=!0,null==(i=e)||i.stopPropagation(),void(t.isEdit=l);var t,l,i}},null,8,["onClick"])])),x(j(M),{placement:"bottom",onPositiveClick:e=>j(o)(a,e)},{trigger:k((()=>[v("button",Q,[x(j(i),{icon:"ri:delete-bin-line"})])])),default:k((()=>[f(" "+A(l.$t("chat.deleteHistoryConfirm")),1)])),_:2},1032,["onPositiveClick"])],64))])):b("",!0)],10,L)])))),128))],64)}}}),O={class:"flex flex-col gap-3 text-sm"},X={key:0,class:"flex flex-col items-center mt-4 text-center text-neutral-300"},Z={key:2,class:"flex flex-col items-center mt-4 text-center text-neutral-300"},ee={key:5,class:"flex flex-col items-center mt-4 text-center text-neutral-300"},te=c({__name:"List",emits:["autoCreate"],setup(e,{emit:r}){const{isMobile:u}=s(),c=t(),f=a(),y=n(),S=l(),_=o(),D=T(100),I=h((()=>S.groupList)),G=h((()=>S.groupKeyWord)),E=h((()=>S.activeChatTab));function M(e){const t=new Date(e).getTime()+288e5;return new Date(t).getTime()}C(I,(()=>D.value=D.value+1)),C(G,(()=>D.value=D.value+1)),h((()=>_.isLogin));const q=(new Date).setHours(0,0,0,0),z=h((()=>I.value.filter((e=>G.value?e.title.includes(G.value)&&e.isSticky:e.isSticky)))),B=h((()=>I.value.filter((e=>G.value?e.title.includes(G.value)&&!e.isSticky&&e.appId:!e.isSticky&&e.appId)))),U=h((()=>I.value.filter((e=>G.value?e.title.includes(G.value)&&!e.isSticky&&!e.appId&&M(e.createdAt)>=q:!e.isSticky&&!e.appId&&M(e.createdAt)>=q)))),$=h((()=>I.value.filter((e=>G.value?e.title.includes(G.value)&&!e.isSticky&&!e.appId&&M(e.createdAt)<q:!e.isSticky&&!e.appId&&M(e.createdAt)<q))));async function F(e){const{uuid:t}=e;(function(e){return S.active===e})(t)||(await S.setActiveGroup(t),"Chat"!==f.name&&c.push("/chat"),u.value&&y.setSiderCollapsed(!0))}async function K(e){null==event||event.stopPropagation(),await S.deleteGroup(e),await S.queryMyGroup(),u.value&&y.setSiderCollapsed(!0)}return h((()=>0===I.value.length||I.value.length>0&&0===B.value.length||I.value.length>0&&0===U.value.length)),w((()=>{S.queryMyGroup().then((()=>{I.value.length||r("autoCreate")}))})),(e,t)=>(d(),g(j(P),{class:"px-4"},{default:k((()=>[v("div",O,[j(I).length?(d(),p(m,{key:1},[j(z).length&&"app"!==j(E)?(d(),g(Y,{key:1e3+D.value,title:"置顶","data-sources":j(z),onSelect:F,onDelete:K},null,8,["data-sources"])):b("",!0),j(B).length&&"app"===j(E)?(d(),g(Y,{key:2e3+D.value,hideSticky:"",title:"应用","data-sources":j(B),onSelect:F,onDelete:K},null,8,["data-sources"])):b("",!0),j(B).length||"app"!==j(E)?b("",!0):(d(),p("div",Z,[x(j(i),{icon:"ri:inbox-line",class:"mb-2 text-3xl"}),v("span",null,A(e.$t("common.noData")),1)])),j(U).length&&"app"!==j(E)?(d(),g(Y,{key:3e3+D.value,title:"今天","data-sources":j(U),onSelect:F,onDelete:K},null,8,["data-sources"])):b("",!0),j($).length&&"app"!==j(E)?(d(),g(Y,{key:4e3+D.value,title:"其他","data-sources":j($),onSelect:F,onDelete:K},null,8,["data-sources"])):b("",!0),j(U).length||j($).length||j(z).length||"app"===j(E)?b("",!0):(d(),p("div",ee,[x(j(i),{icon:"ri:inbox-line",class:"mb-2 text-3xl"}),v("span",null,A(e.$t("common.noData")),1)]))],64)):(d(),p("div",X,[x(j(i),{icon:"ri:inbox-line",class:"mb-2 text-3xl"}),v("span",null,A(e.$t("common.noData")),1)]))])])),_:1}))}}),ae=e=>(_("data-v-24b0bd6f"),e=e(),D(),e),le={class:"flex flex-col flex-1 min-h-0"},ie={style:{"margin-top":"10px","border-radius":"10px 10px 0 0"},class:"flex h-14 items-center space-x-4 justify-between px-4 bg-[#fff] dark:bg-[#1A1D21]"},se={class:"flex-1"},ne=["loading"],oe=ae((()=>v("span",{class:"mr-0",style:{"margin-left":"2px"}},"新建对话",-1))),re={class:"bg-[#fff] dark:bg-[#1A1D21]"},ue={class:"my-2 mx-4",style:{border:"1px solid #3177ED","border-radius":"3px"}},ce={id:"sessionGroup",class:"min-h-0 pb-10 overflow-hidden bg-[#fff] dark:bg-[#1A1D21]",style:{"border-radius":"0 0 10px 10px"}},de={class:"flex justify-center border-t dark:border-gray-700 py-2 dark:bg-[#1A1D21] bg-[#fff]",style:{position:"absolute",bottom:"10px",left:"7px",width:"95%","border-radius":"10px"}},pe=ae((()=>v("span",{class:"mr-3"},"清空全部非置顶会话",-1))),ve=u(c({__name:"index",setup(t){r();const a=n(),u=l(),c=o();q();const f=T(null),m=T(null),y=z();h((()=>u.activeChatTab));const g=T(0),w=T(0),_=T(0),D=T(0),A=T(!1),I=T(null);C((()=>c.userBalance.useModel3Token),((e,t)=>{var a;g.value=t||0,w.value=e||0,null==(a=f.value)||a.play()}),{immediate:!0,flush:"post"}),C((()=>c.userBalance.useModel4Token),((e,t)=>{var a;_.value=t||0,D.value=e||0,null==(a=m.value)||a.play()}),{immediate:!0,flush:"post"});const{isMobile:M}=s(),P=T(!1),$=h((()=>a.siderCollapsed)),F=T("");function K(e){F.value=e,u.setGroupKeyWord(e)}function L(){A.value=!1}async function R(){try{0,P.value=!0,await u.updateChatTab("history"),await u.addNewChatGroup(),await u.queryMyGroup(),P.value=!1,M.value&&a.setSiderCollapsed(!0)}catch(e){P.value=!1}}async function V(){y.create({title:"清空分组",content:"是否删除所有非置顶的对话组？",positiveText:"确认删除",negativeText:"再想想",onPositiveClick:async()=>{await u.delAllGroup()}})}function H(){a.setSiderCollapsed(!$.value)}const N=h((()=>a.theme)),W=h((()=>M.value?{position:"fixed",zIndex:50,top:"56px",height:"calc(100% - 56px)"}:{background:"dark"===N.value?"#131323":"",height:"calc(100% - 60px)"})),J=h((()=>M.value?{paddingBottom:"env(safe-area-inset-bottom)"}:{})),Q=()=>{R()};return C((()=>M.value),(e=>{a.setSiderCollapsed(e)}),{immediate:!0,flush:"post"}),(t,a)=>(d(),p("div",null,[x(j(U),{collapsed:j($),"collapsed-width":0,width:300,"show-trigger":!1,"collapse-mode":"transform",bordered:!1,style:G(j(W)),onUpdateCollapsed:H},{default:k((()=>[v("div",{class:"flex h-full flex-col bg-[#f4f4f4] dark:bg-[#15171A] p-2",style:G(j(J))},[v("main",le,[v("div",ie,[v("div",se,[v("button",{class:"rounded w-full px-2.5 py-1.5 flex justify-center items-center bg-gradient-to-r from-[#3076ED] to-[#54A2F5] hover:bg-gradient-to-r text-white",loading:P.value,onClick:R},[x(j(i),{icon:"simple-line-icons:plus",class:"text-sm mr-0.5"}),oe],8,ne)])]),v("div",re,[v("div",ue,[x(j(E),{class:"search bg-[#E3E7F5] dark:bg-[#171726]",modelValue:F.value,"onUpdate:modelValue":a[0]||(a[0]=e=>F.value=e),ref_key:"searchRef",ref:I,type:"text",placeholder:"会话标题",onBlur:L,clearable:"",onInput:K},{prefix:k((()=>[x(j(i),{icon:"ion:search",class:"text-xl"})])),_:1},8,["modelValue"])])]),v("div",ce,[x(te,{onAutoCreate:Q})]),v("div",de,[x(j(B),{bordered:!1,size:"small",style:{width:"100%"},onClick:V},{default:k((()=>[x(j(i),{icon:"ant-design:delete-outlined",class:"ml-2 mr-2 text-sm"}),pe])),_:1})])])],4)])),_:1},8,["collapsed","style"]),j(M)?S((d(),p("div",{key:0,class:"fixed inset-0 z-40 bg-black/40",onClick:H},null,512)),[[e,!j($)]]):b("",!0)]))}}),[["__scopeId","data-v-24b0bd6f"]]);export{ve as R};
