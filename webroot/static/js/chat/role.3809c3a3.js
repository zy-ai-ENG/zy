import{R as e}from"../index/index.35ae69d8.js";import{u as a}from"../vue-router@4.1.6_vue@3.2.47/vue-router@4.1.6_vue@3.2.47.018c715a.js";import{_ as s,e as l,d as t,n as i,ae as r,af as o,ag as u,ah as n,b as d}from"../main-bb4220d0.js";import{d as c,o as p,a as m,b as v,c as f,n as g,p as _,N as b,t as h,F as x,Q as j,M as y,R as w}from"../@vue_runtime-core@3.2.47/@vue_runtime-core@3.2.47.e62b9a68.js";import{x as k,r as I}from"../@vue_reactivity@3.2.47/@vue_reactivity@3.2.47.859737a0.js";import{b as C}from"../@vue_runtime-dom@3.2.47/@vue_runtime-dom@3.2.47.298398d5.js";import{a as q}from"../axios@1.4.0/axios@1.4.0.5ae1da96.js";import{C as z}from"../@vicons_ionicons5@0.12.0/@vicons_ionicons5@0.12.0.5fe57882.js";import{e as D,r as R,p as A,E as M,a5 as U,A as P,t as F,s as N,P as L,Q as V,X as Q,n as T,C as B,a1 as E,a2 as J}from"../naive-ui@2.34.3_vue@3.2.47/naive-ui@2.34.3_vue@3.2.47.d79924d9.js";import{J as O,n as W}from"../@vue_shared@3.2.47/@vue_shared@3.2.47.9d8e617e.js";import"../v-viewer@3.0.11_vue@3.2.47/v-viewer@3.0.11_vue@3.2.47.a81e5850.js";import"../viewerjs@1.11.3/viewerjs@1.11.3.a76d4126.js";import"../clientjs@0.2.1/clientjs@0.2.1.7f53d864.js";import"../@babel_runtime@7.21.5/@babel_runtime@7.21.5.35f69bd2.js";import"../crypto-js@4.1.1/crypto-js@4.1.1.7142fa56.js";import"../@iconify_vue@4.1.1_vue@3.2.47/@iconify_vue@4.1.1_vue@3.2.47.612da1cd.js";import"../pinia@2.0.35_typescript@4.9.5_vue@3.2.47/pinia@2.0.35_typescript@4.9.5_vue@3.2.47.1425f1b3.js";import"../vue-demi@0.14.7_vue@3.2.47/vue-demi@0.14.7_vue@3.2.47.71ba0ef2.js";import"../vue-i18n@9.2.2_vue@3.2.47/vue-i18n@9.2.2_vue@3.2.47.f7da0a53.js";import"../@intlify_shared@9.2.2/@intlify_shared@9.2.2.76c1dc14.js";import"../@intlify_core-base@9.2.2/@intlify_core-base@9.2.2.72ca16dd.js";import"../@intlify_message-compiler@9.2.2/@intlify_message-compiler@9.2.2.9b2b247d.js";import"../@intlify_devtools-if@9.2.2/@intlify_devtools-if@9.2.2.1be0989c.js";import"../vooks@0.2.12_vue@3.2.47/vooks@0.2.12_vue@3.2.47.89d56bd5.js";import"../evtd@0.2.4/evtd@0.2.4.2789e4a1.js";import"../katex@0.16.7/katex@0.16.7.43835b5c.js";import"../@vueuse_core@9.13.0_vue@3.2.47/@vueuse_core@9.13.0_vue@3.2.47.770e5818.js";import"../@vueuse_shared@9.13.0_vue@3.2.47/@vueuse_shared@9.13.0_vue@3.2.47.58cbe97f.js";import"../mitt@3.0.1/mitt@3.0.1.f0e54764.js";import"../marked@4.3.0/marked@4.3.0.cb1ff4ec.js";import"../date-fns@2.30.0/date-fns@2.30.0.bcce45e8.js";import"../vue-clipboard3@2.0.0/vue-clipboard3@2.0.0.ebf9d56c.js";import"../clipboard@2.0.11/clipboard@2.0.11.6a7b8915.js";import"../@vueuse_integrations@10.2.0_axios@1.4.0_qrcode@1.5.3_vue@3.2.47/@vueuse_integrations@10.2.0_axios@1.4.0_qrcode@1.5.3_vue@3.2.47.a70167c7.js";import"../@vueuse_shared@10.2.0_vue@3.2.47/@vueuse_shared@10.2.0_vue@3.2.47.3d57d69b.js";import"../qrcode@1.5.3/qrcode@1.5.3.ae99ec0a.js";import"../encode-utf8@1.0.3/encode-utf8@1.0.3.2ec93547.js";import"../dijkstrajs@1.0.3/dijkstrajs@1.0.3.38d0b2a1.js";import"../seemly@0.3.6/seemly@0.3.6.21da59ee.js";import"../vueuc@0.4.51_vue@3.2.47/vueuc@0.4.51_vue@3.2.47.ce1cbfa6.js";import"../@css-render_vue3-ssr@0.15.12_vue@3.2.47/@css-render_vue3-ssr@0.15.12_vue@3.2.47.e49104bd.js";import"../vdirs@0.1.8_vue@3.2.47/vdirs@0.1.8_vue@3.2.47.bf970686.js";import"../@juggle_resize-observer@3.4.0/@juggle_resize-observer@3.4.0.80d14552.js";import"../css-render@0.15.12/css-render@0.15.12.af3f05a4.js";import"../@emotion_hash@0.8.0/@emotion_hash@0.8.0.b17c1a96.js";import"../lodash-es@4.17.21/lodash-es@4.17.21.6a776102.js";import"../treemate@0.3.11/treemate@0.3.11.05d63ee5.js";import"../async-validator@4.2.5/async-validator@4.2.5.8d480e59.js";import"../@css-render_plugin-bem@0.15.12_css-render@0.15.12/@css-render_plugin-bem@0.15.12_css-render@0.15.12.0c2c3e5c.js";const X={class:"m-auto flex h-14 max-w-screen-2xl items-center justify-between px-4"},$={class:"flex min-w-0 flex-1 items-center space-x-2 overflow-hidden pr-2"},G=v("h2",{class:"text-base font-bold"}," 我的自定义工作台 ",-1),H=v("div",{class:"flex items-center space-x-2"},null,-1),K=c({__name:"header",setup(e){const l=a();return(e,a)=>(p(),m("div",X,[v("div",$,[v("button",{onClick:a[0]||(a[0]=e=>k(l).go(-1))},[f(k(s),{class:"text-xl",icon:"ri:arrow-left-s-line"})]),G]),H]))}}),S={class:"w-full flex justify-center"},Y={class:"p-6 max-w-screen-2xl px-4 w-full"},Z={class:"flex flex-col space-y-3 justify-between sm:flex-row sm:space-y-0"},ee={class:"sm:w-full md:w-[300px] sm:mb-3 2xl:w-[380px]"},ae={class:"mt-10 grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 2xl:grid-cols-4 gap-5"},se=["onClick"],le={class:"w-full h-16 flex items-center mb-3"},te={class:"w-14 h-14 flex justify-center items-center rounded-md shadow-md mr-5 border border-[#00000014]"},ie=["src"],re={class:"text-base font-bold mb-1 text-base text-[#333] dark:text-[#ffffff85]"},oe={class:"w-full text-[#999999] text-xs min-h-[40px]"},ue={class:"w-full flex justify-between mt-3"},ne={class:"p-5 bg-white rounded dark:bg-slate-800"},de={class:"font-bold text-base"},ce={class:"pt-5 mt-6"},pe=v("p",null,"Tips: 请知悉 ",-1),me=v("p",null,"选择共享提交之后审核状态将无法编辑应用",-1),ve=v("p",null,"审核通过的应用将会在应用广场公开展示",-1),fe=v("p",null,"管理审核通过后将会赠送一定的站内额度奖励用户",-1),ge=v("p",null,"一旦提交处于审核中、您将不能再编辑此应用",-1),_e=c({__name:"main",setup(e){const d=l(),c=I(""),E=I(!1),J=I(!1),W=I([]),X=I(null),$=I(0),G=I(!1),H=g((()=>0===$.value?"创建我的个人应用":"更新我的个人应用")),K=g((()=>0===$.value?"创建专属应用":"更新个人应用")),_e=g((()=>c.value?d.mineApps.filter((e=>e.appName.includes(c.value))):d.mineApps)),be=I("/api/upload/file"),he=I({catId:null,name:null,preset:null,des:null,demoData:"",coverImg:"",public:!1}),xe={catId:[{required:!0,message:"请选择分类"}],name:[{required:!0,message:"请输入应用名称",trigger:"blur"},{min:2,max:30,message:"长度应为2到10个字符之间",trigger:"blur"}],preset:[{required:!0,message:"请输入预设prompt",trigger:"blur"},{min:6,max:1200,message:"长度应为6到1200个字符之间",trigger:"blur"}],des:[{required:!0,message:"请输入简短的应用描述",trigger:"blur"},{max:50,message:"长度应为0到50个字符之间",trigger:"blur"}],demoData:[{required:!0,message:"请输入示例数据、按回车换行表示新增一条",trigger:"blur"},{max:100,message:"长度应为0到100个字符之间",trigger:"blur"}],coverImg:[{required:!0,message:"请上传应用Logo",trigger:"change"}],public:[{required:!0,message:"请选择是否公开"}]};t();const je=D(),ye=a(),we=I([]),ke=I(null);function Ie(e){c.value=e}async function Ce(){const e=await u();we.value=e.data.rows}async function qe(e){if(e.length){const a=e[0].file;ke.value=a;const s=new FormData;s.append("file",a);const l=await q.post(be.value,s,{headers:{"Content-Type":"multipart/form-data"}});l.data.data?he.value.coverImg=l.data.data:je.error("上传图片失败、请检查后再试试吧！")}else ke.value=null}function ze({file:e,fileList:a}){return new Promise(((a,s)=>{const{size:l,type:t}=e.file;return"image/png"!==t&&"image/jpg"!==t&&"image/jpeg"!==t?(je.error("只能上传png/jpg/jpeg格式的图片"),a(!1)):l>307200?(je.error("图片大小不能超过300k"),a(!1)):void a(!0)}))}function De(){J.value=!0,Ce()}function Re(){}function Ae(){Me()}function Me(){$.value=0,G.value=!1,he.value={catId:null,name:null,preset:null,des:null,demoData:"",coverImg:"",public:!1}}function Ue(){var e;null==(e=X.value)||e.validate((async e=>{if(!e){const e=he.value;$.value&&(e.appId=$.value);const a=await r(e),s=$.value?"个人应用修改完成！":"个人应用创建完成！";a.success&&je.success(s),d.queryMineApps(),Me(),J.value=!1}}))}return _((()=>{!_e.value.length&&d.queryMineApps()})),(e,a)=>(p(),m(x,null,[v("div",S,[v("div",Y,[v("div",Z,[v("div",ee,[f(k(R),{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=e=>c.value=e),type:"text",placeholder:`您一共收录了${k(_e).length}个应用(关键词过滤)`,onInput:Ie},null,8,["modelValue","placeholder"])]),f(k(M),null,{default:b((()=>[f(k(A),{onClick:De},{icon:b((()=>[f(k(s),{icon:"gridicons:create"})])),default:b((()=>[h(" 创建自定义应用 ")])),_:1}),f(k(A),{type:"primary",onClick:a[1]||(a[1]=e=>k(ye).push("/app-store"))},{icon:b((()=>[f(k(s),{icon:"ri:add-line"})])),default:b((()=>[h(" 前往广场添加应用 ")])),_:1})])),_:1})]),v("div",ae,[(p(!0),m(x,null,j(k(_e),(e=>(p(),m("div",{key:e.id,class:"card relative custom-card cursor-pointer border border-[#e0e0e0] dark:border-neutral-800 p-4 pt-2 border rounded-md flex flex-col justify-center items-center hover:bg-neutral-100 dark:hover:bg-[#24272e] select-none",onClick:a=>async function(e){const a=await i(),{modelMaps:s}=a.data;if(!s[1])return je.warning("管理员未配置特定应用模型、请联系管理员配置~");ye.push({path:"/chat",query:{appId:e.appId}})}(e)},[v("div",le,[v("span",te,[v("img",{src:e.coverImg,class:"w-8 h-8 mb-1",alt:""},null,8,ie)]),v("span",re,O(e.appName),1)]),v("p",oe,O(e.appDes),1),v("div",ue,["system"===e.appRole||e.public?(p(),y(k(U),{key:0,placement:"bottom",onPositiveClick:C((a=>async function(e){e.loading=!0;try{const a=await o({appId:e.appId});je.success(a.data),await d.queryMineApps(),e.loading=!1}catch(a){e.loading=!1}}(e)),["stop"])},{trigger:b((()=>[f(k(A),{size:"tiny",ghost:"",loading:e.loading,onClick:a[2]||(a[2]=C((()=>{}),["stop"]))},{icon:b((()=>[f(k(s),{icon:"clarity:favorite-line",class:"text-base"})])),default:b((()=>[h(" 取消收藏 ")])),_:2},1032,["loading"])])),default:b((()=>[h(" 确认取消收藏该应用吗？ ")])),_:2},1032,["onPositiveClick"])):w("",!0),f(k(M),null,{default:b((()=>["user"!==e.appRole||e.public?w("",!0):(p(),y(k(U),{key:0,placement:"bottom",onPositiveClick:C((a=>async function(e){const a=await n({id:e.appId});je.success(a.data),d.queryMineApps()}(e)),["stop"])},{trigger:b((()=>[f(k(A),{size:"tiny",ghost:"",loading:e.loading,onClick:a[3]||(a[3]=C((()=>{}),["stop"]))},{icon:b((()=>[f(k(s),{icon:"mdi-light:delete",class:"text-base"})])),default:b((()=>[h(" 删除应用 ")])),_:2},1032,["loading"])])),default:b((()=>[h(" 确认移除创建的应用吗？ ")])),_:2},1032,["onPositiveClick"])),"user"!==e.appRole||e.public?w("",!0):(p(),y(k(A),{key:1,size:"tiny",ghost:"",loading:e.loading,onClick:C((a=>async function(e){await Ce();const{catId:a,appName:s,preset:l,appDes:t,demoData:i,coverImg:r,public:o}=e;Object.assign(he.value,{catId:a,name:s,preset:l,des:t,demoData:i,coverImg:r,public:o}),$.value=e.appId,J.value=!0,G.value=e.public}(e)),["stop"])},{icon:b((()=>[f(k(s),{icon:"mdi-light:delete",class:"text-base"})])),default:b((()=>[h(" 编辑应用 ")])),_:2},1032,["loading","onClick"]))])),_:2},1024)]),f(k(s),{icon:"codicon:run-all",class:"run-icon text-xl text-[#5A91FC] absolute right-3 bottom-3"}),3===e.status?(p(),y(k(s),{key:0,icon:"icon-park-twotone:mark",class:"text-xl text-[#5A91FC] absolute right-3 top-3"})):w("",!0)],8,se)))),128))])])]),f(k(B),{show:J.value,title:"创建",style:{width:"90%","max-width":"640px"},"mask-closable":!1,"on-after-enter":Re,"on-after-leave":Ae},{default:b((()=>[v("div",ne,[v("div",{class:"absolute top-4 left-5 cursor-pointer z-30",onClick:a[4]||(a[4]=e=>J.value=!1)},[v("span",de,O(k(K)),1)]),v("div",{class:"absolute top-3 right-3 cursor-pointer z-30",onClick:a[5]||(a[5]=e=>J.value=!1)},[f(k(P),{size:"20",color:"#0e7a0d"},{default:b((()=>[f(k(z))])),_:1})]),v("div",ce,[f(k(F),{ref_key:"formRef",ref:X,model:he.value,rules:xe,"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging",style:{maxWidth:"640px"}},{default:b((()=>[f(k(N),{label:"应用分类",path:"catId"},{default:b((()=>[f(k(L),{value:he.value.catId,"onUpdate:value":a[6]||(a[6]=e=>he.value.catId=e),clearable:"",size:"small","label-field":"name",placeholder:"请输入您的应用分类","value-field":"id",options:we.value},null,8,["value","options"])])),_:1}),f(k(N),{label:"应用名称",path:"name"},{default:b((()=>[f(k(R),{value:he.value.name,"onUpdate:value":a[7]||(a[7]=e=>he.value.name=e),placeholder:"请输入您的应用名称",type:"name",maxlength:30,"show-name-on":"click",tabindex:"0"},null,8,["value"])])),_:1}),f(k(N),{label:"预设指令",path:"preset"},{default:b((()=>[f(k(R),{value:he.value.preset,"onUpdate:value":a[8]||(a[8]=e=>he.value.preset=e),max:255,autosize:{minRows:3,maxRows:10},type:"textarea",placeholder:"请填写prompt预设指令（核心）"},null,8,["value"])])),_:1}),f(k(N),{label:"应用描述",path:"des"},{default:b((()=>[f(k(R),{value:he.value.des,"onUpdate:value":a[9]||(a[9]=e=>he.value.des=e),autosize:{minRows:3,maxRows:10},type:"textarea",placeholder:"请对你的应用做以简要的描述以便于大家认识它！"},null,8,["value"])])),_:1}),f(k(N),{label:"示例内容",path:"demoData"},{default:b((()=>[f(k(R),{value:he.value.demoData,"onUpdate:value":a[10]||(a[10]=e=>he.value.demoData=e),autosize:{minRows:3,maxRows:10},type:"textarea",placeholder:"请填写一个示例、方便快速告诉别人如何使用、每点击回车换行一次则是新增一条示例！"},null,8,["value"])])),_:1}),f(k(N),{label:"应用Logo",path:"coverImg"},{default:b((()=>[f(k(V),{"on-update:file-list":qe,"on-before-upload":ze,max:1,"default-upload":!1,action:be.value,"default-file-list":W.value,"list-type":"image-card"},{default:b((()=>[h(" 点击上传 ")])),_:1},8,["action","default-file-list"])])),_:1}),f(k(N),{label:"是否共享",path:"public"},{default:b((()=>[f(k(Q),{value:he.value.public,"onUpdate:value":a[11]||(a[11]=e=>he.value.public=e),disabled:G.value},null,8,["value","disabled"]),f(k(T),{placement:"top-start",trigger:"hover"},{trigger:b((()=>[f(k(s),{icon:"ri:error-warning-line",class:"text-base ml-3 cursor-pointer"})])),default:b((()=>[pe,me,ve,fe,ge])),_:1})])),_:1}),f(k(N),{class:"mt-3"},{default:b((()=>[f(k(A),{block:"",type:"primary",disabled:E.value,loading:E.value,onClick:Ue},{default:b((()=>[h(O(k(H)),1)])),_:1},8,["disabled","loading"])])),_:1})])),_:1},8,["model"])])])])),_:1},8,["show"])],64))}}),be={class:"flex h-full w-full flex-col bg-white dark:bg-[#111114]"},he={class:"sticky left-0 right-0 top-0 z-40 border-b bg-white dark:border-b-neutral-800 dark:bg-[#111114]"},xe=c({__name:"index",setup:e=>(e,a)=>(p(),m("div",be,[v("header",he,[f(K)]),f(_e)]))}),je={class:"h-full dark:bg-[#131323] transition-all"},ye=c({__name:"role",setup(a){const s=d(),{isMobile:l}=t();g((()=>s.siderCollapsed));const i=g((()=>l.value?["rounded-none","shadow-none"]:["rounded-md","shadow-md","dark:border-neutral-800"])),r=g((()=>["h-full"]));return(a,s)=>(p(),m("div",je,[v("div",{class:W(["h-full overflow-hidden",k(i)])},[f(k(J),{class:W(["z-40 transition",k(r)]),"has-sider":""},{default:b((()=>[f(k(E),{class:"h-full"},{default:b((()=>[f(xe)])),_:1}),f(e)])),_:1},8,["class"])],2)]))}});export{ye as default};
