import{_ as e,a as l,b as t,c as a}from"../end/end.08128031.js";import{S as i}from"../index/index.23ae4c01.js";import{d as o,u as s,v as n,e as c,c as r,g as d,y as u,i as p,h as v,k as m,l as x,j as g,n as f,F as k,r as y,$ as h,m as b,o as C,aB as I,_ as B,M as N,C as F,D as E,aF as w,E as A}from"../main-c6e244ef.js";import{q as T,c as U,a as j,m as L,b as _,d as O}from"./music.51f40153.js";const S=e=>(F("data-v-e76ab1fb"),e=e(),E(),e),D={class:"bg-[#f4f4f4] dark:bg-[#020104] musicBody"},R={class:"mainBox"},q={key:0,class:"videoBox"},z={style:{width:"504px",height:"756px","border-radius":"8px",position:"relative"},class:"bg-[#E5EDFE] dark:bg-[#0A182F]"},G=["src"],H={class:"control"},M={class:"musicSquareTitle bg-[#fff] dark:bg-[#15171A] border-[1px] border-b dark:border-[#020104] border-[transparent]"},$=S((()=>g("div",{style:{"margin-left":"4px"}},"音乐广场",-1))),J={style:{height:"87vh","border-radius":"0 0 12px 12px"},class:"bg-[#fff] dark:bg-[#15171A]"},K={class:"contentBox bg-[#fff] dark:bg-[#15171A]"},P={class:"tabBox"},Q=["onClick"],V={class:"itemTop bg-[#F5F8FE] dark:bg-[#0A182F]"},W=["src"],X={class:"topTitle"},Y={class:"title"},Z={class:"intro"},ee={key:0,class:"itemBottomDark"},le={class:"iconBox"},te={style:{"margin-left":"4px"}},ae={class:"iconBox"},ie={style:{"margin-left":"4px"}},oe={class:"iconBox",style:{position:"relative"}},se={key:0,class:"operationBox bg-[#fff] dark:bg-[#15171A]"},ne=["onClick"],ce=S((()=>g("div",null,"下载视频",-1))),re=["onClick"],de=S((()=>g("div",null,"下载音频",-1))),ue={key:1,class:"itemBottomLight"},pe={class:"iconBox"},ve={style:{"margin-left":"4px"}},me={class:"iconBox"},xe={style:{"margin-left":"4px"}},ge={class:"iconBox",style:{position:"relative"}},fe={key:0,class:"operationBox bg-[#fff] dark:bg-[#15171A]"},ke={class:"operationItem",style:{display:"flex"}},ye=S((()=>g("div",null,"下载视频",-1))),he={class:"operationItem",style:{display:"flex"}},be=S((()=>g("div",null,"下载音频",-1))),Ce={class:"end text-[#A3A5A6] dark:text-[#76777A]"},Ie=["href"],Be=["href"],Ne=A(o({__name:"musicSquare",setup(o){const F=s();let E=null;n();const A=c(),S=r((()=>"dark"===A.theme)),{isMobile:Ne}=d(),Fe=u([{name:"最新歌曲",key:0},{name:"流行趋势",key:1}]),Ee=u(0),we=u(1),Ae=u(),Te=u(""),Ue=u([]);De(),T({modelType:"music"}).then((e=>{0!=e.data.length?localStorage.setItem("musicGroupId",e.data[0].id):0==e.data.length&&U({modelType:"music"}).then((e=>{localStorage.setItem("musicGroupId",e.data.id)}))}));const je=u(""),Le=u(""),_e=u(""),Oe=u(""),Se=u("");function De(e){E||(E=F.loading("数据加载中",{duration:0}));let l={};l=e?{size:30,page:we.value,order:e}:{size:30,page:we.value},console.log(l),L(l).then((e=>{Ae.value=e.data.count;const{records:l}=e.data;let t=l.filter((e=>e.text)).filter((e=>-1!=e.text.indexOf("http")&&-1!=e.text.indexOf("Chorus")));for(let a=0;a<t.length;a++){let e=t[a].text.split("🎵")[1].split("\n")[0],l=t[a].text.split("🎵")[1].split("[Chorus]")[1].split("[")[0];-1!=l.indexOf("mv")&&(l=l.split("mv")[0]);let i=t[a].text.split("🎵").pop().split("!")[1];t[a].image=i.split("](")[1].split(")")[0],t[a].mp3=i.split("](")[2].split(")")[0],t[a].mp4=i.split("](")[3].split(")")[0],t[a].title=e,t[a].intro=l,t[a].operation=!1}Ue.value=[...Ue.value,...t],Pe(),console.log(Ue.value)}))}j({keys:["copyrightTitle","icpNumber","policeFilingNumber","icpUrl","policeFilingUrl"]}).then((e=>{je.value=e.data.copyrightTitle,Le.value=e.data.icpNumber,_e.value=e.data.policeFilingNumber,Oe.value=e.data.icpUrl,Se.value=e.data.policeFilingUrl}));const Re=u(1);function qe(e){let l={chatLogId:e.chatId,action:"agree",type:"music"};0!=Re.value&&(Re.value=0,O(l).then((l=>{e.agree?Ue.value.forEach((l=>{l.chatId==e.chatId&&(l.agree=null,l.agreeNum--)})):Ue.value.forEach((l=>{l.chatId==e.chatId&&(l.agree="agree",l.agreeNum++)})),Re.value=1})))}const ze=u(""),Ge=u(!0);function He(){const e=document.getElementById("video");Ge.value?(Ge.value=!1,e.pause()):(Ge.value=!0,e.play())}function Me(e){ze.value=e.mp4;let l={recoredId:e.chatId};e.playNum++,_(l).then((e=>{console.log(e)}))}function $e(e){let l=[];Ue.value.forEach((e=>{l=[...l,e.mp4]}));let t=l.indexOf(ze.value);if(0==e){if(0==t)return;t--,ze.value=l[t]}else if(1==e){if(t==l.length-1)return;t++,ze.value=l[t]}console.log(t)}const Je=u(!1);function Ke(e){e.operation=!0,Je.value=!0}function Pe(){E&&(E.destroy(),E=null)}function Qe(e,l){let t="/api";if(E||(E=F.loading("下载中，请稍等",{duration:0})),"mp4"==l){Ve();let l=e.mp4.split("/").pop();w.get(t+"/proxy/down",{responseType:"blob",params:{url:e.mp4}}).then((e=>{const t=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=t,a.setAttribute("download",l),a.click(),Pe(),F.success("下载成功")}))}else if("mp3"==l){Ve();let l=e.mp3.split("/").pop();w.get(t+"/proxy/down",{responseType:"blob",params:{url:e.mp3}}).then((e=>{const t=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=t,a.setAttribute("download",l),a.click(),Pe(),F.success("下载成功")}))}}function Ve(){Je.value=!1,Ue.value.forEach((e=>{e.operation=!1}))}const We=u(null);function Xe(){const e=We.value;if(e.scrollTop+e.clientHeight+1>=e.scrollHeight){if(30*we.value>=Ae.value)return void F.error("没有更多数据了");we.value++,Te.value?De(Te.value):De()}}return(o,s)=>(C(),p("div",D,[v(Ne)?x("",!0):(C(),m(i,{key:0,sideType:1})),Je.value?(C(),p("div",{key:1,class:"mask",onClick:Ve})):x("",!0),g("div",R,[ze.value?(C(),p("div",q,[g("div",z,[f(I)]),g("video",{class:"video",autoplay:"",id:"video",loop:"",src:ze.value},null,8,G),f(v(B),{icon:"icon-park-solid:close-one",class:"text-xl text-[#fff] text-center icon",onClick:s[0]||(s[0]=e=>ze.value="")}),g("div",H,[g("img",{class:"controlItem",style:{cursor:"pointer"},src:e,alt:"",onClick:s[1]||(s[1]=e=>$e(0))}),Ge.value?(C(),p("img",{key:0,class:"controlItem",src:l,style:{margin:"0 50px",cursor:"pointer"},alt:"",onClick:He})):x("",!0),Ge.value?x("",!0):(C(),p("img",{key:1,class:"controlItem",src:t,style:{margin:"0 50px",cursor:"pointer"},alt:"",onClick:He})),g("img",{class:"controlItem",style:{cursor:"pointer"},src:a,alt:"",onClick:s[2]||(s[2]=e=>$e(1))})])])):x("",!0),g("div",M,[f(v(B),{icon:"akar-icons:music-album",class:"text-xl text-center"}),$]),g("div",J,[g("div",K,[g("div",P,[(C(!0),p(k,null,y(Fe.value,((e,l)=>(C(),p("div",{class:N([Ee.value==l?"bg-[#3378ED] text-[#fff]":"bg-[#F4F4F4] dark:bg-[#010102]","tabItem"]),onClick:e=>{return t=l,Ee.value=t,we.value=1,0==t?Te.value="":1==t&&(Te.value="agreeNum"),void De(Te.value);var t},key:e.key},b(e.name),11,Q)))),128))]),g("div",{class:"content",ref_key:"container",ref:We,onScroll:Xe},[(C(!0),p(k,null,y(Ue.value,(e=>(C(),p("div",{class:"contentItem",key:e.chatId},[g("div",V,[g("img",{class:"topImg",src:e.image,alt:""},null,8,W),g("div",X,[g("div",Y,b(""==e.title?"匿名":e.title),1),g("div",Z,b(e.intro),1)])]),S.value?(C(),p("div",ee,[g("div",le,[f(v(B),{icon:"gridicons:play",class:"text-xl text-center icon",onClick:l=>Me(e)},null,8,["onClick"]),g("div",te,b(e.playNum?e.playNum:0),1)]),g("div",ae,["agree"==e.agree?(C(),m(v(B),{key:0,icon:"iconamoon:like-fill",class:"text-xl text-center icon",onClick:l=>qe(e)},null,8,["onClick"])):(C(),m(v(B),{key:1,icon:"iconamoon:like-light",class:"text-xl text-center icon",onClick:l=>qe(e)},null,8,["onClick"])),g("div",ie,b(e.agreeNum?e.agreeNum:0),1)]),g("div",oe,[f(v(B),{icon:"ri:more-line",class:"text-xl text-center icon",onClick:l=>Ke(e)},null,8,["onClick"]),e.operation?(C(),p("div",se,[g("div",{class:"operationItem",style:{display:"flex"},onClick:l=>Qe(e,"mp4")},[f(v(B),{icon:"gravity-ui:video",style:{"margin-right":"5px"},class:"text-xl text-center"}),ce],8,ne),g("div",{class:"operationItem",style:{display:"flex"},onClick:l=>Qe(e,"mp3")},[f(v(B),{icon:"fluent:headphones-sound-wave-24-filled",style:{"margin-right":"5px"},class:"text-xl text-center"}),de],8,re)])):x("",!0)])])):(C(),p("div",ue,[g("div",pe,[f(v(B),{icon:"gridicons:play",class:"text-xl text-center icon",onClick:l=>Me(e)},null,8,["onClick"]),g("div",ve,b(e.playNum?e.playNum:0),1)]),g("div",me,[e.agree?(C(),m(v(B),{key:0,icon:"iconamoon:like-fill",class:"text-xl text-center icon",onClick:l=>qe(e)},null,8,["onClick"])):(C(),m(v(B),{key:1,icon:"iconamoon:like-light",class:"text-xl text-center icon",onClick:l=>qe(e)},null,8,["onClick"])),g("div",xe,b(e.agreeNum?e.agreeNum:0),1)]),g("div",ge,[f(v(B),{icon:"ri:more-line",class:"text-xl text-center icon",onClick:l=>Ke(e)},null,8,["onClick"]),e.operation?(C(),p("div",fe,[g("div",ke,[f(v(B),{icon:"gravity-ui:video",style:{"margin-right":"5px"},class:"text-xl text-center"}),ye]),g("div",he,[f(v(B),{icon:"fluent:headphones-sound-wave-24-filled",style:{"margin-right":"5px"},class:"text-xl text-center"}),be])])):x("",!0)])]))])))),128))],544)]),g("div",Ce,[h("版权所有 © "+b(je.value)+" ",1),g("a",{href:Oe.value||"#"},[g("a",{href:Se.value||"#"},b(_e.value),9,Be),h(b(Le.value),1)],8,Ie)])])])]))}}),[["__scopeId","data-v-e76ab1fb"]]);export{Ne as default};
