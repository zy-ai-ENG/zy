import{q as e,c as t,a as i,m as s,_ as o,b as l,d as a,e as r,f as n,g as c}from"./music.7fff5f83.js";import{S as u}from"../index/index.bf6210d7.js";import{b as d,d as m,L as p,_ as v,h as f}from"../main-bb4220d0.js";import{u as x}from"../vue-router@4.1.6_vue@3.2.47/vue-router@4.1.6_vue@3.2.47.018c715a.js";import{a as g}from"../axios@1.4.0/axios@1.4.0.5ae1da96.js";import{d as y,n as _,a as k,M as h,R as j,b,c as C,F as I,Q as B,t as w,S as N,U as A,o as E}from"../@vue_runtime-core@3.2.47/@vue_runtime-core@3.2.47.e62b9a68.js";import{e as F}from"../naive-ui@2.34.3_vue@3.2.47/naive-ui@2.34.3_vue@3.2.47.d79924d9.js";import{r as T,x as q}from"../@vue_reactivity@3.2.47/@vue_reactivity@3.2.47.859737a0.js";import{J as U,n as L}from"../@vue_shared@3.2.47/@vue_shared@3.2.47.9d8e617e.js";import"../@vue_runtime-dom@3.2.47/@vue_runtime-dom@3.2.47.298398d5.js";import"../v-viewer@3.0.11_vue@3.2.47/v-viewer@3.0.11_vue@3.2.47.a81e5850.js";import"../viewerjs@1.11.3/viewerjs@1.11.3.a76d4126.js";import"../clientjs@0.2.1/clientjs@0.2.1.7f53d864.js";import"../@babel_runtime@7.21.5/@babel_runtime@7.21.5.35f69bd2.js";import"../crypto-js@4.1.1/crypto-js@4.1.1.7142fa56.js";import"../@iconify_vue@4.1.1_vue@3.2.47/@iconify_vue@4.1.1_vue@3.2.47.612da1cd.js";import"../pinia@2.0.35_typescript@4.9.5_vue@3.2.47/pinia@2.0.35_typescript@4.9.5_vue@3.2.47.1425f1b3.js";import"../vue-demi@0.14.7_vue@3.2.47/vue-demi@0.14.7_vue@3.2.47.71ba0ef2.js";import"../vue-i18n@9.2.2_vue@3.2.47/vue-i18n@9.2.2_vue@3.2.47.f7da0a53.js";import"../@intlify_shared@9.2.2/@intlify_shared@9.2.2.76c1dc14.js";import"../@intlify_core-base@9.2.2/@intlify_core-base@9.2.2.72ca16dd.js";import"../@intlify_message-compiler@9.2.2/@intlify_message-compiler@9.2.2.9b2b247d.js";import"../@intlify_devtools-if@9.2.2/@intlify_devtools-if@9.2.2.1be0989c.js";import"../vooks@0.2.12_vue@3.2.47/vooks@0.2.12_vue@3.2.47.89d56bd5.js";import"../evtd@0.2.4/evtd@0.2.4.2789e4a1.js";import"../katex@0.16.7/katex@0.16.7.43835b5c.js";import"../@vueuse_core@9.13.0_vue@3.2.47/@vueuse_core@9.13.0_vue@3.2.47.770e5818.js";import"../@vueuse_shared@9.13.0_vue@3.2.47/@vueuse_shared@9.13.0_vue@3.2.47.58cbe97f.js";import"../mitt@3.0.1/mitt@3.0.1.f0e54764.js";import"../@vicons_ionicons5@0.12.0/@vicons_ionicons5@0.12.0.5fe57882.js";import"../marked@4.3.0/marked@4.3.0.cb1ff4ec.js";import"../date-fns@2.30.0/date-fns@2.30.0.bcce45e8.js";import"../vue-clipboard3@2.0.0/vue-clipboard3@2.0.0.ebf9d56c.js";import"../clipboard@2.0.11/clipboard@2.0.11.6a7b8915.js";import"../@vueuse_integrations@10.2.0_axios@1.4.0_qrcode@1.5.3_vue@3.2.47/@vueuse_integrations@10.2.0_axios@1.4.0_qrcode@1.5.3_vue@3.2.47.a70167c7.js";import"../@vueuse_shared@10.2.0_vue@3.2.47/@vueuse_shared@10.2.0_vue@3.2.47.3d57d69b.js";import"../qrcode@1.5.3/qrcode@1.5.3.ae99ec0a.js";import"../encode-utf8@1.0.3/encode-utf8@1.0.3.2ec93547.js";import"../dijkstrajs@1.0.3/dijkstrajs@1.0.3.38d0b2a1.js";import"../seemly@0.3.6/seemly@0.3.6.21da59ee.js";import"../vueuc@0.4.51_vue@3.2.47/vueuc@0.4.51_vue@3.2.47.ce1cbfa6.js";import"../@css-render_vue3-ssr@0.15.12_vue@3.2.47/@css-render_vue3-ssr@0.15.12_vue@3.2.47.e49104bd.js";import"../vdirs@0.1.8_vue@3.2.47/vdirs@0.1.8_vue@3.2.47.bf970686.js";import"../@juggle_resize-observer@3.4.0/@juggle_resize-observer@3.4.0.80d14552.js";import"../css-render@0.15.12/css-render@0.15.12.af3f05a4.js";import"../@emotion_hash@0.8.0/@emotion_hash@0.8.0.b17c1a96.js";import"../lodash-es@4.17.21/lodash-es@4.17.21.6a776102.js";import"../treemate@0.3.11/treemate@0.3.11.05d63ee5.js";import"../async-validator@4.2.5/async-validator@4.2.5.8d480e59.js";import"../@css-render_plugin-bem@0.15.12_css-render@0.15.12/@css-render_plugin-bem@0.15.12_css-render@0.15.12.0c2c3e5c.js";const O=e=>(N("data-v-2089b1ff"),e=e(),A(),e),S={class:"bg-[#f4f4f4] dark:bg-[#020104] musicBody"},z={class:"mainBox"},R={key:0,class:"videoBox"},D={style:{width:"504px",height:"756px","border-radius":"8px",position:"relative"},class:"bg-[#E5EDFE] dark:bg-[#0A182F]"},G=["src"],M={class:"control"},J={class:"musicSquareTitle bg-[#fff] dark:bg-[#15171A] border-[1px] border-b dark:border-[#020104] border-[transparent]"},Q=O((()=>b("div",{style:{"margin-left":"4px"}},"音乐广场",-1))),H={class:"contentBox bg-[#fff] dark:bg-[#15171A]"},K={class:"tabBox"},P=["onClick"],V={class:"content"},W={class:"itemTop bg-[#fff] dark:bg-[#0A182F]"},X=["src"],Y={class:"topTitle"},Z={class:"title"},$={class:"intro"},ee={key:0,class:"itemBottomDark"},te={class:"iconBox"},ie={style:{"margin-left":"4px"}},se={class:"iconBox"},oe={style:{"margin-left":"4px"}},le={class:"iconBox",style:{position:"relative"}},ae={key:0,class:"operationBox bg-[#fff] dark:bg-[#15171A]"},re=["onClick"],ne=O((()=>b("div",null,"下载视频",-1))),ce=["onClick"],ue=O((()=>b("div",null,"下载音频",-1))),de={key:1,class:"itemBottomLight"},me={class:"iconBox"},pe={style:{"margin-left":"4px"}},ve={class:"iconBox"},fe={style:{"margin-left":"4px"}},xe={class:"iconBox",style:{position:"relative"}},ge={key:0,class:"operationBox bg-[#fff] dark:bg-[#15171A]"},ye={class:"operationItem",style:{display:"flex"}},_e=O((()=>b("div",null,"下载视频",-1))),ke={class:"operationItem",style:{display:"flex"}},he=O((()=>b("div",null,"下载音频",-1))),je={class:"end text-[#A3A5A6] dark:text-[#76777A]"},be=["href"],Ce=["href"],Ie=f(y({__name:"musicSquare",setup(f){const y=F();let N=null;x();const A=d(),O=_((()=>"dark"===A.theme)),{isMobile:Ie}=m(),Be=T([{name:"最新歌曲",key:0},{name:"流行趋势",key:1}]),we=T(0),Ne=T([]);Ue(),e({modelType:"music"}).then((e=>{0!=e.data.length?localStorage.setItem("musicGroupId",e.data[0].id):0==e.data.length&&t({modelType:"music"}).then((e=>{localStorage.setItem("musicGroupId",e.data.id)}))}));const Ae=T(""),Ee=T(""),Fe=T(""),Te=T(""),qe=T("");function Ue(e){let t={};t=e?{size:999,page:1,order:e}:{size:999,page:1},s(t).then((e=>{const{records:t}=e.data;let i=t.filter((e=>e.text)).filter((e=>-1!=e.text.indexOf("http")&&-1!=e.text.indexOf("Chorus")));console.log(i);for(let s=0;s<i.length;s++){let e=i[s].text.split("🎵")[1].split("\n")[0],t=i[s].text.split("🎵")[1].split("[Chorus]")[1].split("[")[0];-1!=t.indexOf("mv")&&(t=t.split("mv")[0]);let o=i[s].text.split("🎵").pop().split("!")[1];i[s].image=o.split("](")[1].split(")")[0],i[s].mp3=o.split("](")[2].split(")")[0],i[s].mp4=o.split("](")[3].split(")")[0],i[s].title=e,i[s].intro=t,i[s].operation=!1}Ne.value=i,console.log(Ne.value)}))}i({keys:["copyrightTitle","icpNumber","policeFilingNumber","icpUrl","policeFilingUrl"]}).then((e=>{Ae.value=e.data.copyrightTitle,Ee.value=e.data.icpNumber,Fe.value=e.data.policeFilingNumber,Te.value=e.data.icpUrl,qe.value=e.data.policeFilingUrl}));const Le=T(1);function Oe(e){let t={chatLogId:e.chatId,action:"agree",type:"music"};0!=Le.value&&(Le.value=0,c(t).then((t=>{e.agree?Ne.value.forEach((t=>{t.chatId==e.chatId&&(t.agree=null,t.agreeNum--)})):Ne.value.forEach((t=>{t.chatId==e.chatId&&(t.agree="agree",t.agreeNum++)})),Le.value=1})))}const Se=T(""),ze=T(!0);function Re(){const e=document.getElementById("video");ze.value?(ze.value=!1,e.pause()):(ze.value=!0,e.play())}function De(e){Se.value=e.mp4;let t={recoredId:e.chatId};e.playNum++,n(t).then((e=>{console.log(e)}))}function Ge(e){let t=[];Ne.value.forEach((e=>{t=[...t,e.mp4]}));let i=t.indexOf(Se.value);if(0==e){if(0==i)return;i--,Se.value=t[i]}else if(1==e){if(i==t.length-1)return;i++,Se.value=t[i]}console.log(i)}const Me=T(!1);function Je(e){e.operation=!0,Me.value=!0}function Qe(){N&&(N.destroy(),N=null)}function He(e,t){let i="/api";if(N||(N=y.loading("下载中，请稍等",{duration:0})),"mp4"==t){Ke();let t=e.mp4.split("/").pop();g.get(i+"/proxy/down",{responseType:"blob",params:{url:e.mp4}}).then((e=>{const i=window.URL.createObjectURL(new Blob([e.data])),s=document.createElement("a");s.href=i,s.setAttribute("download",t),s.click(),Qe(),y.success("下载成功")}))}else if("mp3"==t){Ke();let t=e.mp3.split("/").pop();g.get(i+"/proxy/down",{responseType:"blob",params:{url:e.mp3}}).then((e=>{const i=window.URL.createObjectURL(new Blob([e.data])),s=document.createElement("a");s.href=i,s.setAttribute("download",t),s.click(),Qe(),y.success("下载成功")}))}}function Ke(){Me.value=!1,Ne.value.forEach((e=>{e.operation=!1}))}return(e,t)=>(E(),k("div",S,[q(Ie)?j("",!0):(E(),h(u,{key:0,sideType:1})),Me.value?(E(),k("div",{key:1,class:"mask",onClick:Ke})):j("",!0),b("div",z,[Se.value?(E(),k("div",R,[b("div",D,[C(p)]),b("video",{class:"video",autoplay:"",id:"video",loop:"",src:Se.value},null,8,G),C(q(v),{icon:"icon-park-solid:close-one",class:"text-xl text-[#fff] text-center icon",onClick:t[0]||(t[0]=e=>Se.value="")}),b("div",M,[b("img",{class:"controlItem",style:{cursor:"pointer"},src:o,alt:"",onClick:t[1]||(t[1]=e=>Ge(0))}),ze.value?(E(),k("img",{key:0,class:"controlItem",src:l,style:{margin:"0 50px",cursor:"pointer"},alt:"",onClick:Re})):j("",!0),ze.value?j("",!0):(E(),k("img",{key:1,class:"controlItem",src:a,style:{margin:"0 50px",cursor:"pointer"},alt:"",onClick:Re})),b("img",{class:"controlItem",style:{cursor:"pointer"},src:r,alt:"",onClick:t[2]||(t[2]=e=>Ge(1))})])])):j("",!0),b("div",J,[C(q(v),{icon:"akar-icons:music-album",class:"text-xl text-center"}),Q]),b("div",H,[b("div",K,[(E(!0),k(I,null,B(Be.value,((e,t)=>(E(),k("div",{class:L([we.value==t?"bg-[#3378ED] text-[#fff]":"bg-[#F4F4F4] dark:bg-[#010102]","tabItem"]),onClick:e=>{return i=t,we.value=i,void(0==i?Ue():1==i&&Ue("agreeNum"));var i},key:e.key},U(e.name),11,P)))),128))]),b("div",V,[(E(!0),k(I,null,B(Ne.value,(e=>(E(),k("div",{class:"contentItem",key:e.chatId},[b("div",W,[b("img",{class:"topImg",src:e.image,alt:""},null,8,X),b("div",Y,[b("div",Z,U(""==e.title?"匿名":e.title),1),b("div",$,U(e.intro),1)])]),q(O)?(E(),k("div",ee,[b("div",te,[C(q(v),{icon:"gridicons:play",class:"text-xl text-center icon",onClick:t=>De(e)},null,8,["onClick"]),b("div",ie,U(e.playNum?e.playNum:0),1)]),b("div",se,["agree"==e.agree?(E(),h(q(v),{key:0,icon:"iconamoon:like-fill",class:"text-xl text-center icon",onClick:t=>Oe(e)},null,8,["onClick"])):(E(),h(q(v),{key:1,icon:"iconamoon:like-light",class:"text-xl text-center icon",onClick:t=>Oe(e)},null,8,["onClick"])),b("div",oe,U(e.agreeNum?e.agreeNum:0),1)]),b("div",le,[C(q(v),{icon:"ri:more-line",class:"text-xl text-center icon",onClick:t=>Je(e)},null,8,["onClick"]),e.operation?(E(),k("div",ae,[b("div",{class:"operationItem",style:{display:"flex"},onClick:t=>He(e,"mp4")},[C(q(v),{icon:"gravity-ui:video",style:{"margin-right":"5px"},class:"text-xl text-center"}),ne],8,re),b("div",{class:"operationItem",style:{display:"flex"},onClick:t=>He(e,"mp3")},[C(q(v),{icon:"fluent:headphones-sound-wave-24-filled",style:{"margin-right":"5px"},class:"text-xl text-center"}),ue],8,ce)])):j("",!0)])])):(E(),k("div",de,[b("div",me,[C(q(v),{icon:"gridicons:play",class:"text-xl text-center icon",onClick:t=>De(e)},null,8,["onClick"]),b("div",pe,U(e.playNum?e.playNum:0),1)]),b("div",ve,[e.agree?(E(),h(q(v),{key:0,icon:"iconamoon:like-fill",class:"text-xl text-center icon",onClick:t=>Oe(e)},null,8,["onClick"])):(E(),h(q(v),{key:1,icon:"iconamoon:like-light",class:"text-xl text-center icon",onClick:t=>Oe(e)},null,8,["onClick"])),b("div",fe,U(e.agreeNum?e.agreeNum:0),1)]),b("div",xe,[C(q(v),{icon:"ri:more-line",class:"text-xl text-center icon",onClick:t=>Je(e)},null,8,["onClick"]),e.operation?(E(),k("div",ge,[b("div",ye,[C(q(v),{icon:"gravity-ui:video",style:{"margin-right":"5px"},class:"text-xl text-center"}),_e]),b("div",ke,[C(q(v),{icon:"fluent:headphones-sound-wave-24-filled",style:{"margin-right":"5px"},class:"text-xl text-center"}),he])])):j("",!0)])]))])))),128))]),b("div",je,[w("版权所有 © "+U(Ae.value)+" ",1),b("a",{href:Te.value||"#"},[b("a",{href:qe.value||"#"},U(Fe.value),9,Ce),w(U(Ee.value),1)],8,be)])])])]))}}),[["__scopeId","data-v-2089b1ff"]]);export{Ie as default};
