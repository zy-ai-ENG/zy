import{_ as e,a as l,b as t,c as a}from"../end/end.08128031.js";import{S as i}from"../index/index.003f58b7.js";import{d as o,u as s,b as n,c,v as r,e as d,g as u,y as p,i as v,h as m,k as g,l as x,j as f,n as y,F as k,r as h,Z as b,m as C,o as I,_ as B,M as N,C as F,D as w,aC as A,H as E}from"../main-83ca6c6a.js";import{q as T,c as L,a as j,m as U,b as O,d as _}from"./music.dcec3151.js";const D=e=>(F("data-v-5e336976"),e=e(),w(),e),S={class:"bg-[#f4f4f4] dark:bg-[#020104] musicBody"},R={class:"mainBox"},q={key:0,class:"videoBox"},H=D((()=>f("div",{style:{width:"504px",height:"756px","border-radius":"8px",position:"relative",display:"flex","justify-content":"center","align-items":"center"},class:"bg-[#E5EDFE] dark:bg-[#0A182F]"},[f("div",{style:{width:"50px",height:"50px"}},[f("div",{class:"loader"})])],-1))),M=["src"],z={class:"control"},G={class:"musicSquareTitle bg-[#fff] dark:bg-[#15171A] border-[1px] border-b dark:border-[#020104] border-[transparent]"},J=D((()=>f("div",{style:{"margin-left":"4px"}},"音乐广场",-1))),Z={style:{height:"87vh","border-radius":"0 0 12px 12px"},class:"bg-[#fff] dark:bg-[#15171A]"},K={class:"contentBox bg-[#fff] dark:bg-[#15171A]"},P={class:"tabBox"},Q=["onClick"],V={class:"itemTop bg-[#F5F8FE] dark:bg-[#0A182F]"},W=["src"],X={class:"topTitle"},Y={class:"title"},$={class:"intro"},ee={key:0,class:"itemBottomDark"},le={class:"iconBox"},te={style:{"margin-left":"4px"}},ae={class:"iconBox"},ie={style:{"margin-left":"4px"}},oe={class:"iconBox",style:{position:"relative"}},se={key:0,class:"operationBox bg-[#fff] dark:bg-[#15171A]"},ne=["onClick"],ce=D((()=>f("div",null,"下载视频",-1))),re=["onClick"],de=D((()=>f("div",null,"下载音频",-1))),ue={key:1,class:"itemBottomLight"},pe={class:"iconBox"},ve={style:{"margin-left":"4px"}},me={class:"iconBox"},ge={style:{"margin-left":"4px"}},xe={class:"iconBox",style:{position:"relative"}},fe={key:0,class:"operationBox bg-[#fff] dark:bg-[#15171A]"},ye={class:"operationItem",style:{display:"flex"}},ke=D((()=>f("div",null,"下载视频",-1))),he={class:"operationItem",style:{display:"flex"}},be=D((()=>f("div",null,"下载音频",-1))),Ce={class:"end text-[#A3A5A6] dark:text-[#76777A]"},Ie=["href"],Be=["href"],Ne=E(o({__name:"musicSquare",setup(o){const F=s(),w=n(),E=c((()=>w.isLogin));let D=null;r();const Ne=d(),Fe=c((()=>"dark"===Ne.theme)),{isMobile:we}=u(),Ae=p([{name:"最新歌曲",key:0},{name:"流行趋势",key:1}]),Ee=p(0),Te=p(1),Le=p(),je=p(""),Ue=p([]);qe(),T({modelType:"music"}).then((e=>{0!=e.data.length?localStorage.setItem("musicGroupId",e.data[0].id):0==e.data.length&&L({modelType:"music"}).then((e=>{localStorage.setItem("musicGroupId",e.data.id)}))}));const Oe=p(""),_e=p(""),De=p(""),Se=p(""),Re=p("");function qe(e){D||(D=F.loading("数据加载中",{duration:0}));let l={};l=e?{size:30,page:Te.value,order:e}:{size:30,page:Te.value},console.log(l),U(l).then((e=>{Le.value=e.data.count;const{records:l}=e.data;let t=l.filter((e=>e.text)).filter((e=>-1!=e.text.indexOf("http")&&-1!=e.text.indexOf("Chorus")&&-1!=e.text.indexOf("####")));for(let a=0;a<t.length;a++){let e=t[a].text.split("🎵")[1].split("\n")[0],l=t[a].text.split("🎵")[1].split("[Chorus]")[1].split("[")[0];-1!=l.indexOf("mv")&&(l=l.split("mv")[0]);let i=t[a].text.split("🎵").pop().split("!")[1];t[a].image=i.split("](")[1].split(")")[0],t[a].mp3=i.split("](")[2].split(")")[0],t[a].mp4=i.split("](")[3].split(")")[0],t[a].title=e,t[a].intro=l,t[a].operation=!1}Ue.value=[...Ue.value,...t],Ve()})).catch((e=>{Ve(),qe()}))}j({keys:["copyrightTitle","icpNumber","policeFilingNumber","icpUrl","policeFilingUrl"]}).then((e=>{Oe.value=e.data.copyrightTitle,_e.value=e.data.icpNumber,De.value=e.data.policeFilingNumber,Se.value=e.data.icpUrl,Re.value=e.data.policeFilingUrl}));const He=p(1);function Me(e){let l={chatLogId:e.chatId,action:"agree",type:"suno"};0!=He.value&&(He.value=0,_(l).then((l=>{e.agree?Ue.value.forEach((l=>{l.chatId==e.chatId&&(l.agree=null,l.agreeNum--)})):Ue.value.forEach((l=>{l.chatId==e.chatId&&(l.agree="agree",l.agreeNum++)})),He.value=1})))}const ze=p(""),Ge=p(!0);function Je(){const e=document.getElementById("video");Ge.value?(Ge.value=!1,e.pause()):(Ge.value=!0,e.play())}function Ze(e){if(!E.value)return void w.setLoginDialog(!0);ze.value=e.mp4;let l={recoredId:e.chatId};e.playNum++,O(l).then((e=>{console.log(e)}))}function Ke(e){let l=[];Ue.value.forEach((e=>{l=[...l,e.mp4]}));let t=l.indexOf(ze.value);if(0==e){if(0==t)return;t--,ze.value=l[t]}else if(1==e){if(t==l.length-1)return;t++,ze.value=l[t]}console.log(t)}const Pe=p(!1);function Qe(e){e.operation=!0,Pe.value=!0}function Ve(){D&&(D.destroy(),D=null)}function We(e,l){if(!E.value)return void w.setLoginDialog(!0);let t="/api";if(D||(D=F.loading("下载中，请稍等",{duration:0})),"mp4"==l){Xe();let l=e.mp4.split("/").pop();A.get(t+"/proxy/down",{responseType:"blob",params:{url:e.mp4}}).then((e=>{const t=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=t,a.setAttribute("download",l),a.click(),Ve(),F.success("下载成功")}))}else if("mp3"==l){Xe();let l=e.mp3.split("/").pop();A.get(t+"/proxy/down",{responseType:"blob",params:{url:e.mp3}}).then((e=>{const t=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=t,a.setAttribute("download",l),a.click(),Ve(),F.success("下载成功")}))}}function Xe(){Pe.value=!1,Ue.value.forEach((e=>{e.operation=!1}))}const Ye=p(null);function $e(){const e=Ye.value;if(e.scrollTop+e.clientHeight+1>=e.scrollHeight){if(30*Te.value>=Le.value)return void F.error("没有更多数据了");Te.value++,je.value?qe(je.value):qe()}}return(o,s)=>(I(),v("div",S,[m(we)?x("",!0):(I(),g(i,{key:0,sideType:1})),Pe.value?(I(),v("div",{key:1,class:"mask",onClick:Xe})):x("",!0),f("div",R,[ze.value?(I(),v("div",q,[H,f("video",{class:"video",autoplay:"",id:"video",loop:"",src:ze.value},null,8,M),y(m(B),{icon:"icon-park-solid:close-one",class:"text-xl text-[#fff] text-center icon",onClick:s[0]||(s[0]=e=>ze.value="")}),f("div",z,[f("img",{class:"controlItem",style:{cursor:"pointer"},src:e,alt:"",onClick:s[1]||(s[1]=e=>Ke(0))}),Ge.value?(I(),v("img",{key:0,class:"controlItem",src:l,style:{margin:"0 50px",cursor:"pointer"},alt:"",onClick:Je})):x("",!0),Ge.value?x("",!0):(I(),v("img",{key:1,class:"controlItem",src:t,style:{margin:"0 50px",cursor:"pointer"},alt:"",onClick:Je})),f("img",{class:"controlItem",style:{cursor:"pointer"},src:a,alt:"",onClick:s[2]||(s[2]=e=>Ke(1))})])])):x("",!0),f("div",G,[y(m(B),{icon:"akar-icons:music-album",class:"text-xl text-center"}),J]),f("div",Z,[f("div",K,[f("div",P,[(I(!0),v(k,null,h(Ae.value,((e,l)=>(I(),v("div",{class:N([Ee.value==l?"bg-[#3378ED] text-[#fff]":"bg-[#F4F4F4] dark:bg-[#010102]","tabItem"]),onClick:e=>{return t=l,Ee.value=t,Te.value=1,0==t?je.value="":1==t&&(je.value="agreeNum"),void qe(je.value);var t},key:e.key},C(e.name),11,Q)))),128))]),f("div",{class:"content",ref_key:"container",ref:Ye,onScroll:$e},[(I(!0),v(k,null,h(Ue.value,(e=>(I(),v("div",{class:"contentItem",key:e.chatId},[f("div",V,[f("img",{class:"topImg",src:e.image,alt:""},null,8,W),f("div",X,[f("div",Y,C(""==e.title?"匿名":e.title),1),f("div",$,C(e.intro),1)])]),Fe.value?(I(),v("div",ee,[f("div",le,[y(m(B),{icon:"gridicons:play",class:"text-xl text-center icon",onClick:l=>Ze(e)},null,8,["onClick"]),f("div",te,C(e.playNum?e.playNum:0),1)]),f("div",ae,["agree"==e.agree?(I(),g(m(B),{key:0,icon:"iconamoon:like-fill",class:"text-xl text-center icon",onClick:l=>Me(e)},null,8,["onClick"])):(I(),g(m(B),{key:1,icon:"iconamoon:like-light",class:"text-xl text-center icon",onClick:l=>Me(e)},null,8,["onClick"])),f("div",ie,C(e.agreeNum?e.agreeNum:0),1)]),f("div",oe,[y(m(B),{icon:"ri:more-line",class:"text-xl text-center icon",onClick:l=>Qe(e)},null,8,["onClick"]),e.operation?(I(),v("div",se,[f("div",{class:"operationItem",style:{display:"flex"},onClick:l=>We(e,"mp4")},[y(m(B),{icon:"gravity-ui:video",style:{"margin-right":"5px"},class:"text-xl text-center"}),ce],8,ne),f("div",{class:"operationItem",style:{display:"flex"},onClick:l=>We(e,"mp3")},[y(m(B),{icon:"fluent:headphones-sound-wave-24-filled",style:{"margin-right":"5px"},class:"text-xl text-center"}),de],8,re)])):x("",!0)])])):(I(),v("div",ue,[f("div",pe,[y(m(B),{icon:"gridicons:play",class:"text-xl text-center icon",onClick:l=>Ze(e)},null,8,["onClick"]),f("div",ve,C(e.playNum?e.playNum:0),1)]),f("div",me,[e.agree?(I(),g(m(B),{key:0,icon:"iconamoon:like-fill",class:"text-xl text-center icon",onClick:l=>Me(e)},null,8,["onClick"])):(I(),g(m(B),{key:1,icon:"iconamoon:like-light",class:"text-xl text-center icon",onClick:l=>Me(e)},null,8,["onClick"])),f("div",ge,C(e.agreeNum?e.agreeNum:0),1)]),f("div",xe,[y(m(B),{icon:"ri:more-line",class:"text-xl text-center icon",onClick:l=>Qe(e)},null,8,["onClick"]),e.operation?(I(),v("div",fe,[f("div",ye,[y(m(B),{icon:"gravity-ui:video",style:{"margin-right":"5px"},class:"text-xl text-center"}),ke]),f("div",he,[y(m(B),{icon:"fluent:headphones-sound-wave-24-filled",style:{"margin-right":"5px"},class:"text-xl text-center"}),be])])):x("",!0)])]))])))),128))],544)]),f("div",Ce,[b("版权所有 © "+C(Oe.value)+" ",1),f("a",{href:Se.value||"#"},[f("a",{href:Re.value||"#"},C(De.value),9,Be),b(C(_e.value),1)],8,Ie)])])])]))}}),[["__scopeId","data-v-5e336976"]]);export{Ne as default};
