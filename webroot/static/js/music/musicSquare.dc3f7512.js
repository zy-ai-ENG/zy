import{q as e,c as l,a as t,m as a,_ as i,b as o,d as s,e as n,f as c,g as r}from"./music.d92ec93e.js";import{S as u}from"../index/index.e39b3da2.js";import{d,u as p,v,e as m,c as x,g,y as f,i as y,h as k,k as h,l as b,j as C,n as I,F as B,r as N,$ as w,m as A,o as E,az as F,_ as T,M as U,C as j,D as _,aD as D,E as L}from"../main-e1cb34e4.js";import"../punycode@2.3.0/punycode@2.3.0.8a62a219.js";const O=e=>(j("data-v-a225db20"),e=e(),_(),e),S={class:"bg-[#f4f4f4] dark:bg-[#020104] musicBody"},R={class:"mainBox"},q={key:0,class:"videoBox"},z={style:{width:"504px",height:"756px","border-radius":"8px",position:"relative"},class:"bg-[#E5EDFE] dark:bg-[#0A182F]"},H=["src"],G={class:"control"},M={class:"musicSquareTitle bg-[#fff] dark:bg-[#15171A] border-[1px] border-b dark:border-[#020104] border-[transparent]"},$=O((()=>C("div",{style:{"margin-left":"4px"}},"音乐广场",-1))),J={class:"contentBox bg-[#fff] dark:bg-[#15171A]"},K={class:"tabBox"},P=["onClick"],Q={class:"itemTop bg-[#fff] dark:bg-[#0A182F]"},V=["src"],W={class:"topTitle"},X={class:"title"},Y={class:"intro"},Z={key:0,class:"itemBottomDark"},ee={class:"iconBox"},le={style:{"margin-left":"4px"}},te={class:"iconBox"},ae={style:{"margin-left":"4px"}},ie={class:"iconBox",style:{position:"relative"}},oe={key:0,class:"operationBox bg-[#fff] dark:bg-[#15171A]"},se=["onClick"],ne=O((()=>C("div",null,"下载视频",-1))),ce=["onClick"],re=O((()=>C("div",null,"下载音频",-1))),ue={key:1,class:"itemBottomLight"},de={class:"iconBox"},pe={style:{"margin-left":"4px"}},ve={class:"iconBox"},me={style:{"margin-left":"4px"}},xe={class:"iconBox",style:{position:"relative"}},ge={key:0,class:"operationBox bg-[#fff] dark:bg-[#15171A]"},fe={class:"operationItem",style:{display:"flex"}},ye=O((()=>C("div",null,"下载视频",-1))),ke={class:"operationItem",style:{display:"flex"}},he=O((()=>C("div",null,"下载音频",-1))),be={class:"end text-[#A3A5A6] dark:text-[#76777A]"},Ce=["href"],Ie=["href"],Be=L(d({__name:"musicSquare",setup(d){const j=p();let _=null;v();const L=m(),O=x((()=>"dark"===L.theme)),{isMobile:Be}=g(),Ne=f([{name:"最新歌曲",key:0},{name:"流行趋势",key:1}]),we=f(0),Ae=f(1),Ee=f(),Fe=f(""),Te=f([]);Oe(),e({modelType:"music"}).then((e=>{0!=e.data.length?localStorage.setItem("musicGroupId",e.data[0].id):0==e.data.length&&l({modelType:"music"}).then((e=>{localStorage.setItem("musicGroupId",e.data.id)}))}));const Ue=f(""),je=f(""),_e=f(""),De=f(""),Le=f("");function Oe(e){_||(_=j.loading("数据加载中",{duration:0}));let l={};l=e?{size:30,page:Ae.value,order:e}:{size:30,page:Ae.value},console.log(l),a(l).then((e=>{Ee.value=e.data.count;const{records:l}=e.data;let t=l.filter((e=>e.text)).filter((e=>-1!=e.text.indexOf("http")&&-1!=e.text.indexOf("Chorus")));for(let a=0;a<t.length;a++){let e=t[a].text.split("🎵")[1].split("\n")[0],l=t[a].text.split("🎵")[1].split("[Chorus]")[1].split("[")[0];-1!=l.indexOf("mv")&&(l=l.split("mv")[0]);let i=t[a].text.split("🎵").pop().split("!")[1];t[a].image=i.split("](")[1].split(")")[0],t[a].mp3=i.split("](")[2].split(")")[0],t[a].mp4=i.split("](")[3].split(")")[0],t[a].title=e,t[a].intro=l,t[a].operation=!1}Te.value=[...Te.value,...t],Ke(),console.log(Te.value)}))}t({keys:["copyrightTitle","icpNumber","policeFilingNumber","icpUrl","policeFilingUrl"]}).then((e=>{Ue.value=e.data.copyrightTitle,je.value=e.data.icpNumber,_e.value=e.data.policeFilingNumber,De.value=e.data.icpUrl,Le.value=e.data.policeFilingUrl}));const Se=f(1);function Re(e){let l={chatLogId:e.chatId,action:"agree",type:"music"};0!=Se.value&&(Se.value=0,r(l).then((l=>{e.agree?Te.value.forEach((l=>{l.chatId==e.chatId&&(l.agree=null,l.agreeNum--)})):Te.value.forEach((l=>{l.chatId==e.chatId&&(l.agree="agree",l.agreeNum++)})),Se.value=1})))}const qe=f(""),ze=f(!0);function He(){const e=document.getElementById("video");ze.value?(ze.value=!1,e.pause()):(ze.value=!0,e.play())}function Ge(e){qe.value=e.mp4;let l={recoredId:e.chatId};e.playNum++,c(l).then((e=>{console.log(e)}))}function Me(e){let l=[];Te.value.forEach((e=>{l=[...l,e.mp4]}));let t=l.indexOf(qe.value);if(0==e){if(0==t)return;t--,qe.value=l[t]}else if(1==e){if(t==l.length-1)return;t++,qe.value=l[t]}console.log(t)}const $e=f(!1);function Je(e){e.operation=!0,$e.value=!0}function Ke(){_&&(_.destroy(),_=null)}function Pe(e,l){let t="/api";if(_||(_=j.loading("下载中，请稍等",{duration:0})),"mp4"==l){Qe();let l=e.mp4.split("/").pop();D.get(t+"/proxy/down",{responseType:"blob",params:{url:e.mp4}}).then((e=>{const t=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=t,a.setAttribute("download",l),a.click(),Ke(),j.success("下载成功")}))}else if("mp3"==l){Qe();let l=e.mp3.split("/").pop();D.get(t+"/proxy/down",{responseType:"blob",params:{url:e.mp3}}).then((e=>{const t=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=t,a.setAttribute("download",l),a.click(),Ke(),j.success("下载成功")}))}}function Qe(){$e.value=!1,Te.value.forEach((e=>{e.operation=!1}))}const Ve=f(null);function We(){const e=Ve.value;if(e.scrollTop+e.clientHeight>=e.scrollHeight){if(30*Ae.value>=Ee.value)return void j.error("没有更多数据了");Ae.value++,Fe.value?Oe(Fe.value):Oe()}}return(e,l)=>(E(),y("div",S,[k(Be)?b("",!0):(E(),h(u,{key:0,sideType:1})),$e.value?(E(),y("div",{key:1,class:"mask",onClick:Qe})):b("",!0),C("div",R,[qe.value?(E(),y("div",q,[C("div",z,[I(F)]),C("video",{class:"video",autoplay:"",id:"video",loop:"",src:qe.value},null,8,H),I(k(T),{icon:"icon-park-solid:close-one",class:"text-xl text-[#fff] text-center icon",onClick:l[0]||(l[0]=e=>qe.value="")}),C("div",G,[C("img",{class:"controlItem",style:{cursor:"pointer"},src:i,alt:"",onClick:l[1]||(l[1]=e=>Me(0))}),ze.value?(E(),y("img",{key:0,class:"controlItem",src:o,style:{margin:"0 50px",cursor:"pointer"},alt:"",onClick:He})):b("",!0),ze.value?b("",!0):(E(),y("img",{key:1,class:"controlItem",src:s,style:{margin:"0 50px",cursor:"pointer"},alt:"",onClick:He})),C("img",{class:"controlItem",style:{cursor:"pointer"},src:n,alt:"",onClick:l[2]||(l[2]=e=>Me(1))})])])):b("",!0),C("div",M,[I(k(T),{icon:"akar-icons:music-album",class:"text-xl text-center"}),$]),C("div",J,[C("div",K,[(E(!0),y(B,null,N(Ne.value,((e,l)=>(E(),y("div",{class:U([we.value==l?"bg-[#3378ED] text-[#fff]":"bg-[#F4F4F4] dark:bg-[#010102]","tabItem"]),onClick:e=>{return t=l,we.value=t,Ae.value=1,0==t?Fe.value="":1==t&&(Fe.value="agreeNum"),void Oe(Fe.value);var t},key:e.key},A(e.name),11,P)))),128))]),C("div",{class:"content",ref_key:"container",ref:Ve,onScroll:We},[(E(!0),y(B,null,N(Te.value,(e=>(E(),y("div",{class:"contentItem",key:e.chatId},[C("div",Q,[C("img",{class:"topImg",src:e.image,alt:""},null,8,V),C("div",W,[C("div",X,A(""==e.title?"匿名":e.title),1),C("div",Y,A(e.intro),1)])]),O.value?(E(),y("div",Z,[C("div",ee,[I(k(T),{icon:"gridicons:play",class:"text-xl text-center icon",onClick:l=>Ge(e)},null,8,["onClick"]),C("div",le,A(e.playNum?e.playNum:0),1)]),C("div",te,["agree"==e.agree?(E(),h(k(T),{key:0,icon:"iconamoon:like-fill",class:"text-xl text-center icon",onClick:l=>Re(e)},null,8,["onClick"])):(E(),h(k(T),{key:1,icon:"iconamoon:like-light",class:"text-xl text-center icon",onClick:l=>Re(e)},null,8,["onClick"])),C("div",ae,A(e.agreeNum?e.agreeNum:0),1)]),C("div",ie,[I(k(T),{icon:"ri:more-line",class:"text-xl text-center icon",onClick:l=>Je(e)},null,8,["onClick"]),e.operation?(E(),y("div",oe,[C("div",{class:"operationItem",style:{display:"flex"},onClick:l=>Pe(e,"mp4")},[I(k(T),{icon:"gravity-ui:video",style:{"margin-right":"5px"},class:"text-xl text-center"}),ne],8,se),C("div",{class:"operationItem",style:{display:"flex"},onClick:l=>Pe(e,"mp3")},[I(k(T),{icon:"fluent:headphones-sound-wave-24-filled",style:{"margin-right":"5px"},class:"text-xl text-center"}),re],8,ce)])):b("",!0)])])):(E(),y("div",ue,[C("div",de,[I(k(T),{icon:"gridicons:play",class:"text-xl text-center icon",onClick:l=>Ge(e)},null,8,["onClick"]),C("div",pe,A(e.playNum?e.playNum:0),1)]),C("div",ve,[e.agree?(E(),h(k(T),{key:0,icon:"iconamoon:like-fill",class:"text-xl text-center icon",onClick:l=>Re(e)},null,8,["onClick"])):(E(),h(k(T),{key:1,icon:"iconamoon:like-light",class:"text-xl text-center icon",onClick:l=>Re(e)},null,8,["onClick"])),C("div",me,A(e.agreeNum?e.agreeNum:0),1)]),C("div",xe,[I(k(T),{icon:"ri:more-line",class:"text-xl text-center icon",onClick:l=>Je(e)},null,8,["onClick"]),e.operation?(E(),y("div",ge,[C("div",fe,[I(k(T),{icon:"gravity-ui:video",style:{"margin-right":"5px"},class:"text-xl text-center"}),ye]),C("div",ke,[I(k(T),{icon:"fluent:headphones-sound-wave-24-filled",style:{"margin-right":"5px"},class:"text-xl text-center"}),he])])):b("",!0)])]))])))),128))],544)]),C("div",be,[w("版权所有 © "+A(Ue.value)+" ",1),C("a",{href:De.value||"#"},[C("a",{href:Le.value||"#"},A(_e.value),9,Ie),w(A(je.value),1)],8,Ce)])])]))}}),[["__scopeId","data-v-a225db20"]]);export{Be as default};
