import{d as e,b as a,ar as t,u as l,y as s,c as n,v as i,a6 as o,G as r,U as u,z as d,V as v,i as c,j as p,a1 as f,F as m,r as h,as as A,o as g,n as x,w as y,at as w,m as k,B as b,l as B,g as C,a3 as j,h as U,k as E,$ as I,a0 as K,ab as R,au as S,av as D,K as L,C as F,D as J,E as W}from"../main-ef5ef38b.js";import{t as N}from"../throttle/throttle.33f09de3.js";import{c as O}from"../index/index.a4f65e28.js";import{S as P}from"../index/index.6c980a6f.js";const Q={class:"overflow-hidden pr-0 h-full flex flex-col"},V={class:"market overflow-y-auto flex-1 min-h-screen h-[80vh] p-2 relative itemContent"},q=["id"],z=["id","src","onLoad","onError","onClick"],T={class:"menu p-2 text-[#cbd5e1]"},G={class:"prompt"},_={class:"flex justify-between items-end"},H=["onClick"],X=[p("span",{class:"text-[12px] pt-[2px] scale-90 dark:text-slate-400"},"画同款",-1)],Z=["onClick"],Y=[p("span",{class:"text-[12px] pt-[2px] scale-90 dark:text-slate-400"},"复制",-1)],$=e({__name:"market",props:{type:{type:String,required:!1,default:"all"}},setup(e,{expose:C}){var j;const U=a(),E=null==(j=t())?void 0:j.appContext.config.globalProperties.$viewerApi,I=l(),K=s([]),R=s({}),S=s(0),D=s(160),L=s(0),F=s(10),J=s(10),W=s([]),P=s(null),$=s(0),M=n((()=>U.isLogin)),ee=s(30),ae=s(""),te=n((()=>ee.value+F.value+150)),le=i(),se=e,ne=s();o.on("newData",(e=>{ne.value=e}));const ie=r({page:1,size:999,rec:1,squareType:se.type});function oe(){!function(){const{showName:e=0,showOther:a=0}={};S.value=15*[e,a].filter((e=>e)).length}(),function(){if(!P.value)return;const e=P.value.clientWidth;L.value=Math.floor(e/te.value);const a=e-L.value*te.value,t=(L.value-1)*F.value;a-t<0&&(L.value-=1);D.value=Math.floor((e-t)/L.value)}();const e=L.value,a=D.value,t=[];re.value.forEach(((l,s)=>{let n=200,i=300;l.fileInfo&&(n=l.fileInfo.width||n,i=l.fileInfo.height||i);const o=i*(a/n)+J.value+S.value,r=R.value[l.id];if(t.length<e)r.style.top="0px",r.style.left=(a+F.value)*s+"px",t.push(o);else{const e=Math.min.apply(null,t),a=t.findIndex((a=>a===e));r.style.top=`${e+0}px`,r.style.left=a*(D.value+F.value)+"px",t[a]+=o}})),$.value=Math.max(...t)+130}const re=n((()=>ne.value?ne.value.rows:ae.value?K.value.filter((e=>{const{prompt:a}=e;return a.includes(ae.value)})):K.value));u(ee,(()=>{oe()}));let ue=null;async function de(){const e=await A(ie);K.value=e.data.rows}u(re,(()=>{re.value.length&&(clearTimeout(ue),ue=setTimeout((()=>{oe()}),300))}));const ve=n((()=>e=>{let a=200,t=300;return e.fileInfo&&(a=e.fileInfo.width,t=e.fileInfo.height),t/(a/D.value)})),ce=N((function(){oe()}),200);return d((async()=>{await de(),oe(),window.addEventListener("resize",ce)})),C({handleQuery:e=>{ie.squareType=e,de(),oe()}}),v((()=>{window.removeEventListener("resize",ce)})),(e,a)=>(g(),c("div",Q,[p("div",V,[p("div",{id:"wapper",ref_key:"wapperRef",ref:P,class:"wapper",style:f({height:`${$.value}px`})},[(g(!0),c(m,null,h(re.value,((e,a)=>(g(),c("div",{id:e.id,key:a,ref_for:!0,ref:a=>function(e,a){e&&a&&(R.value[a.id]=e)}(a,e),class:"wapper-item",style:f({width:`${D.value}px`})},[x(w,{name:"img",css:!0},{default:y((()=>[p("img",{id:e.id,class:"item-file rounded-sm",style:f({width:`${D.value}px`,height:`${ve.value(e)}px`}),src:e.imageUrl,loading:"lazy",onLoad:a=>function(e,a){W.value.push(a.id)}(0,e),onError:a=>function(e,a){W.value.push(a.id)}(0,e),onClick:a=>function(e){E({options:{},images:[e.imageUrl]})}(e)},null,44,z)])),_:2},1024),p("div",T,[p("div",G,k(e.fullPrompt),1),p("div",_,[p("button",{class:"flex mr-2 h-4 w-10 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:b((a=>(e=>{U.updatePromptWords({prompt:e.fullPrompt}),le.push("/midjourney?id=textToImage")})(e)),["stop"])},X,8,H),p("button",{class:"flex h-4 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:b((a=>function(e){if(!M.value)return U.setLoginDialog(!0);const{prompt:a}=e;O({text:a}),I.success("复制prompt成功")}(e)),["stop"])},Y,8,Z)])]),W.value.includes(e.id)?B("",!0):(g(),c("div",{key:0,class:"item-loading",style:f({width:`${D.value}px`,height:`${ve.value(e)}px`})},null,4))],12,q)))),128))],4)])]))}}),M=e=>(F("data-v-f5096a1c"),e=e(),J(),e),ee={style:{position:"absolute"}},ae={class:"dark:bg-[#15171A] bg-[#fff] mainBox"},te={key:0,class:"flex justify-center"},le={style:{display:"flex","justify-content":"center","margin-top":"10px"}},se={class:"inpBox bg-[#EBEBEB] dark:bg-[#171726]"},ne=[M((()=>p("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAe1JREFUOE+dlD1oFFEUhb8DKmphKom/CBILQdHCBBQhNmJAUlkFtRFEK0Fr7aw1sQhISCWSyjSSYKGgRCyihUbsUijGQmxU8AcVjnOXN+tkdnZn3dcs7Jv3vXPfPfeINsv2WmAXsBlYB/wCPgHvJP1udy7+V3nT9kbgGDAIrK84/AN4kX3zWNL3KvgqqO0dwFlgE/AReAm8BwK0AdgJHAC2AF+BO5JWyuAm1HYcOA84UzknabHD0wwBJ1OlU5Li4uZqQG1HmVdSubclfej0ZunMNuAi8DOr7Iak+G2sHBq3HgVmJT2vA+b7tg8Bp4CnkuaaUNtrgKvAF0k3uwUWwJeBPuC6pD8Npbb3AOeAB5Ke9AAdBkayJk5LWs6hR4BRYCr5sf9/4LZ3pwbfl/Qsh4YnTwC3gOPAXuBaXkqdcttbgUvAI0kPq5QGMBo2WbZJB3tVKm2+KfA22WRZ0nSdymStyjfNu/9Z0rjt08A+YEnSTB3Ydmv30225T+8Br4AzMaqSJjpBCz5dkDRfNn8vE7UduAB8AyZaJiqp7WX2IxLfAHclRWb8G9PCdHSTUgeB/pjAlK8D2ai+BmZycK95GvkQ0xeROAbsL4JboAXVxeSPLA1AS/LbDsZqcJ1lutkvgefbKu0GVvwmgQ8DK38BXh3TaV83jK0AAAAASUVORK5CYII=",alt:""},null,-1))),M((()=>p("p",null,"搜索",-1)))],ie={key:1,class:"flex w-full flex-j mb-2 items-center overflow-x-hidden justify-center",style:{"margin-top":"25px"}},oe={class:"relative z-40 transition-300 ease"},re=["onClick"],ue={class:"pl-3 pr-3 pt-1 pb-1 whitespace-nowrap"},de={class:"flex-1 h-[82vh]",style:{padding:"0 200px","margin-bottom":"10px"}},ve=W(e({__name:"inspiration",setup(e){const{isMobile:a}=C(),t=s(),l=s(""),n=s(),i=s([]);(async()=>{const e=await R({page:1,size:100}).then((e=>e.data.rows));i.value=[{name:"全部",value:""}].concat(e)||S,t.value.handleQuery(l.value)})(),o.emit("drawRoute",j.options.history.location);const r=s(),u=s();function d(){let e={keyword:u.value,page:1,size:999};D(e).then((e=>{r.value=e.data,o.emit("newData",r.value)})),u.value=""}return(e,s)=>(g(),c(m,null,[p("div",ee,[U(a)?B("",!0):(g(),E(P,{key:0}))]),p("div",ae,[U(a)?B("",!0):(g(),c("div",te)),p("div",le,[p("div",se,[I(p("input",{class:"inp bg-[#f4f4f4] dark:bg-[#010102]","onUpdate:modelValue":s[0]||(s[0]=e=>u.value=e),type:"text",placeholder:"输入关键词"},null,512),[[K,u.value]]),p("div",{class:"iconBox",onClick:d},ne)])]),U(a)?B("",!0):(g(),c("div",ie,[p("div",oe,[p("ul",{class:"flex justify-start items-center",ref_key:"tabListRef",ref:n},[(g(!0),c(m,null,h(i.value,(e=>(g(),c("li",{onClick:a=>{return s=e,l.value=s.value,t.value.handleQuery(s.value),void o.emit("newData","");var s},class:L(["mr-1 ml-1 w-auto select-none cursor-pointer hover:dark:text-[#fff] hover:text-[#fff] hover:bg-gradient-to-l from-[#2F73EC] to-[#5AA8F7] duration-300 flex rounded-3xl",[e.value===l.value?"text-[#fff] bg-gradient-to-l from-[#2F73EC] to-[#5AA8F7]  dark:text-[#fff]":"bg-[transparent] dark:bg-[transparent]"]])},[p("div",ue,k(e.name),1)],10,re)))),256))],512)])])),p("div",de,[x($,{ref_key:"marketRef",ref:t,type:l.value},null,8,["type"])])])],64))}}),[["__scopeId","data-v-f5096a1c"]]);export{ve as default};
