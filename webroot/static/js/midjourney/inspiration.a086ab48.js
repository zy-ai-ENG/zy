import{d as e,b as a,ar as l,u as t,y as s,c as n,v as i,a6 as o,G as u,U as r,z as v,V as d,i as f,j as c,a1 as p,F as m,r as A,as as h,o as g,n as y,w,at as x,l as k,g as b,a3 as B,h as C,k as U,$ as E,a0 as K,ab as j,au as D,av as I,K as R,m as S,C as F,D as J,E as L}from"../main-bc4b8ea2.js";import{t as N}from"../throttle/throttle.33f09de3.js";import{S as O}from"../index/index.43b3e0d6.js";const Q={class:"overflow-hidden pr-0 h-full flex flex-col"},V={class:"market overflow-y-auto flex-1 min-h-screen h-[80vh] p-2 relative itemContent"},W=["id"],q=["id","src","onLoad","onError","onClick"],z=["onClick"],G=[c("div",null,"查看详情",-1)],T=e({__name:"market",props:{type:{type:String,required:!1,default:"all"}},setup(e,{expose:b}){var B;const C=a(),U=null==(B=l())?void 0:B.appContext.config.globalProperties.$viewerApi;t();const E=s([]),K=s({}),j=s(0),D=s(160),I=s(0),R=s(10),S=s(10),F=s([]),J=s(null),L=s(0);n((()=>C.isLogin));const O=s(30),T=s(""),_=n((()=>O.value+R.value+150));i();const H=e,P=s();o.on("newData",(e=>{P.value=e}));const X=u({page:1,size:999,rec:1,squareType:H.type});function Z(){!function(){const{showName:e=0,showOther:a=0}={};j.value=15*[e,a].filter((e=>e)).length}(),function(){if(!J.value)return;const e=J.value.clientWidth;I.value=Math.floor(e/_.value);const a=e-I.value*_.value,l=(I.value-1)*R.value;a-l<0&&(I.value-=1);D.value=Math.floor((e-l)/I.value)}();const e=I.value,a=D.value,l=[];Y.value.forEach(((t,s)=>{let n=200,i=300;t.fileInfo&&(n=t.fileInfo.width||n,i=t.fileInfo.height||i);const o=i*(a/n)+S.value+j.value,u=K.value[t.id];if(l.length<e)u.style.top="0px",u.style.left=(a+R.value)*s+"px",l.push(o);else{const e=Math.min.apply(null,l),a=l.findIndex((a=>a===e));u.style.top=`${e+0}px`,u.style.left=a*(D.value+R.value)+"px",l[a]+=o}})),L.value=Math.max(...l)+130}const Y=n((()=>P.value?P.value.rows:T.value?E.value.filter((e=>{const{prompt:a}=e;return a.includes(T.value)})):E.value));r(O,(()=>{Z()}));let $=null;async function M(){const e=await h(X);E.value=e.data.rows}r(Y,(()=>{Y.value.length&&(clearTimeout($),$=setTimeout((()=>{Z()}),300))}));const ee=n((()=>e=>{let a=200,l=300;return e.fileInfo&&(a=e.fileInfo.width,l=e.fileInfo.height),l/(a/D.value)})),ae=N((function(){Z()}),200);return v((async()=>{await M(),Z(),window.addEventListener("resize",ae)})),b({handleQuery:e=>{X.squareType=e,M(),Z()}}),d((()=>{window.removeEventListener("resize",ae)})),(e,a)=>(g(),f("div",Q,[c("div",V,[c("div",{id:"wapper",ref_key:"wapperRef",ref:J,class:"wapper",style:p({height:`${L.value}px`})},[(g(!0),f(m,null,A(Y.value,((e,a)=>(g(),f("div",{id:e.id,key:a,ref_for:!0,ref:a=>function(e,a){e&&a&&(K.value[a.id]=e)}(a,e),class:"wapper-item",style:p({width:`${D.value}px`})},[y(x,{name:"img",css:!0},{default:w((()=>[c("img",{id:e.id,class:"item-file rounded-sm",style:p({width:`${D.value}px`,height:`${ee.value(e)}px`}),src:e.imageUrl,loading:"lazy",onLoad:a=>function(e,a){F.value.push(a.id)}(0,e),onError:a=>function(e,a){F.value.push(a.id)}(0,e),onClick:a=>function(e){U({options:{},images:[e.imageUrl]})}(e)},null,44,q)])),_:2},1024),c("div",{class:"menu",onClick:a=>function(e){o.emit("Details",!0),o.emit("DetailsData",e)}(e)},G,8,z),F.value.includes(e.id)?k("",!0):(g(),f("div",{key:0,class:"item-loading",style:p({width:`${D.value}px`,height:`${ee.value(e)}px`})},null,4))],12,W)))),128))],4)])]))}}),_=e=>(F("data-v-c90eedfa"),e=e(),J(),e),H={style:{position:"absolute"}},P=_((()=>c("div",{class:"mask"},null,-1))),X={class:"dark:bg-[#15171A] bg-[#fff] mainBox"},Z={key:0,class:"flex justify-center"},Y={style:{display:"flex","justify-content":"center","margin-top":"10px"}},$={class:"inpBox bg-[#EBEBEB] dark:bg-[#171726]"},M=[_((()=>c("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAe1JREFUOE+dlD1oFFEUhb8DKmphKom/CBILQdHCBBQhNmJAUlkFtRFEK0Fr7aw1sQhISCWSyjSSYKGgRCyihUbsUijGQmxU8AcVjnOXN+tkdnZn3dcs7Jv3vXPfPfeINsv2WmAXsBlYB/wCPgHvJP1udy7+V3nT9kbgGDAIrK84/AN4kX3zWNL3KvgqqO0dwFlgE/AReAm8BwK0AdgJHAC2AF+BO5JWyuAm1HYcOA84UzknabHD0wwBJ1OlU5Li4uZqQG1HmVdSubclfej0ZunMNuAi8DOr7Iak+G2sHBq3HgVmJT2vA+b7tg8Bp4CnkuaaUNtrgKvAF0k3uwUWwJeBPuC6pD8Npbb3AOeAB5Ke9AAdBkayJk5LWs6hR4BRYCr5sf9/4LZ3pwbfl/Qsh4YnTwC3gOPAXuBaXkqdcttbgUvAI0kPq5QGMBo2WbZJB3tVKm2+KfA22WRZ0nSdymStyjfNu/9Z0rjt08A+YEnSTB3Ydmv30225T+8Br4AzMaqSJjpBCz5dkDRfNn8vE7UduAB8AyZaJiqp7WX2IxLfAHclRWb8G9PCdHSTUgeB/pjAlK8D2ai+BmZycK95GvkQ0xeROAbsL4JboAXVxeSPLA1AS/LbDsZqcJ1lutkvgefbKu0GVvwmgQ8DK38BXh3TaV83jK0AAAAASUVORK5CYII=",alt:""},null,-1))),_((()=>c("p",null,"搜索",-1)))],ee={key:1,class:"flex w-full flex-j mb-2 items-center overflow-x-hidden justify-center",style:{"margin-top":"25px"}},ae={class:"relative z-40 transition-300 ease"},le=["onClick"],te={class:"pl-3 pr-3 pt-1 pb-1 whitespace-nowrap"},se={class:"flex-1 h-[82vh]",style:{padding:"0 200px","margin-bottom":"10px"}},ne=L(e({__name:"inspiration",setup(e){const{isMobile:a}=b(),l=s(),t=s(""),n=s(),i=s([]);(async()=>{const e=await j({page:1,size:100}).then((e=>e.data.rows));i.value=[{name:"全部",value:""}].concat(e)||D,l.value.handleQuery(t.value)})(),o.emit("drawRoute",B.options.history.location);const u=s(),r=s();function v(){let e={keyword:r.value,page:1,size:999};I(e).then((e=>{u.value=e.data,o.emit("newData",u.value)})),r.value=""}return(e,s)=>(g(),f(m,null,[c("div",H,[C(a)?k("",!0):(g(),U(O,{key:0}))]),P,c("div",X,[C(a)?k("",!0):(g(),f("div",Z)),c("div",Y,[c("div",$,[E(c("input",{class:"inp bg-[#f4f4f4] dark:bg-[#010102]","onUpdate:modelValue":s[0]||(s[0]=e=>r.value=e),type:"text",placeholder:"输入关键词"},null,512),[[K,r.value]]),c("div",{class:"iconBox",onClick:v},M)])]),C(a)?k("",!0):(g(),f("div",ee,[c("div",ae,[c("ul",{class:"flex justify-start items-center",ref_key:"tabListRef",ref:n},[(g(!0),f(m,null,A(i.value,(e=>(g(),f("li",{onClick:a=>{return s=e,t.value=s.value,l.value.handleQuery(s.value),void o.emit("newData","");var s},class:R(["mr-1 ml-1 w-auto select-none cursor-pointer hover:dark:text-[#fff] hover:text-[#fff] hover:bg-gradient-to-l from-[#2F73EC] to-[#5AA8F7] duration-300 flex rounded-3xl",[e.value===t.value?"text-[#fff] bg-gradient-to-l from-[#2F73EC] to-[#5AA8F7]  dark:text-[#fff]":"bg-[transparent] dark:bg-[transparent]"]])},[c("div",te,S(e.name),1)],10,le)))),256))],512)])])),c("div",se,[y(T,{ref_key:"marketRef",ref:l,type:t.value},null,8,["type"])])])],64))}}),[["__scopeId","data-v-c90eedfa"]]);export{ne as default};
