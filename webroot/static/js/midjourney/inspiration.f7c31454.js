import{d as e,b as a,ar as t,u as l,y as s,c as n,v as i,an as o,G as r,W as u,z as d,X as v,i as p,j as c,a3 as f,F as m,r as h,as as A,o as g,n as x,w as y,at as w,m as k,B as b,l as B,g as C,a5 as F,h as j,k as U,a1 as E,a2 as I,M as K,ac as R,au as S,av as D,C as L,D as J,E as W}from"../main-e1cb34e4.js";import{t as N}from"../throttle/throttle.33f09de3.js";import{c as O}from"../index/index.a4f65e28.js";import{S as P}from"../index/index.e39b3da2.js";import"../punycode@2.3.0/punycode@2.3.0.8a62a219.js";const Q={class:"overflow-hidden pr-0 h-full flex flex-col"},q={class:"market overflow-y-auto flex-1 min-h-screen h-[80vh] p-2 relative itemContent"},z=["id"],T=["id","src","onLoad","onError","onClick"],V={class:"menu p-2 text-[#cbd5e1]"},G={class:"prompt"},X={class:"flex justify-between items-end"},_=["onClick"],H=[c("span",{class:"text-[12px] pt-[2px] scale-90 dark:text-slate-400"},"画同款",-1)],Z=["onClick"],M=[c("span",{class:"text-[12px] pt-[2px] scale-90 dark:text-slate-400"},"复制",-1)],Y=e({__name:"market",props:{type:{type:String,required:!1,default:"all"}},setup(e,{expose:C}){var F;const j=a(),U=null==(F=t())?void 0:F.appContext.config.globalProperties.$viewerApi,E=l(),I=s([]),K=s({}),R=s(0),S=s(160),D=s(0),L=s(10),J=s(10),W=s([]),P=s(null),Y=s(0),$=n((()=>j.isLogin)),ee=s(30),ae=s(""),te=n((()=>ee.value+L.value+150)),le=i(),se=e,ne=s();o.on("newData",(e=>{ne.value=e}));const ie=r({page:1,size:999,rec:1,squareType:se.type});function oe(){!function(){const{showName:e=0,showOther:a=0}={};R.value=15*[e,a].filter((e=>e)).length}(),function(){if(!P.value)return;const e=P.value.clientWidth;D.value=Math.floor(e/te.value);const a=e-D.value*te.value,t=(D.value-1)*L.value;a-t<0&&(D.value-=1);S.value=Math.floor((e-t)/D.value)}();const e=D.value,a=S.value,t=[];re.value.forEach(((l,s)=>{let n=200,i=300;l.fileInfo&&(n=l.fileInfo.width||n,i=l.fileInfo.height||i);const o=i*(a/n)+J.value+R.value,r=K.value[l.id];if(t.length<e)r.style.top="0px",r.style.left=(a+L.value)*s+"px",t.push(o);else{const e=Math.min.apply(null,t),a=t.findIndex((a=>a===e));r.style.top=`${e+0}px`,r.style.left=a*(S.value+L.value)+"px",t[a]+=o}})),Y.value=Math.max(...t)+130}const re=n((()=>ne.value?ne.value.rows:ae.value?I.value.filter((e=>{const{prompt:a}=e;return a.includes(ae.value)})):I.value));u(ee,(()=>{oe()}));let ue=null;async function de(){const e=await A(ie);I.value=e.data.rows}u(re,(()=>{re.value.length&&(clearTimeout(ue),ue=setTimeout((()=>{oe()}),300))}));const ve=n((()=>e=>{let a=200,t=300;return e.fileInfo&&(a=e.fileInfo.width,t=e.fileInfo.height),t/(a/S.value)})),pe=N((function(){oe()}),200);return d((async()=>{await de(),oe(),window.addEventListener("resize",pe)})),C({handleQuery:e=>{ie.squareType=e,de(),oe()}}),v((()=>{window.removeEventListener("resize",pe)})),(e,a)=>(g(),p("div",Q,[c("div",q,[c("div",{id:"wapper",ref_key:"wapperRef",ref:P,class:"wapper",style:f({height:`${Y.value}px`})},[(g(!0),p(m,null,h(re.value,((e,a)=>(g(),p("div",{id:e.id,key:a,ref_for:!0,ref:a=>function(e,a){e&&a&&(K.value[a.id]=e)}(a,e),class:"wapper-item",style:f({width:`${S.value}px`})},[x(w,{name:"img",css:!0},{default:y((()=>[c("img",{id:e.id,class:"item-file rounded-sm",style:f({width:`${S.value}px`,height:`${ve.value(e)}px`}),src:e.imageUrl,loading:"lazy",onLoad:a=>function(e,a){W.value.push(a.id)}(0,e),onError:a=>function(e,a){W.value.push(a.id)}(0,e),onClick:a=>function(e){U({options:{},images:[e.imageUrl]})}(e)},null,44,T)])),_:2},1024),c("div",V,[c("div",G,k(e.fullPrompt),1),c("div",X,[c("button",{class:"flex mr-2 h-4 w-10 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:b((a=>(e=>{j.updatePromptWords({prompt:e.fullPrompt}),le.push("/midjourney?id=textToImage")})(e)),["stop"])},H,8,_),c("button",{class:"flex h-4 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:b((a=>function(e){if(!$.value)return j.setLoginDialog(!0);const{prompt:a}=e;O({text:a}),E.success("复制prompt成功")}(e)),["stop"])},M,8,Z)])]),W.value.includes(e.id)?B("",!0):(g(),p("div",{key:0,class:"item-loading",style:f({width:`${S.value}px`,height:`${ve.value(e)}px`})},null,4))],12,z)))),128))],4)])]))}}),$=e=>(L("data-v-e2e008c1"),e=e(),J(),e),ee={style:{position:"absolute"}},ae={key:0,class:"flex justify-center"},te={style:{display:"flex","justify-content":"center","margin-top":"10px"}},le={class:"inpBox bg-[#EBEBEB] dark:bg-[#171726]"},se=[$((()=>c("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAe1JREFUOE+dlD1oFFEUhb8DKmphKom/CBILQdHCBBQhNmJAUlkFtRFEK0Fr7aw1sQhISCWSyjSSYKGgRCyihUbsUijGQmxU8AcVjnOXN+tkdnZn3dcs7Jv3vXPfPfeINsv2WmAXsBlYB/wCPgHvJP1udy7+V3nT9kbgGDAIrK84/AN4kX3zWNL3KvgqqO0dwFlgE/AReAm8BwK0AdgJHAC2AF+BO5JWyuAm1HYcOA84UzknabHD0wwBJ1OlU5Li4uZqQG1HmVdSubclfej0ZunMNuAi8DOr7Iak+G2sHBq3HgVmJT2vA+b7tg8Bp4CnkuaaUNtrgKvAF0k3uwUWwJeBPuC6pD8Npbb3AOeAB5Ke9AAdBkayJk5LWs6hR4BRYCr5sf9/4LZ3pwbfl/Qsh4YnTwC3gOPAXuBaXkqdcttbgUvAI0kPq5QGMBo2WbZJB3tVKm2+KfA22WRZ0nSdymStyjfNu/9Z0rjt08A+YEnSTB3Ydmv30225T+8Br4AzMaqSJjpBCz5dkDRfNn8vE7UduAB8AyZaJiqp7WX2IxLfAHclRWb8G9PCdHSTUgeB/pjAlK8D2ai+BmZycK95GvkQ0xeROAbsL4JboAXVxeSPLA1AS/LbDsZqcJ1lutkvgefbKu0GVvwmgQ8DK38BXh3TaV83jK0AAAAASUVORK5CYII=",alt:""},null,-1))),$((()=>c("p",null,"搜索",-1)))],ne={key:1,class:"flex w-full flex-j mb-2 items-center overflow-x-hidden justify-center",style:{"margin-top":"25px"}},ie={class:"relative z-40 transition-300 ease"},oe=["onClick"],re={class:"pl-3 pr-3 pt-1 pb-1 whitespace-nowrap"},ue={class:"flex-1 h-[82vh]",style:{padding:"0 200px"}},de=W(e({__name:"inspiration",setup(e){const{isMobile:a}=C(),t=s(),l=s(""),n=s(),i=s([]);(async()=>{const e=await R({page:1,size:100}).then((e=>e.data.rows));i.value=[{name:"全部",value:""}].concat(e)||S,t.value.handleQuery(l.value)})(),o.emit("drawRoute",F.options.history.location);const r=s(),u=s();function d(){let e={keyword:u.value,page:1,size:999};D(e).then((e=>{r.value=e.data,o.emit("newData",r.value)})),u.value=""}return(e,s)=>(g(),p(m,null,[c("div",ee,[j(a)?B("",!0):(g(),U(P,{key:0}))]),c("div",{class:K(["h-full overflow-hidden dark:bg-[#1F1F38] bg-[#FFFFFF]",[j(a)?"p-0":"p-3"]])},[j(a)?B("",!0):(g(),p("div",ae)),c("div",te,[c("div",le,[E(c("input",{class:"inp bg-[#F4F4F5] dark:bg-[#171726]","onUpdate:modelValue":s[0]||(s[0]=e=>u.value=e),type:"text",placeholder:"输入关键词"},null,512),[[I,u.value]]),c("div",{class:"iconBox",onClick:d},se)])]),j(a)?B("",!0):(g(),p("div",ne,[c("div",ie,[c("ul",{class:"flex justify-start items-center",ref_key:"tabListRef",ref:n},[(g(!0),p(m,null,h(i.value,(e=>(g(),p("li",{onClick:a=>{return s=e,l.value=s.value,t.value.handleQuery(s.value),void o.emit("newData","");var s},class:K(["mr-1 ml-1 w-auto select-none cursor-pointer hover:dark:text-[#fff] hover:text-[#fff] hover:bg-gradient-to-l from-[#2F73EC] to-[#5AA8F7] duration-300 flex rounded-3xl",[e.value===l.value?"text-[#fff] bg-gradient-to-l from-[#2F73EC] to-[#5AA8F7]  dark:text-[#fff]":"bg-[transparent] dark:bg-[transparent]"]])},[c("div",re,k(e.name),1)],10,oe)))),256))],512)])])),c("div",ue,[x(Y,{ref_key:"marketRef",ref:t,type:l.value},null,8,["type"])])],2)],64))}}),[["__scopeId","data-v-e2e008c1"]]);export{de as default};
