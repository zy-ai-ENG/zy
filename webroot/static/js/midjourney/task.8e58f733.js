import{d as e,C as s,D as t,a,_ as i,L as r,F as l,G as o,H as n,J as u,w as c,z as d,M as p,r as m,E as v,K as f}from"../main-bb4220d0.js";import{d as g,n as x,M as h,N as k,o as _,a as y,Q as b,F as j,b as w,c as E,R as C,t as U,m as T,p as R,J as I,x as A}from"../@vue_runtime-core@3.2.47/@vue_runtime-core@3.2.47.e62b9a68.js";import{x as S,i as V,r as O,j as F}from"../@vue_reactivity@3.2.47/@vue_reactivity@3.2.47.859737a0.js";import{V as M,W as L,d as z,e as N,n as D,w as P,p as q,x as B,E as G,a3 as X}from"../naive-ui@2.34.3_vue@3.2.47/naive-ui@2.34.3_vue@3.2.47.d79924d9.js";import{a as Z}from"../axios@1.4.0/axios@1.4.0.5ae1da96.js";import{c as J}from"../index/index.a4f65e28.js";import{d as W}from"../draw-fail/draw-fail.50b43169.js";import{u as Y}from"../index/index.8caa2cec.js";import{J as H,n as Q,o as K}from"../@vue_shared@3.2.47/@vue_shared@3.2.47.9d8e617e.js";import{a as $}from"../vue-router@4.1.6_vue@3.2.47/vue-router@4.1.6_vue@3.2.47.018c715a.js";import{S as ee}from"../index/index.bf6210d7.js";import"../@vue_runtime-dom@3.2.47/@vue_runtime-dom@3.2.47.298398d5.js";import"../v-viewer@3.0.11_vue@3.2.47/v-viewer@3.0.11_vue@3.2.47.a81e5850.js";import"../viewerjs@1.11.3/viewerjs@1.11.3.a76d4126.js";import"../clientjs@0.2.1/clientjs@0.2.1.7f53d864.js";import"../@babel_runtime@7.21.5/@babel_runtime@7.21.5.35f69bd2.js";import"../crypto-js@4.1.1/crypto-js@4.1.1.7142fa56.js";import"../@iconify_vue@4.1.1_vue@3.2.47/@iconify_vue@4.1.1_vue@3.2.47.612da1cd.js";import"../pinia@2.0.35_typescript@4.9.5_vue@3.2.47/pinia@2.0.35_typescript@4.9.5_vue@3.2.47.1425f1b3.js";import"../vue-demi@0.14.7_vue@3.2.47/vue-demi@0.14.7_vue@3.2.47.71ba0ef2.js";import"../vue-i18n@9.2.2_vue@3.2.47/vue-i18n@9.2.2_vue@3.2.47.f7da0a53.js";import"../@intlify_shared@9.2.2/@intlify_shared@9.2.2.76c1dc14.js";import"../@intlify_core-base@9.2.2/@intlify_core-base@9.2.2.72ca16dd.js";import"../@intlify_message-compiler@9.2.2/@intlify_message-compiler@9.2.2.9b2b247d.js";import"../@intlify_devtools-if@9.2.2/@intlify_devtools-if@9.2.2.1be0989c.js";import"../vooks@0.2.12_vue@3.2.47/vooks@0.2.12_vue@3.2.47.89d56bd5.js";import"../evtd@0.2.4/evtd@0.2.4.2789e4a1.js";import"../katex@0.16.7/katex@0.16.7.43835b5c.js";import"../@vueuse_core@9.13.0_vue@3.2.47/@vueuse_core@9.13.0_vue@3.2.47.770e5818.js";import"../@vueuse_shared@9.13.0_vue@3.2.47/@vueuse_shared@9.13.0_vue@3.2.47.58cbe97f.js";import"../mitt@3.0.1/mitt@3.0.1.f0e54764.js";import"../@vicons_ionicons5@0.12.0/@vicons_ionicons5@0.12.0.5fe57882.js";import"../marked@4.3.0/marked@4.3.0.cb1ff4ec.js";import"../date-fns@2.30.0/date-fns@2.30.0.bcce45e8.js";import"../vue-clipboard3@2.0.0/vue-clipboard3@2.0.0.ebf9d56c.js";import"../clipboard@2.0.11/clipboard@2.0.11.6a7b8915.js";import"../@vueuse_integrations@10.2.0_axios@1.4.0_qrcode@1.5.3_vue@3.2.47/@vueuse_integrations@10.2.0_axios@1.4.0_qrcode@1.5.3_vue@3.2.47.a70167c7.js";import"../@vueuse_shared@10.2.0_vue@3.2.47/@vueuse_shared@10.2.0_vue@3.2.47.3d57d69b.js";import"../qrcode@1.5.3/qrcode@1.5.3.ae99ec0a.js";import"../encode-utf8@1.0.3/encode-utf8@1.0.3.2ec93547.js";import"../dijkstrajs@1.0.3/dijkstrajs@1.0.3.38d0b2a1.js";import"../seemly@0.3.6/seemly@0.3.6.21da59ee.js";import"../vueuc@0.4.51_vue@3.2.47/vueuc@0.4.51_vue@3.2.47.ce1cbfa6.js";import"../@css-render_vue3-ssr@0.15.12_vue@3.2.47/@css-render_vue3-ssr@0.15.12_vue@3.2.47.e49104bd.js";import"../vdirs@0.1.8_vue@3.2.47/vdirs@0.1.8_vue@3.2.47.bf970686.js";import"../@juggle_resize-observer@3.4.0/@juggle_resize-observer@3.4.0.80d14552.js";import"../css-render@0.15.12/css-render@0.15.12.af3f05a4.js";import"../@emotion_hash@0.8.0/@emotion_hash@0.8.0.b17c1a96.js";import"../lodash-es@4.17.21/lodash-es@4.17.21.6a776102.js";import"../treemate@0.3.11/treemate@0.3.11.05d63ee5.js";import"../async-validator@4.2.5/async-validator@4.2.5.8d480e59.js";import"../@css-render_plugin-bem@0.15.12_css-render@0.15.12/@css-render_plugin-bem@0.15.12_css-render@0.15.12.0c2c3e5c.js";const se=g({__name:"taskTab",props:{active:{type:Number,required:!0,default:0}},emits:["change"],setup(a,{emit:i}){const r=a,{isMobile:l}=e(),o=x((()=>r.active)),n=e=>{i("change",s[e])},u=x((()=>l?"width: auto; text-align: center;":"min-width: 90px; text-align: center;"));return(e,s)=>(_(),h(S(L),{size:S(l)?"small":"large",modelValue:S(o),"onUpdate:modelValue":s[0]||(s[0]=e=>V(o)?o.value=e:null),type:"card",animated:"",trigger:"click","tab-style":S(u),"onUpdate:value":n},{default:k((()=>[(_(!0),y(j,null,b(S(t),(e=>(_(),h(S(M),{key:e.label,name:e.label},null,8,["name"])))),128))])),_:1},8,["size","modelValue","tab-style"]))}}),te={class:"border box-border border-[#eaeaef] dark:border-[#444456] rounded-xl min-h-fit flex-1"},ae={class:"pt-2 px-1 pb-1"},ie={class:"flex justify-between items-center"},re={class:"border pt-0.5 px-1 text-[12px] scale-95 rounded dark:text-[#00FFC0] dark:border-[#00FFC0] text-[#001EEF] border-[#001EEF]"},le={class:"flex justify-between"},oe=w("div",null," 发布到广场 ",-1),ne=w("div",null," 复制最终执行提示词 ",-1),ue=w("div",null," 下载图片 ",-1),ce=w("div",null," 删除任务 ",-1),de=w("div",null," 收藏此任务 ",-1),pe={class:"my-2"},me={class:"whitespace-nowrap overflow-hidden text-ellipsis"},ve={key:0,class:"bg-[#f0f0f0] dark:bg-[#454567] h-full w-full flex flex-col justify-center items-center"},fe=["src"],ge={key:1,class:"bg-[#f0f0f0] dark:bg-[#454567] h-full w-full flex flex-col justify-center items-center"},xe=["src"],he={key:2,class:"bg-[#f0f0f0] dark:bg-[#454567] h-full w-full flex flex-col justify-center items-center"},ke=["src"],_e={key:4,class:"flex items-center justify-center flex-col"},ye={class:"px-2 py-2 rounded-br-xl rounded-bl-xl h-[130px]"},be={key:0,class:"flex justify-center h-[80px]"},je={key:0,class:"progress"},we=w("span",null,"：",-1),Ee={style:{color:"red"}},Ce={key:1,class:"flex items-center justify-center h-[80px]"},Ue={class:"text-center flex items-center"},Te={key:2,class:"h-[80px]",style:{"padding-left":"70px"}},Re={class:"flex justify-start items-center py-0.5 mb-1"},Ie={class:"flex justify-start"},Ae=["disabled","onClick"],Se={key:0,class:"text-[12px] pt-[2px] line-clamp-1 text-left"},Ve={key:1},Oe={class:"flex justify-between text-[12px] mt-4 select-none"},Fe={class:"text-[#3144F1] dark:text-[#fff]",style:{color:"#3144F1"}},Me=g({__name:"taskItem1",props:{task:{type:Object,default:()=>({prompt:"",image:"",time:"",updatedAt:""})},chat:{type:String,default:"task"}},emits:["fresh"],setup(e,{emit:s}){const t=e,{updateSendSquire:m,updateDrawId:v,updatePreview:f}=a(),g=z(),T=N(),R=Y(),I=a(),A=x((()=>e=>{const{progress:s,status:t}=e;return 1===t?"正在排队中...":3===t?"成功":2===t&&100!==s?"正在绘制中...":2===t&&100===s?"正在存储图片中...":4===t?"绘图失败":5===t?"绘图取消":6===t?"窗口等待":"绘图失败"})),V=x((()=>e=>1===e?"排队中":2===e?"绘制中":3===e?"成功":4===e?"失败":5===e?"超时":"-")),O=x((()=>e=>{if(!e)return"";return parseInt(e/60+"")+"分"+parseInt(String(e%60))+"秒"})),F=x((()=>e=>o[e])),M=x((()=>{var e;const s=(null==(e=t.task)?void 0:e.buttons)||[],a=[],i=[],r=[],l=[],o=[];return s.forEach((e=>{["U1","U2","U3","U4"].includes(e.label)?a.push(e):["V1","V2","V3","V4"].includes(e.label)?i.push(e):e.label.startsWith("Upscale")||e.label.startsWith("Vary")?r.push(e):e.label?l.push(e):o.push(e)})),[a,i,r,l,o].filter((e=>e.length))}));const L=async(e,t)=>{if(!I.isLogin)return T.warning("请先登录"),void I.setLoginDialog(!0);const a=(e=>{if(["U1","U2","U3","U4"].includes(e.label))return p.U_SCALE;if(["V1","V2","V3","V4"].includes(e.label))return p.V_EXPAND;if(!e.label&&e.emoji){if("🔄"===e.emoji)return p.REGENERATE;if(["⬅️","➡️","⬆️","⬇️"].includes(e.emoji))return p.STRETCH;if(["1️⃣","2️⃣","3️⃣","4️⃣"].includes(e.emoji))return p.IMAGE_TO_TEXT_ACTION}return e.label.includes("Upscale (4x)")?p.UPSCALE_4X:e.label.includes("Upscale (2x)")?p.UPSCALE_2X:e.label.includes("Vary (Subtle)")?p.VARY_SUBTLE:e.label.includes("Vary (Strong)")?p.VARY_STRONG:e.label.includes("Vary (Region)")?p.VARY_REGION:e.label.includes("Make Square")?p.SQUARE:e.label.includes("Zoom Out 2x")?p.ZOOM2X:e.label.includes("Zoom Out 1.5x")?p.ZOOM1_5X:e.label.includes("Custom Zoom")?p.ZOOM_CUSTOM:e.label.includes("Redo Upscale (Subtle)")?p.REDO_UPSCALE_SUBTLE:e.label.includes("Redo Upscale (Creative)")?p.REDO_UPSCALE_CREATIVE:p.NONE})(t);await async function(e){const s=await c({type:d.IMAGE_ACTION,params:e}).then((e=>e.data));v({id:s}),s&&T.success("提交任务成功！")}({action:a,taskId:e.id,customId:t.customId,messageFlags:e.messageFlags||0}),s("fresh")};return(t,a)=>(_(),y("div",te,[w("div",ae,[w("div",ie,[w("p",re,H(S(F)(e.task.action))+" - "+H(S(V)(e.task.status))+" - "+H(S(O)(e.task.durationSpent)||""),1),w("div",le,[3===e.task.status?(_(),h(S(D),{key:0,placement:"top-start",trigger:"hover"},{trigger:k((()=>[E(S(i),{icon:"bi:send",onClick:a[0]||(a[0]=s=>(async e=>{m(!0,e.id)})(e.task)),class:"text-[14px] mx-1 cursor-pointer"})])),default:k((()=>[oe])),_:1})):C("",!0),E(S(D),{placement:"top-start",trigger:"hover"},{trigger:k((()=>[E(S(i),{icon:"ph:copy-light",onClick:a[1]||(a[1]=s=>(e=>{const{fullPrompt:s}=e;J({text:s}),T.success("复制prompt完成！")})(e.task)),class:"text-[14px] mx-1 cursor-pointer"})])),default:k((()=>[ne])),_:1}),3===e.task.status?(_(),h(S(D),{key:1,placement:"top-start",trigger:"hover"},{trigger:k((()=>[E(S(i),{icon:"icons8:down-round",onClick:a[2]||(a[2]=s=>async function({imageUrl:e}){e?g.info({title:"下载图片",content:"是否确认下载当前图片",positiveText:"下载",negativeText:"取消",onPositiveClick:async()=>{const s=e.split("/"),t=await Z.post("/api/midjourney/download",{url:e},{responseType:"blob"}),a=new Blob([t.data],{type:t.headers["content-type"]}),i=window.URL.createObjectURL(a),r=document.createElement("a");r.href=i,r.download=s[s.length-1],r.click()}}):T.warning("图片未生成完成暂不能下载")}(e.task)),class:"text-[14px] mx-1 cursor-pointer"})])),default:k((()=>[ue])),_:1})):C("",!0),E(S(D),{placement:"top-start",trigger:"hover"},{trigger:k((()=>[E(S(i),{onClick:a[3]||(a[3]=t=>(e=>{const{favorite:t}=e;g.create({type:"info",title:"确认删除",content:(1===t?"当前任务已被收藏，删除绘画任务会导致收藏失效且不可找回，确定删除":"删除绘画任务不可找回，确定删除")+"？",positiveText:"确定",negativeText:"取消",maskClosable:!1,onPositiveClick:async()=>{await u({id:e.id}).then((e=>e.data))&&T.success("删除成功"),s("fresh")},onNegativeClick:()=>{}})})(e.task)),icon:"ep:delete",class:"text-[14px] mx-1 cursor-pointer"})])),default:k((()=>[ce])),_:1}),E(S(D),{placement:"top-start",trigger:"hover"},{trigger:k((()=>[E(S(i),{onClick:a[4]||(a[4]=t=>(async e=>{const{id:t,favorite:a}=e;await n({id:t,favorite:1===a?0:1}).then((e=>e.data))&&T.success((0===a?"收藏":"取消收藏")+" 成功"),s("fresh")})(e.task)),icon:0===e.task.favorite?"uit:favorite":"uis:favorite",class:"text-[14px] mx-1 cursor-pointer"},null,8,["icon"])])),default:k((()=>[de])),_:1})])]),w("div",pe,[E(S(D),{placement:"top",trigger:"hover",width:320},{trigger:k((()=>[w("h3",me,H(e.task.prompt),1)])),default:k((()=>[w("div",null,H(e.task.prompt),1)])),_:1})]),w("div",{class:Q(["relative z-0 w-auto flex align-center min-h-[260px] overflow-hidden contain",["chat-history"===e.chat?"h-[320px]":"h-[260px] "]]),style:{"justify-content":"center"}},[4===e.task.status?(_(),y("div",ve,[w("img",{class:"w-auto object-contain px-24",src:S(W),alt:""},null,8,fe)])):5===e.task.status?(_(),y("div",ge,[w("img",{class:"w-auto object-contain px-24",src:S(W),alt:""},null,8,xe)])):6===e.task.status?(_(),y("div",he,[w("img",{class:"w-auto object-contain px-24",src:S(W),alt:""},null,8,ke)])):e.task.imageUrl||e.task.progress?(_(),y("div",_e,[E(S(P),{class:"w-full cursor-pointer bg-[#f9f9f9] dark:bg-[transparent] h-full flex justify-center","preview-src":e.task.imageUrl,"object-fit":"contain",src:e.task.imageUrl||""},null,8,["preview-src","src"])])):(_(),h(r,{key:3,progress:e.task.progress},null,8,["progress"]))],2)]),w("div",ye,[e.task.imageUrl||null!==e.task.progress?C("",!0):(_(),y("div",be,[S(A)(e.task)?(_(),y("div",je,[w("span",null,H(S(A)(e.task)),1),4===e.task.status?(_(),y(j,{key:0},[we,w("span",Ee,H(e.task.failReason),1)],64)):C("",!0),6===e.task.status?(_(),h(S(q),{key:1,type:"primary",style:{"margin-left":"12px"},onClick:a[5]||(a[5]=s=>{var t;9===(t=e.task).action?R.openRegionModal(!0,{customId:t.customId,taskId:t.id,mode:t.mode}):I.updateRemixModal(!0,{prompt:"",taskId:t.id,customId:t.customId})})},{default:k((()=>[U(" 补充描述词 ")])),_:1})):C("",!0)])):C("",!0)])),null!==e.task.progress&&e.task.progress>=0&&e.task.progress<100?(_(),y("div",Ce,[w("p",Ue,[E(S(i),{icon:"eos-icons:bubble-loading",class:"mr-1"}),U(" 进度："+H(e.task.progress+"%"),1)])])):C("",!0),100===e.task.progress?(_(),y("div",Te,[(_(!0),y(j,null,b(S(M),(s=>(_(),y("div",Re,[w("div",Ie,[(_(!0),y(j,null,b(s,(s=>(_(),h(S(D),{trigger:"hover"},{trigger:k((()=>[w("button",{disabled:3!==e.task.status,class:Q([[3!==e.task.status?"cursor-not-allowed":""],"text-[14px] border border-gray-300 dark:border-gray-600 hover:text-white hover:bg-gradient-to-l from-[#2F73EC] to-[#5AA8F7] px-1 flex items-center justify-center rounded"]),style:{margin:"0 4px"},onClick:t=>L(e.task,s)},[s.label?(_(),y("p",Se,H(s.label),1)):(_(),y("p",Ve,H(s.emoji),1))],10,Ae)])),default:k((()=>[w("p",null,H(s.label||s.emoji),1)])),_:2},1024)))),256))])])))),256))])):C("",!0),w("div",Oe,[w("div",null,[w("p",Fe,"时间："+H(S(l)(e.task.createdAt)),1)]),w("div",null,[w("p",{style:K({color:1===e.task.mode?"#F1A231":2===e.task.mode?"#fff":3===e.task.mode?"#23DCB5":"red"})},H(1===e.task.mode?"快速模式":2===e.task.mode?"慢速模式":3===e.task.mode?"Turbo模式":"模式错误"),5)])])])]))}}),Le={style:{position:"absolute"}},ze={class:"h-full overflow-y-auto pb-2 max-h-[calc(80vh)]"},Ne={key:0,class:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4"},De={class:"mb-4 border border-gray-200 dark:border-gray-600 p-2 rounded-xl"},Pe={class:"flex justify-between"},qe={class:"flex justify-between"},Be={key:1},Ge={class:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4"},Xe={class:""},Ze={key:2},Je={class:"flex justify-center items-center"},We={id:"footer",ref:"containerRef"},Ye=g({__name:"task",setup(s){const t=$(),i=O(0),r=O(0),l=O(!1),o=Y(),n=x((()=>o.openRegionDialog)),{isMobile:u}=e(),c=x((()=>r.value>U.size)),d=a(),p=e=>{i.value=e,6!==e?(U.status=e,U.favorite=0):(U.status=0,U.favorite=1),M()},g=O([]),U=F({page:1,size:20,status:0,favorite:0});T((()=>n.value),(e=>{e?(l.value=!1,V.value&&clearTimeout(V.value)):M()}));const V=O(),M=async()=>{const{rows:e,count:s}=await f(U).then((e=>e.data));g.value=e,r.value=s,V.value&&clearTimeout(V.value),!n.value&&t.fullPath.includes("/midjourney/paint-task")&&(V.value=setTimeout((async()=>{await M()}),6e3))};R((()=>{M();const e=document.getElementById("footer");new IntersectionObserver(((e,s)=>{e.forEach((e=>{e.isIntersecting&&c.value&&(U.size=U.size+10,M())}))})).observe(e)})),I((()=>{V.value&&clearTimeout(V.value)})),A((()=>{d.updateDrawId({id:""})}));const L=O(m.options.history.location);return v.emit("drawRoute",m.options.history.location),(e,s)=>(_(),y(j,null,[w("div",Le,[S(u)?C("",!0):(_(),h(ee,{key:0,toTask:L.value},null,8,["toTask"]))]),w("div",{class:Q(["w-full",S(u)?"h-full p-2":""]),style:{padding:"40px 75px 0 145px"}},[E(se,{onChange:p,active:i.value},null,8,["active"]),w("div",ze,[w("div",null,[l.value&&0===g.value.length?(_(),y("div",Ne,[(_(),y(j,null,b(10,(e=>w("div",De,[E(S(G),{vertical:""},{default:k((()=>[w("div",Pe,[E(S(B),{height:"20px",width:"48%",class:"mt-1",sharp:!1}),E(S(B),{height:"20px",width:"48%",class:"mt-1",sharp:!1})]),E(S(B),{height:"20px",width:"100%",class:"mt-1",sharp:!1}),E(S(B),{height:"180px",width:"100%",class:"mt-1",sharp:!1}),E(S(B),{height:"20px",width:"60%",class:"mt-1",sharp:!1}),E(S(B),{height:"20px",width:"40%",class:"mt-1",sharp:!1}),E(S(B),{height:"20px",width:"20%",class:"mt-1",sharp:!1}),w("div",qe,[E(S(B),{height:"20px",width:"48%",class:"mt-1",sharp:!1}),E(S(B),{height:"20px",width:"48%",class:"mt-1",sharp:!1})])])),_:1})]))),64))])):g.value.length>0?(_(),y("div",Be,[w("div",Ge,[(_(!0),y(j,null,b(g.value,(e=>(_(),y("div",Xe,[E(Me,{task:e,class:"mb-4",onFresh:M},null,8,["task"])])))),256))])])):(_(),y("div",Ze,[w("div",Je,[E(S(X),{description:"未查询到任务"})])])),w("div",We,null,512)])])],2)],64))}});export{Ye as default};
