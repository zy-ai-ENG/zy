var e=Object.defineProperty,t=(t,s,i)=>(((t,s,i)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i})(t,"symbol"!=typeof s?s+"":s,i),i);import{u as s,a as i}from"../vue-router@4.1.6_vue@3.2.47/vue-router@4.1.6_vue@3.2.47.018c715a.js";import{a,s as o,v as n,w as r,M as l,x as d,y as h,S as c,z as u,E as m,d as p}from"../main-bb4220d0.js";import{d as v,n as g,o as w,M as f,N as b,c as y,t as j,b as _,m as k,a as P,R as x,Q as I,F as C,P as S}from"../@vue_runtime-core@3.2.47/@vue_runtime-core@3.2.47.e62b9a68.js";import{e as R,p as L,P as M,C as z,r as T,y as D,V as U,W as q}from"../naive-ui@2.34.3_vue@3.2.47/naive-ui@2.34.3_vue@3.2.47.d79924d9.js";import{j as E,r as A,x as F,i as B}from"../@vue_reactivity@3.2.47/@vue_reactivity@3.2.47.859737a0.js";import{u as W}from"../index/index.8caa2cec.js";import"../@iconify_vue@4.1.1_vue@3.2.47/@iconify_vue@4.1.1_vue@3.2.47.612da1cd.js";import{p as G}from"../paper@0.12.17/paper@0.12.17.4de81faa.js";import{n as O}from"../@vue_shared@3.2.47/@vue_shared@3.2.47.9d8e617e.js";import"../@vue_runtime-dom@3.2.47/@vue_runtime-dom@3.2.47.298398d5.js";import"../v-viewer@3.0.11_vue@3.2.47/v-viewer@3.0.11_vue@3.2.47.a81e5850.js";import"../viewerjs@1.11.3/viewerjs@1.11.3.a76d4126.js";import"../clientjs@0.2.1/clientjs@0.2.1.7f53d864.js";import"../@babel_runtime@7.21.5/@babel_runtime@7.21.5.35f69bd2.js";import"../crypto-js@4.1.1/crypto-js@4.1.1.7142fa56.js";import"../pinia@2.0.35_typescript@4.9.5_vue@3.2.47/pinia@2.0.35_typescript@4.9.5_vue@3.2.47.1425f1b3.js";import"../vue-demi@0.14.7_vue@3.2.47/vue-demi@0.14.7_vue@3.2.47.71ba0ef2.js";import"../axios@1.4.0/axios@1.4.0.5ae1da96.js";import"../vue-i18n@9.2.2_vue@3.2.47/vue-i18n@9.2.2_vue@3.2.47.f7da0a53.js";import"../@intlify_shared@9.2.2/@intlify_shared@9.2.2.76c1dc14.js";import"../@intlify_core-base@9.2.2/@intlify_core-base@9.2.2.72ca16dd.js";import"../@intlify_message-compiler@9.2.2/@intlify_message-compiler@9.2.2.9b2b247d.js";import"../@intlify_devtools-if@9.2.2/@intlify_devtools-if@9.2.2.1be0989c.js";import"../vooks@0.2.12_vue@3.2.47/vooks@0.2.12_vue@3.2.47.89d56bd5.js";import"../evtd@0.2.4/evtd@0.2.4.2789e4a1.js";import"../katex@0.16.7/katex@0.16.7.43835b5c.js";import"../@vueuse_core@9.13.0_vue@3.2.47/@vueuse_core@9.13.0_vue@3.2.47.770e5818.js";import"../@vueuse_shared@9.13.0_vue@3.2.47/@vueuse_shared@9.13.0_vue@3.2.47.58cbe97f.js";import"../mitt@3.0.1/mitt@3.0.1.f0e54764.js";import"../@vicons_ionicons5@0.12.0/@vicons_ionicons5@0.12.0.5fe57882.js";import"../marked@4.3.0/marked@4.3.0.cb1ff4ec.js";import"../date-fns@2.30.0/date-fns@2.30.0.bcce45e8.js";import"../vue-clipboard3@2.0.0/vue-clipboard3@2.0.0.ebf9d56c.js";import"../clipboard@2.0.11/clipboard@2.0.11.6a7b8915.js";import"../@vueuse_integrations@10.2.0_axios@1.4.0_qrcode@1.5.3_vue@3.2.47/@vueuse_integrations@10.2.0_axios@1.4.0_qrcode@1.5.3_vue@3.2.47.a70167c7.js";import"../@vueuse_shared@10.2.0_vue@3.2.47/@vueuse_shared@10.2.0_vue@3.2.47.3d57d69b.js";import"../qrcode@1.5.3/qrcode@1.5.3.ae99ec0a.js";import"../encode-utf8@1.0.3/encode-utf8@1.0.3.2ec93547.js";import"../dijkstrajs@1.0.3/dijkstrajs@1.0.3.38d0b2a1.js";import"../seemly@0.3.6/seemly@0.3.6.21da59ee.js";import"../vueuc@0.4.51_vue@3.2.47/vueuc@0.4.51_vue@3.2.47.ce1cbfa6.js";import"../@css-render_vue3-ssr@0.15.12_vue@3.2.47/@css-render_vue3-ssr@0.15.12_vue@3.2.47.e49104bd.js";import"../vdirs@0.1.8_vue@3.2.47/vdirs@0.1.8_vue@3.2.47.bf970686.js";import"../@juggle_resize-observer@3.4.0/@juggle_resize-observer@3.4.0.80d14552.js";import"../css-render@0.15.12/css-render@0.15.12.af3f05a4.js";import"../@emotion_hash@0.8.0/@emotion_hash@0.8.0.b17c1a96.js";import"../lodash-es@4.17.21/lodash-es@4.17.21.6a776102.js";import"../treemate@0.3.11/treemate@0.3.11.05d63ee5.js";import"../async-validator@4.2.5/async-validator@4.2.5.8d480e59.js";import"../@css-render_plugin-bem@0.15.12_css-render@0.15.12/@css-render_plugin-bem@0.15.12_css-render@0.15.12.0c2c3e5c.js";import"../acorn@8.8.2/acorn@8.8.2.6e4df5ac.js";const N={class:"my-8"},Z=_("div",null,"选择广场类型",-1),V=v({__name:"sendInspireSquire",setup(e){const t=R(),s=a(),i=g((()=>s.sendSquareDialog)),r=g((()=>s.sendSquareTaskId)),l=E({id:r.value,squareType:""}),d=A([]),h=async()=>{await o({id:r.value,squareType:l.squareType})&&t.success("发布到广场成功"),s.updateSendSquire(!1,0)},c=async()=>{d.value=await n({page:1,size:20}).then((e=>e.data.rows)),d.value.length&&(l.squareType=d.value[0].value)};return(e,t)=>(w(),f(F(z),{show:F(i),"onUpdate:show":t[2]||(t[2]=e=>B(i)?i.value=e:null),"mask-closable":!1,"show-icon":!1,preset:"dialog",title:"发布到广场",onAfterEnter:c,onClose:t[3]||(t[3]=e=>F(s).updateSendSquire(!1,0))},{action:b((()=>[y(F(L),{round:"",onClick:t[1]||(t[1]=e=>F(s).updateSendSquire(!1,0))},{default:b((()=>[j("取消")])),_:1}),y(F(L),{round:"",type:"primary",onClick:h},{default:b((()=>[j("发布")])),_:1})])),default:b((()=>[_("div",N,[Z,y(F(M),{value:l.squareType,"onUpdate:value":t[0]||(t[0]=e=>l.squareType=e),placeholder:"选择广场类型","label-field":"name",options:d.value},null,8,["value","options"])])])),_:1},8,["show"]))}}),H={class:"my-8"},$=_("div",null,"输入自定义缩放",-1),Q=v({__name:"customZoom",setup(e){const t=R(),s=a(),i=g((()=>s.customZoomDialog)),o=g((()=>s.taskId)),n=E({id:0,zoom:""}),h=async()=>{const e=await r({drawId:n.id,prompt:n.zoom,action:l.ZOOM,orderId:3}).then((e=>e.data));s.updateDrawId({id:e}),t.success("提交图片自定义缩放绘制任务成功、请等待绘制结束！"),s.updateCustomZoom(!1,"")},c=async()=>{const e=await d({jobId:o.value}).then((e=>e.data));n.id=e.id,n.zoom=e.fullPrompt+" --zoom 2"};return(e,t)=>(w(),f(F(z),{show:F(i),"onUpdate:show":t[2]||(t[2]=e=>B(i)?i.value=e:null),"mask-closable":!1,"show-icon":!1,preset:"dialog",title:"自定义缩放",onAfterEnter:c,onClose:t[3]||(t[3]=e=>F(s).updateCustomZoom(!1,0))},{action:b((()=>[y(F(L),{round:"",onClick:t[1]||(t[1]=e=>F(s).updateCustomZoom(!1,0))},{default:b((()=>[j("取消")])),_:1}),y(F(L),{round:"",type:"primary",onClick:h},{default:b((()=>[j("确定")])),_:1})])),default:b((()=>[_("div",H,[$,y(F(T),{value:n.zoom,"onUpdate:value":t[0]||(t[0]=e=>n.zoom=e),placeholder:"输入描述的自定义缩放",type:"textarea",resizable:!1,rows:7},null,8,["value"])])])),_:1},8,["show"]))}}),Y=new G.PaperScope;class J{constructor(e,s){t(this,"width",1024),t(this,"height",700),t(this,"canvas"),t(this,"backgroundImageElement"),t(this,"toolbar"),t(this,"checkerboardImage"),t(this,"backgroundImage"),t(this,"drawingLayer"),t(this,"undoLayer"),t(this,"redoLayer"),t(this,"tool"),t(this,"selectedTool",0),t(this,"movePath",!0),t(this,"removeCmd","Remove-"),t(this,"currentPath",null),t(this,"updateTool",(e=>{this.selectedTool=e})),this.backgroundImageElement=s,this.tool=new K(this),this.width=s.width,this.height=s.height,this.canvas=e,Y.setup(this.canvas),Y.project.activeLayer.name="EditorWorkspace",this.checkerboardImage=new Y.Raster("/static/png/checkerboard-a58f430c.png"),this.checkerboardImage.name="CheckerboardImage",this.checkerboardImage.position=new Y.Point(0,0),this.checkerboardImage.strokeWidth=0,this.checkerboardImage.scale(Math.max(this.width,this.height)/1024),this.drawingLayer=new Y.Group({name:"Drawing",blendMode:"destination-atop"}),this.undoLayer=new Y.Group({name:"Undo",visible:!1}),this.redoLayer=new Y.Group({name:"Redo",visible:!1}),Y.project.activeLayer.addChildren([new Y.Group({name:"CheckerboardCompositingGroup",children:[this.checkerboardImage,this.drawingLayer],blendMode:"source-over",opacity:.4}),this.undoLayer]),Y.project.activeLayer.addChild(this.redoLayer),Y.view.onFrame=()=>{this.checkerboardImage.visible=!1;for(let e=0;e<this.drawingLayer.children.length;e++)if(this.drawingLayer.children[e].bounds.area>0){this.checkerboardImage.visible=!0;break}},Y.view.onResize=this.onResize.bind(this),this.toolbar=document.getElementById("appbody"),this.onResize(),this.backgroundImage=new Y.Raster(s),this.backgroundImage.name="BackgroundImage",this.backgroundImage.position=new Y.Point(0,0),this.backgroundImage.strokeWidth=0,this.backgroundImage.insertBelow(this.drawingLayer.parent),this.canvas.setAttribute("oncontextmenu","return false;"),Y.settings.handleSize=0}undo(){this.processDoCommand(this.drawingLayer,this.undoLayer,this.redoLayer)}destroy(){this.drawingLayer.remove(),this.undoLayer.remove(),this.redoLayer.remove(),this.canvas.remove(),Y.clear()}submit(){const e=this.drawingLayer.children.length,t=this.drawingLayer.children;if(!e)return Promise.reject("请至少绘制一个区域");let s=0;for(let p=0;p<e;p++){const e=t[p];!e.name.includes("Image")&&(s+=e.bounds.width*e.bounds.height)}if(s<1e4)return Promise.reject("绘制区域过小");const i=Y.view.viewSize.width,a=Y.view.viewSize.height;this.tool.clearSelection(),Y.project.activeLayer.selected=!1,this.currentPath&&(this.currentPath.bounds.selected=!1);const o=this.drawingLayer.parent.opacity;this.drawingLayer.parent.opacity=1,this.drawingLayer.blendMode="normal",this.checkerboardImage.visible=!1,this.onResize({canonicalSpace:!0});const n=new Y.Path.Rectangle(Y.view.bounds);n.fillColor=new Y.Color("#fff"),n.sendToBack();for(let p=0;p<e;p++){const e=t[p];!e.name.includes("Image")&&(e.visible=!0)}const r=[],l=this.backgroundImage;if(l.name&&l.visible&&l.name.includes("Image")){const e=new Y.Path.Rectangle(l.bounds);e.fillColor=new Y.Color("#000"),e.insertAbove(l),e.name="Occluder",r.push(e)}this.tool.clearSelection(),Y.project.activeLayer.selected=!1,this.currentPath&&(this.currentPath.bounds.selected=!1),this.onResize({canonicalSpace:!0}),Y.view.update(),this.tool.clearSelection(),Y.project.activeLayer.selected=!1,this.currentPath&&(this.currentPath.bounds.selected=!1),this.onResize({canonicalSpace:!0});const d=Y.view.getContext(),h=d.getImageData(0,0,this.canvas.width/window.devicePixelRatio,this.canvas.height/window.devicePixelRatio),c=h.data;for(let p=0;p<c.length;p+=4)c[p+0]=c[p+0]>128?255:0,c[p+1]=c[p+1]>128?255:0,c[p+2]=c[p+2]>128?255:0,c[p+3]=255;d.putImageData(h,0,0);const u=this.canvas.toDataURL("image/webp",1);for(let p=0;p<r.length;p++)r[p].remove(),n.remove(),Y.view.viewSize.set(i,a),Y.view.update(),this.onResize(),this.drawingLayer.parent.opacity=o,this.drawingLayer.blendMode="destination-atop",this.checkerboardImage.visible=!0;const m=u.split(",")[1];return Promise.resolve(m)}processDoCommand(e,t,s){const i=t.lastChild;if(i)if(i.name&&i.name.startsWith(this.removeCmd)){const t=i.name.substring(this.removeCmd.length),a=e.getItem({match:e=>e.name===t});s.addChild(a),i.remove()}else{const t=e.getItem({match:e=>e.name===i.name});if(t){const e=t.clone();e.name=t.name,s.addChild(e),t.replaceWith(i)}else e.addChild(i),s.addChild(new Y.Group({name:this.removeCmd+i.name}))}}onResize(e){let t=0;if(e&&e.canonicalSpace)Y.view.viewSize.set(this.width/window.devicePixelRatio,this.height/window.devicePixelRatio),Y.view.zoom=1/window.devicePixelRatio;else{const e=1.75*this.toolbar.getBoundingClientRect().height;t=e;const s=this.canvas.width/window.devicePixelRatio,i=this.canvas.height/window.devicePixelRatio;Y.view.zoom=Math.max(.01,.95*Math.min(s/this.width,(i-e)/this.height))}Y.view.translate(new Y.Point(Y.view.center.x,Y.view.center.y-.5*t/Y.view.zoom)),Y.view.update()}}class K extends EventTarget{constructor(e){super(),t(this,"editor"),t(this,"tool"),t(this,"lastTolerance",5),t(this,"button",null),t(this,"minDistance",0),t(this,"markForSave",!1),t(this,"currentSegment"),t(this,"currentPath",null),t(this,"selectionRectPath",null),t(this,"selectedSegments",[]),this.tool=new Y.Tool,this.editor=e,this.tool.onMouseDown=this.onMouseDown.bind(this),this.tool.onMouseDrag=this.onMouseDrag.bind(this),this.tool.onMouseMove=this.onMouseMove.bind(this),this.tool.onMouseUp=this.onMouseUp.bind(this)}hitTestActiveLayer(e){return Y.project.hitTest(e,{segments:!0,stroke:!0,fill:!0,tolerance:this.lastTolerance,match:e=>e.item.layer===Y.project.activeLayer&&!e.item.name.includes("Background")&&!e.item.name.includes("Checkerboard")})}onMouseDown(e){this.clampToBounds(e),this.button=!e.event.button||e.event.button<=0?this.editor.selectedTool:e.event.button,this.minDistance=2===this.button?2*this.lastTolerance:0,this.currentSegment=this.currentPath=null;const t=this.hitTestActiveLayer(e.point);if(!this.button||this.button<=0)this.currentPath=new Y.Path.Rectangle({from:e.point,to:e.point}),this.currentPath.strokeColor=new Y.Color("#eeeeee"),this.currentPath.strokeColor.alpha=1,this.currentPath.strokeCap="round",this.currentPath.isRectangle=!0,this.currentPath.strokeWidth=4,this.currentPath.strokeColor=new Y.Color("rgba(255,255,255,1)"),this.currentPath.dashArray=[10,10],this.currentPath.add(e.point),this.editor.drawingLayer.addChild(this.currentPath);else if(.5===this.button)this.currentPath=new Y.Path({segments:[e.point]}),this.currentPath.strokeWidth=4,this.currentPath.strokeColor=new Y.Color("rgba(255,255,255,1)"),this.currentPath.dashArray=[10,10],this.currentPath.add(e.point),this.currentPath.strokeCap="round",this.currentPath.isStroke=!0,this.currentPath.closed=!0,this.currentPath.fillColor=new Y.Color(1,1,1),this.editor.drawingLayer.addChild(this.currentPath);else if(1===this.button)if(t){if(this.selectedSegments.length>0)this.markForSave=!0;else if(this.currentPath=t.item,this.currentPath&&(this.saveItemStateForUndo(t.item),"stroke"===t.type||"fill"===t.type))if(this.editor.movePath)this.currentSegment=null;else{const s=t.location;this.currentSegment=this.currentPath.insert(s.index+1,e.point),this.currentPath.smooth()}}else this.selectionRectPath=new Y.Path.Rectangle({from:e.point,to:e.point});else if(t&&2===this.button)if(this.selectedSegments.length>0)for(let s=Y.project.selectedItems.length-1;s>=0;s--){const e=Y.project.selectedItems[s];e.selected=!1,this.saveItemStateForUndo(e),e.remove()}else"stroke"===t.type||"fill"===t.type||t.segment.path.segments.length<=2?(this.saveItemStateForUndo(t.item),t.item.remove()):"segment"===t.type&&(this.saveItemStateForUndo(t.item),t.segment.remove())}onMouseMove(e){if(this.clampToBounds(e),0===this.selectedSegments.length){Y.project.activeLayer.selected=!1;const t=this.hitTestActiveLayer(e.point);t&&(t.item.selected=!0,t.item.strokeWidth&&(this.lastTolerance=Math.max(t.item.strokeWidth/4,5)))}}onMouseDrag(e){if(this.clampToBounds(e),!this.button||this.button<=0){if(Y.project.activeLayer.selected=!1,this.currentPath&&this.currentPath.isRectangle){const t=new Y.Path.Rectangle(e.downPoint,e.point);t.fillColor=new Y.Color("#fff"),this.currentPath.replaceWith(t),this.currentPath.remove(),this.currentPath=t,this.currentPath.bounds.selected=!0,this.currentPath.isRectangle=!0}}else if(.5===this.button)Y.project.activeLayer.selected=!1,this.currentPath.add(e.point);else if(1===this.button)if(this.selectionRectPath){const t=new Y.Path.Rectangle(e.downPoint,e.point);this.selectionRectPath.replaceWith(t),this.selectionRectPath.remove(),this.selectionRectPath=t,this.selectionRectPath.bounds.selected=!0,this.selectedSegments=[];for(let e=0;e<Y.project.selectedItems.length;e++)Y.project.selectedItems[e].selected=!1;const s=this.editor.drawingLayer.getItems({overlapping:t.bounds});for(let e=0;e<s.length;e++)if(s[e].segments)for(let t=0;t<s[e].segments.length;t++)this.selectionRectPath.bounds.contains(s[e].segments[t].point)&&(s[e].segments[t].selected=!0,this.selectedSegments.push(s[e].segments[t]))}else if(this.selectedSegments.length>0){if(this.markForSave){for(let e=Y.project.selectedItems.length-1;e>=0;e--)this.saveItemStateForUndo(Y.project.selectedItems[e]);this.markForSave=!1}for(let t=0;t<this.selectedSegments.length;t++)this.selectedSegments[t].point=this.selectedSegments[t].point.add(e.delta)}else this.currentSegment?this.currentSegment.point=this.currentSegment.point.add(e.delta):this.currentPath&&(this.currentPath.position=this.currentPath.position.add(e.delta));else if(2===this.button){const t=this.hitTestActiveLayer(e.point);if(!t)return;"stroke"===t.type||"fill"===t.type||t.segment.path.segments.length<=2?(this.saveItemStateForUndo(t.item),t.item.remove()):"segment"===t.type&&(this.saveItemStateForUndo(t.item),t.segment.remove())}}onMouseUp(e){this.clampToBounds(e),this.selectionRectPath&&(this.selectionRectPath.remove(),this.selectionRectPath=null),(!this.button||this.button<=.5)&&this.currentPath&&(this.currentPath.isRectangle||(this.currentPath.segments.length>1?this.currentPath.simplify(3):this.currentPath.add(e.point),this.currentPath.strokeColor=new Y.Color("#ffffff")),this.clearSelection(),this.currentPath.bounds.selected=!1,this.currentPath.name=`Stroke-${this.stringHashCode(this.currentPath.toString())}`,this.currentPath.strokeColor=null,this.editor.undoLayer.addChild(new Y.Group({name:this.editor.removeCmd+this.currentPath.name})),this.editor.redoLayer.removeChildren())}clearSelection(){for(let e=0;e<this.selectedSegments.length;e++)this.selectedSegments[e].selected=!1;this.selectedSegments=[];for(let e=0;e<Y.project.selectedItems.length;e++)Y.project.selectedItems[e].selected=!1}saveItemStateForUndo(e){e.name||(e.name=`ForeignObject-${this.stringHashCode(e.toString())}`);const t=e.clone();t.name=e.name,this.editor.undoLayer.addChild(t),this.editor.redoLayer.removeChildren()}stringHashCode(e){let t=0;if(0===e.length)return t;for(let s=0;s<e.length;s++){t=(t<<5)-t+e.charCodeAt(s),t&=t}return t}clampToBounds(e){const t=this.editor.backgroundImageElement.width,s=this.editor.backgroundImageElement.height;e.point=e.point.set(Math.min(.5*t,Math.max(.5*-t,e.point.x)),Math.min(.5*s,Math.max(.5*-s,e.point.y)))}}const X={class:"relative"},ee={class:"flex-1 flex items-center justify-center relative h-full"},te={key:0,class:"absolute top-0 h-[640px]"},se={class:"w-full h-full justify-center items-center flex"},ie={class:"absolute left-0 top-0 flex justify-center items-center",id:"appbody"},ae={class:"flex inset-x-0 bottom-0 w-full items-end justify-between p-3 gap-4"},oe=["onClick"],ne={class:"flex items-end flex-1 gap-4"},re=["disabled"],le=v({__name:"regionModal",setup(e){const{updateDrawId:t}=a(),s=R(),i=A(),o=A(),n=A(!0),d=W(),p=g((()=>d.openRegionDialog)),v=g((()=>d.varyRegionInfo)),j=A("");k((()=>v.value),(e=>{j.value=e.varyRegionPrompt,M(e)}),{deep:!0});const S=()=>{var e;null==(e=i.value)||e.submit().then((e=>{L({taskId:v.value.taskId,action:l.VARY_REGION,customId:v.value.varyRegionCustomId,prompt:j.value,mask:e}),G()})).catch((e=>{s.error(e)}))},L=async e=>{const i=await r({type:u.REGION_ACTION,params:e}).then((e=>e.data));t({id:i}),m.emit("regoinMldal",i),i&&s.success("提交任务成功！")},M=async e=>{n.value=!0;const t=await(s=e.taskId,h({url:"/upload/getModalImgById",data:{taskId:s}}));var s;const a=await(r=t.data,new Promise((async e=>{const t=new Image;t.src=r,t.onload=()=>e(t)})));var r;n.value=!1,i.value=new J(o.value,a)},U=[{label:"rect",value:0,icon:"rect"},{label:"lasso",value:.5,icon:"lasso"}],q=A(0),E=()=>{var e;null==(e=i.value)||e.undo()},G=()=>{var e;q.value=0,d.closeRegionModal(!1),null==(e=i.value)||e.destroy()};return(e,t)=>(w(),f(F(z),{show:F(p),"onUpdate:show":t[1]||(t[1]=e=>B(p)?p.value=e:null),"mask-closable":!1,"show-icon":!1,preset:"dialog",style:{width:"1200px",height:"800px"},title:"区域重绘",onClose:G},{default:b((()=>[_("div",X,[_("div",ee,[n.value.value?(w(),P("div",te,[_("div",se,[y(F(D),{size:"large"})])])):x("",!0),_("canvas",{ref_key:"canvasRef",ref:o,resize:"true",style:{padding:"0px",margin:"0px",width:"1024px",height:"640px"}},null,512)]),_("div",ie,[_("button",{onClick:E,class:"rounded-full bg-[#5a91fc] dark:bg-[#888] w-8 h-8"},[y(F(c),{name:"undo",class:"text-white"})])]),_("div",ae,[(w(),P(C,null,I(U,(e=>_("div",{class:"flex gap-2",onClick:t=>(e=>{var t;q.value=e.value,null==(t=i.value)||t.updateTool(e.value)})(e)},[_("button",{class:O(["rounded-full w-8 h-8",[e.value===q.value?"bg-[#3076ED] dark:bg-[#3076ED]":"bg-[#5a91fc] dark:bg-[#888]"]])},[y(F(c),{name:e.icon,class:"text-white"},null,8,["name"])],2)],8,oe))),64)),_("div",ne,[y(F(T),{value:j.value,"onUpdate:value":t[0]||(t[0]=e=>j.value=e),rows:2,class:"resize-none overflow-hidden flex-1 !border-gray-200 rounded",placeholder:"输入描述信息"},null,8,["value"]),_("button",{class:"rounded-full bg-[#3076ED] dark:bg-[#3076ED] w-8 h-8",disabled:!j.value,onClick:S},[y(F(c),{name:"send",class:"text-white"})],8,re)])])])])),_:1},8,["show"]))}}),de={class:"my-8"},he=_("div",null,"输入新的绘图描述",-1),ce=v({__name:"remixModal",setup(e){const t=R(),s=a(),i=g((()=>s.openRemixModal));g((()=>s.taskId));const o=g((()=>s.openRemixModalData)),n=E({id:0,zoom:""}),l=()=>{r({type:u.REGION_ACTION,params:{prompt:n.zoom,taskId:o.value.taskId}}).then((e=>{t.success("操作成功、请等待绘制结束！"),s.updateRemixModal(!1)})).catch((e=>{402===e.code||(null==e?void 0:e.message.includes("余额不足"))||(null==e?void 0:e.message.includes("免费额度已经使用完毕"))?(s.updateRemixModal(!1),useGlobalStore.updateVipDialog(!0)):t.error(e.message)}))},d=async()=>{};return(e,t)=>(w(),f(F(z),{show:F(i),"onUpdate:show":t[2]||(t[2]=e=>B(i)?i.value=e:null),"mask-closable":!1,"show-icon":!1,preset:"dialog",title:"Remix",onAfterEnter:d,onClose:t[3]||(t[3]=e=>F(s).updateRemixModal(!1,0))},{action:b((()=>[y(F(L),{round:"",onClick:t[1]||(t[1]=e=>F(s).updateRemixModal(!1,0))},{default:b((()=>[j("取消")])),_:1}),y(F(L),{round:"",type:"primary",onClick:l},{default:b((()=>[j("确定")])),_:1})])),default:b((()=>[_("div",de,[he,y(F(T),{value:n.zoom,"onUpdate:value":t[0]||(t[0]=e=>n.zoom=e),placeholder:"输入新的绘图描述",type:"textarea",resizable:!1,rows:7},null,8,["value"])])])),_:1},8,["show"]))}}),ue={key:0},me={class:"relative px-2 top-0 w-full"},pe={class:"mj-content w-full h-full overflow-hidden"},ve={key:1,class:"grow flex h-screen flex-col lg:pt-0",style:{"background-color":"#171726"}},ge={class:"flex grow flex-col sm:flex-row h-full"},we={class:"mj-content w-full bg-[#f4f4f4] dark:bg-[#171726]"},fe=v({__name:"index",setup(e){const t=g((()=>n.path)),{isMobile:a}=p(),o=s(),n=i(),r=[{id:"/midjourney/text-to-image",name:"文生图"},{id:"/midjourney/image-to-text",name:"图生文"},{id:"/midjourney/image-mix-image",name:"图混图"},{id:"/midjourney/inspiration",name:"灵感广场"},{id:"/midjourney/paint-task",name:"绘画任务"}],l=e=>{o.push(`${e}`)};return(e,s)=>{const i=S("RouterView");return w(),P(C,null,[y(Q),y(ce),y(le),y(V),F(a)?(w(),P("div",ue,[_("div",me,[y(F(q),{class:"mt-1","justify-content":"space-around",type:"line","tab-style":"line",value:F(t),"onUpdate:value":s[0]||(s[0]=e=>B(t)?t.value=e:null),size:"small",animated:"","pane-wrapper-style":"margin: 0 -4px","pane-style":"padding: 0 4px 0 4px; box-sizing: border-box;",onUpdateValue:l},{default:b((()=>[(w(),P(C,null,I(r,(e=>y(F(U),{name:e.id,tab:e.name},null,8,["name","tab"]))),64))])),_:1},8,["value"])]),_("div",pe,[y(i)])])):x("",!0),F(a)?x("",!0):(w(),P("div",ve,[_("div",ge,[_("div",we,[y(i)])])]))],64)}}});export{fe as default};
