import{d as e,b as a,aq as l,u as t,y as s,c as n,v as i,a5 as o,G as u,T as r,z as v,U as f,i as d,j as c,a0 as p,F as m,r as A,ar as h,o as g,n as y,w,as as x,g as k,a2 as b,h as B,k as C,l as E,Z as U,$ as K,aa as j,at as I,au as D,K as R,m as S,C as F,D as J,E as L}from"../main-4e4d4648.js";import{t as q}from"../throttle/throttle.33f09de3.js";import{S as N}from"../index/index.9db8dd62.js";const O={class:"overflow-hidden pr-0 h-full flex flex-col"},Q={class:"market overflow-y-auto flex-1 min-h-screen h-[80vh] p-2 relative itemContent"},V=["id"],W=["id","src","onLoad","onError"],z=["onClick"],T=[c("div",null,"查看详情",-1)],G=e({__name:"market",props:{type:{type:String,required:!1,default:"all"}},setup(e,{expose:k}){var b;const B=a();null==(b=l())||b.appContext.config.globalProperties.$viewerApi,t();const C=s([]),E=s({}),U=s(0),K=s(160),j=s(0),I=s(10),D=s(10),R=s([]),S=s(null),F=s(0);n((()=>B.isLogin));const J=s(30),L=s(""),N=n((()=>J.value+I.value+150));i();const G=e,Z=s();o.on("newData",(e=>{Z.value=e}));const _=u({page:1,size:999,rec:1,squareType:G.type});function H(){!function(){const{showName:e=0,showOther:a=0}={};U.value=15*[e,a].filter((e=>e)).length}(),function(){if(!S.value)return;const e=S.value.clientWidth;j.value=Math.floor(e/N.value);const a=e-j.value*N.value,l=(j.value-1)*I.value;a-l<0&&(j.value-=1);K.value=Math.floor((e-l)/j.value)}();const e=j.value,a=K.value,l=[];P.value.forEach(((t,s)=>{let n=200,i=300;t.fileInfo&&(n=t.fileInfo.width||n,i=t.fileInfo.height||i);const o=i*(a/n)+D.value+U.value,u=E.value[t.id];if(l.length<e)u.style.top="0px",u.style.left=(a+I.value)*s+"px",l.push(o);else{const e=Math.min.apply(null,l),a=l.findIndex((a=>a===e));u.style.top=`${e+0}px`,u.style.left=a*(K.value+I.value)+"px",l[a]+=o}})),F.value=Math.max(...l)+130}const P=n((()=>Z.value?Z.value.rows:L.value?C.value.filter((e=>{const{prompt:a}=e;return a.includes(L.value)})):C.value));r(J,(()=>{H()}));let X=null;async function Y(){let e=(await h(_)).data.rows;e.forEach((e=>{e.src=e.imageUrl+"?imageView2/0/w/400/q/85"})),C.value=e}r(P,(()=>{P.value.length&&(clearTimeout(X),X=setTimeout((()=>{H()}),300))}));const M=n((()=>e=>{let a=200,l=300;return e.fileInfo&&(a=e.fileInfo.width,l=e.fileInfo.height),l/(a/K.value)})),$=q((function(){H()}),200);return v((async()=>{await Y(),H(),window.addEventListener("resize",$)})),k({handleQuery:e=>{_.squareType=e,Y(),H()}}),f((()=>{window.removeEventListener("resize",$)})),(e,a)=>(g(),d("div",O,[c("div",Q,[c("div",{id:"wapper",ref_key:"wapperRef",ref:S,class:"wapper",style:p({height:`${F.value}px`})},[(g(!0),d(m,null,A(P.value,((e,a)=>(g(),d("div",{id:e.id,key:a,ref_for:!0,ref:a=>function(e,a){e&&a&&(E.value[a.id]=e)}(a,e),class:"wapper-item",style:p({width:`${K.value}px`})},[y(x,{name:"img",css:!0},{default:w((()=>[c("img",{id:e.id,class:"item-file rounded-sm",style:p({width:`${K.value}px`,height:`${M.value(e)}px`}),src:e.src,loading:"lazy",onLoad:a=>function(e,a){R.value.push(a.id)}(0,e),onError:a=>function(e,a){R.value.push(a.id)}(0,e)},null,44,W)])),_:2},1024),c("div",{class:"menu",onClick:a=>function(e){o.emit("Details",!0),o.emit("DetailsData",e)}(e)},T,8,z)],12,V)))),128))],4)])]))}}),Z=e=>(F("data-v-c90eedfa"),e=e(),J(),e),_={style:{position:"absolute"}},H=Z((()=>c("div",{class:"mask"},null,-1))),P={class:"dark:bg-[#15171A] bg-[#fff] mainBox"},X={key:0,class:"flex justify-center"},Y={style:{display:"flex","justify-content":"center","margin-top":"10px"}},M={class:"inpBox bg-[#EBEBEB] dark:bg-[#171726]"},$=[Z((()=>c("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAe1JREFUOE+dlD1oFFEUhb8DKmphKom/CBILQdHCBBQhNmJAUlkFtRFEK0Fr7aw1sQhISCWSyjSSYKGgRCyihUbsUijGQmxU8AcVjnOXN+tkdnZn3dcs7Jv3vXPfPfeINsv2WmAXsBlYB/wCPgHvJP1udy7+V3nT9kbgGDAIrK84/AN4kX3zWNL3KvgqqO0dwFlgE/AReAm8BwK0AdgJHAC2AF+BO5JWyuAm1HYcOA84UzknabHD0wwBJ1OlU5Li4uZqQG1HmVdSubclfej0ZunMNuAi8DOr7Iak+G2sHBq3HgVmJT2vA+b7tg8Bp4CnkuaaUNtrgKvAF0k3uwUWwJeBPuC6pD8Npbb3AOeAB5Ke9AAdBkayJk5LWs6hR4BRYCr5sf9/4LZ3pwbfl/Qsh4YnTwC3gOPAXuBaXkqdcttbgUvAI0kPq5QGMBo2WbZJB3tVKm2+KfA22WRZ0nSdymStyjfNu/9Z0rjt08A+YEnSTB3Ydmv30225T+8Br4AzMaqSJjpBCz5dkDRfNn8vE7UduAB8AyZaJiqp7WX2IxLfAHclRWb8G9PCdHSTUgeB/pjAlK8D2ai+BmZycK95GvkQ0xeROAbsL4JboAXVxeSPLA1AS/LbDsZqcJ1lutkvgefbKu0GVvwmgQ8DK38BXh3TaV83jK0AAAAASUVORK5CYII=",alt:""},null,-1))),Z((()=>c("p",null,"搜索",-1)))],ee={key:1,class:"flex w-full flex-j mb-2 items-center overflow-x-hidden justify-center",style:{"margin-top":"25px"}},ae={class:"relative z-40 transition-300 ease"},le=["onClick"],te={class:"pl-3 pr-3 pt-1 pb-1 whitespace-nowrap"},se={class:"flex-1 h-[82vh]",style:{padding:"0 200px","margin-bottom":"10px"}},ne=L(e({__name:"inspiration",setup(e){const{isMobile:a}=k(),l=s(),t=s(""),n=s(),i=s([]);(async()=>{const e=await j({page:1,size:100}).then((e=>e.data.rows));i.value=[{name:"全部",value:""}].concat(e)||I,l.value.handleQuery(t.value)})(),o.emit("drawRoute",b.options.history.location);const u=s(),r=s();function v(){let e={keyword:r.value,page:1,size:999};D(e).then((e=>{u.value=e.data,o.emit("newData",u.value)})),r.value=""}return(e,s)=>(g(),d(m,null,[c("div",_,[B(a)?E("",!0):(g(),C(N,{key:0}))]),H,c("div",P,[B(a)?E("",!0):(g(),d("div",X)),c("div",Y,[c("div",M,[U(c("input",{class:"inp bg-[#f4f4f4] dark:bg-[#010102]","onUpdate:modelValue":s[0]||(s[0]=e=>r.value=e),type:"text",placeholder:"输入关键词"},null,512),[[K,r.value]]),c("div",{class:"iconBox",onClick:v},$)])]),B(a)?E("",!0):(g(),d("div",ee,[c("div",ae,[c("ul",{class:"flex justify-start items-center",ref_key:"tabListRef",ref:n},[(g(!0),d(m,null,A(i.value,(e=>(g(),d("li",{onClick:a=>{return s=e,t.value=s.value,l.value.handleQuery(s.value),void o.emit("newData","");var s},class:R(["mr-1 ml-1 w-auto select-none cursor-pointer hover:dark:text-[#fff] hover:text-[#fff] hover:bg-gradient-to-l from-[#2F73EC] to-[#5AA8F7] duration-300 flex rounded-3xl",[e.value===t.value?"text-[#fff] bg-gradient-to-l from-[#2F73EC] to-[#5AA8F7]  dark:text-[#fff]":"bg-[transparent] dark:bg-[transparent]"]])},[c("div",te,S(e.name),1)],10,le)))),256))],512)])])),c("div",se,[y(G,{ref_key:"marketRef",ref:l,type:t.value},null,8,["type"])])])],64))}}),[["__scopeId","data-v-c90eedfa"]]);export{ne as default};
