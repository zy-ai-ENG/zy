import{d as e,b as a,ar as l,u as t,y as s,c as n,v as i,a6 as o,G as r,U as u,z as v,V as d,i as f,j as c,a1 as p,F as m,r as A,as as h,o as g,n as y,w,at as x,g as k,a3 as b,h as B,k as C,l as E,$ as U,a0 as K,ab as j,au as D,av as I,K as R,m as S,C as F,D as J,E as L}from"../main-4cae9f5a.js";import{t as V}from"../throttle/throttle.33f09de3.js";import{S as q}from"../index/index.47aafc2b.js";const N={class:"overflow-hidden pr-0 h-full flex flex-col"},O={class:"market overflow-y-auto flex-1 min-h-screen h-[80vh] p-2 relative itemContent"},Q=["id"],W=["id","src","onLoad","onError","onClick"],z=["onClick"],G=[c("div",null,"查看详情",-1)],T=e({__name:"market",props:{type:{type:String,required:!1,default:"all"}},setup(e,{expose:k}){var b;const B=a(),C=null==(b=l())?void 0:b.appContext.config.globalProperties.$viewerApi;t();const E=s([]),U=s({}),K=s(0),j=s(160),D=s(0),I=s(10),R=s(10),S=s([]),F=s(null),J=s(0);n((()=>B.isLogin));const L=s(30),q=s(""),T=n((()=>L.value+I.value+150));i();const _=e,H=s();o.on("newData",(e=>{H.value=e}));const P=r({page:1,size:999,rec:1,squareType:_.type});function X(){!function(){const{showName:e=0,showOther:a=0}={};K.value=15*[e,a].filter((e=>e)).length}(),function(){if(!F.value)return;const e=F.value.clientWidth;D.value=Math.floor(e/T.value);const a=e-D.value*T.value,l=(D.value-1)*I.value;a-l<0&&(D.value-=1);j.value=Math.floor((e-l)/D.value)}();const e=D.value,a=j.value,l=[];Z.value.forEach(((t,s)=>{let n=200,i=300;t.fileInfo&&(n=t.fileInfo.width||n,i=t.fileInfo.height||i);const o=i*(a/n)+R.value+K.value,r=U.value[t.id];if(l.length<e)r.style.top="0px",r.style.left=(a+I.value)*s+"px",l.push(o);else{const e=Math.min.apply(null,l),a=l.findIndex((a=>a===e));r.style.top=`${e+0}px`,r.style.left=a*(j.value+I.value)+"px",l[a]+=o}})),J.value=Math.max(...l)+130}const Z=n((()=>H.value?H.value.rows:q.value?E.value.filter((e=>{const{prompt:a}=e;return a.includes(q.value)})):E.value));u(L,(()=>{X()}));let Y=null;async function M(){const e=await h(P);let a=e.data.rows;a.forEach((e=>{e.src=e.imageUrl+"?imageView2/1/w/400/h/600/q/85"})),E.value=a,console.log("res",e.data.rows)}u(Z,(()=>{Z.value.length&&(clearTimeout(Y),Y=setTimeout((()=>{X()}),300))}));const $=n((()=>e=>{let a=200,l=300;return e.fileInfo&&(a=e.fileInfo.width,l=e.fileInfo.height),l/(a/j.value)})),ee=V((function(){X()}),200);return v((async()=>{await M(),X(),window.addEventListener("resize",ee)})),k({handleQuery:e=>{P.squareType=e,M(),X()}}),d((()=>{window.removeEventListener("resize",ee)})),(e,a)=>(g(),f("div",N,[c("div",O,[c("div",{id:"wapper",ref_key:"wapperRef",ref:F,class:"wapper",style:p({height:`${J.value}px`})},[(g(!0),f(m,null,A(Z.value,((e,a)=>(g(),f("div",{id:e.id,key:a,ref_for:!0,ref:a=>function(e,a){e&&a&&(U.value[a.id]=e)}(a,e),class:"wapper-item",style:p({width:`${j.value}px`})},[y(x,{name:"img",css:!0},{default:w((()=>[c("img",{id:e.id,class:"item-file rounded-sm",style:p({width:`${j.value}px`,height:`${$.value(e)}px`}),src:e.src,loading:"lazy",onLoad:a=>function(e,a){S.value.push(a.id)}(0,e),onError:a=>function(e,a){S.value.push(a.id)}(0,e),onClick:a=>function(e){C({options:{},images:[e.imageUrl]})}(e)},null,44,W)])),_:2},1024),c("div",{class:"menu",onClick:a=>function(e){o.emit("Details",!0),o.emit("DetailsData",e)}(e)},G,8,z)],12,Q)))),128))],4)])]))}}),_=e=>(F("data-v-c90eedfa"),e=e(),J(),e),H={style:{position:"absolute"}},P=_((()=>c("div",{class:"mask"},null,-1))),X={class:"dark:bg-[#15171A] bg-[#fff] mainBox"},Z={key:0,class:"flex justify-center"},Y={style:{display:"flex","justify-content":"center","margin-top":"10px"}},M={class:"inpBox bg-[#EBEBEB] dark:bg-[#171726]"},$=[_((()=>c("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAe1JREFUOE+dlD1oFFEUhb8DKmphKom/CBILQdHCBBQhNmJAUlkFtRFEK0Fr7aw1sQhISCWSyjSSYKGgRCyihUbsUijGQmxU8AcVjnOXN+tkdnZn3dcs7Jv3vXPfPfeINsv2WmAXsBlYB/wCPgHvJP1udy7+V3nT9kbgGDAIrK84/AN4kX3zWNL3KvgqqO0dwFlgE/AReAm8BwK0AdgJHAC2AF+BO5JWyuAm1HYcOA84UzknabHD0wwBJ1OlU5Li4uZqQG1HmVdSubclfej0ZunMNuAi8DOr7Iak+G2sHBq3HgVmJT2vA+b7tg8Bp4CnkuaaUNtrgKvAF0k3uwUWwJeBPuC6pD8Npbb3AOeAB5Ke9AAdBkayJk5LWs6hR4BRYCr5sf9/4LZ3pwbfl/Qsh4YnTwC3gOPAXuBaXkqdcttbgUvAI0kPq5QGMBo2WbZJB3tVKm2+KfA22WRZ0nSdymStyjfNu/9Z0rjt08A+YEnSTB3Ydmv30225T+8Br4AzMaqSJjpBCz5dkDRfNn8vE7UduAB8AyZaJiqp7WX2IxLfAHclRWb8G9PCdHSTUgeB/pjAlK8D2ai+BmZycK95GvkQ0xeROAbsL4JboAXVxeSPLA1AS/LbDsZqcJ1lutkvgefbKu0GVvwmgQ8DK38BXh3TaV83jK0AAAAASUVORK5CYII=",alt:""},null,-1))),_((()=>c("p",null,"搜索",-1)))],ee={key:1,class:"flex w-full flex-j mb-2 items-center overflow-x-hidden justify-center",style:{"margin-top":"25px"}},ae={class:"relative z-40 transition-300 ease"},le=["onClick"],te={class:"pl-3 pr-3 pt-1 pb-1 whitespace-nowrap"},se={class:"flex-1 h-[82vh]",style:{padding:"0 200px","margin-bottom":"10px"}},ne=L(e({__name:"inspiration",setup(e){const{isMobile:a}=k(),l=s(),t=s(""),n=s(),i=s([]);(async()=>{const e=await j({page:1,size:100}).then((e=>e.data.rows));i.value=[{name:"全部",value:""}].concat(e)||D,l.value.handleQuery(t.value)})(),o.emit("drawRoute",b.options.history.location);const r=s(),u=s();function v(){let e={keyword:u.value,page:1,size:999};I(e).then((e=>{r.value=e.data,o.emit("newData",r.value)})),u.value=""}return(e,s)=>(g(),f(m,null,[c("div",H,[B(a)?E("",!0):(g(),C(q,{key:0}))]),P,c("div",X,[B(a)?E("",!0):(g(),f("div",Z)),c("div",Y,[c("div",M,[U(c("input",{class:"inp bg-[#f4f4f4] dark:bg-[#010102]","onUpdate:modelValue":s[0]||(s[0]=e=>u.value=e),type:"text",placeholder:"输入关键词"},null,512),[[K,u.value]]),c("div",{class:"iconBox",onClick:v},$)])]),B(a)?E("",!0):(g(),f("div",ee,[c("div",ae,[c("ul",{class:"flex justify-start items-center",ref_key:"tabListRef",ref:n},[(g(!0),f(m,null,A(i.value,(e=>(g(),f("li",{onClick:a=>{return s=e,t.value=s.value,l.value.handleQuery(s.value),void o.emit("newData","");var s},class:R(["mr-1 ml-1 w-auto select-none cursor-pointer hover:dark:text-[#fff] hover:text-[#fff] hover:bg-gradient-to-l from-[#2F73EC] to-[#5AA8F7] duration-300 flex rounded-3xl",[e.value===t.value?"text-[#fff] bg-gradient-to-l from-[#2F73EC] to-[#5AA8F7]  dark:text-[#fff]":"bg-[transparent] dark:bg-[transparent]"]])},[c("div",te,S(e.name),1)],10,le)))),256))],512)])])),c("div",se,[y(T,{ref_key:"marketRef",ref:l,type:t.value},null,8,["type"])])])],64))}}),[["__scopeId","data-v-c90eedfa"]]);export{ne as default};
